{"version":3,"sources":["node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","src/app.js","src/flow.js","src/dom/dom-manager.js","src/channels/run-channel.js","src/config.js","src/dom/nodes/node-manager.js","src/dom/attributes/attribute-manager.js","src/converters/converter-manager.js","src/utils/parse-utils.js","src/utils/dom.js","src/dom/plugins/auto-update-bindings.js","src/channels/variables-channel.js","src/channels/operations-channel.js","src/converters/number-converter.js","src/converters/string-converter.js","src/converters/array-converter.js","src/converters/underscore-utils-converter.js","src/converters/numberformat-converter.js","src/dom/nodes/input-checkbox-node.js","src/dom/nodes/default-input-node.js","src/dom/nodes/default-node.js","src/dom/attributes/no-op-attr.js","src/dom/attributes/events/init-event-attr.js","src/dom/attributes/events/default-event-attr.js","src/dom/attributes/foreach/default-foreach-attr.js","src/dom/attributes/binds/checkbox-radio-bind-attr.js","src/dom/attributes/binds/input-bind-attr.js","src/dom/attributes/class-attr.js","src/dom/attributes/positive-boolean-attr.js","src/dom/attributes/negative-boolean-attr.js","src/dom/attributes/binds/default-bind-attr.js","src/dom/attributes/default-attr.js","src/dom/nodes/base.js"],"names":["window","Flow","require","version","domManager","Channel","module","exports","dom","initialize","config","model","$","data","defaults","channel","run","account","project","operations","variables","autoFetch","start","root","autoBind","options","extend","$root","initFn","opnSilent","silent","isInitOperationSilent","_","isArray","contains","preFetchVariables","this","nodeManager","attrManager","converterManager","parseUtils","domUtils","autoUpdatePlugin","expr","prefix","obj","$this","dataprops","keys","match","find","attr","indexOf","webcomponent","nodeName","getMatchingElements","matchedElements","is","add","getElementOrError","element","context","get","console","error","Error","publicAPI","nodes","attributes","converters","private","unbindElement","$el","without","Handler","getHandler","h","handle","el","removeEvents","each","index","nodeMap","wantedPrefix","replace","handler","stopListening","call","subsid","subs","unsubscribe","bindElement","push","subscribe","varsToBind","length","newsubs","concat","attrBindings","nonBatchableVariables","attrVal","value","isBindableAttr","init","withConv","invoke","split","shift","binding","commaRegex","batch","topics","bindAll","elementsToBind","me","unbindAll","elementsToUnbind","trigger","off","events","on","evt","parsedData","target","attrConverters","getConvertersList","val","key","trim","parse","toImplicitType","bind","publish","react","bindings","toconvert","variableName","pick","convert","prop","toLowerCase","convertedValue","isPlainObject","opn","params","map","VarsChannel","OperationsChannel","rm","F","manager","RunManager","rs","$creationPromise","getRun","currentPromise","createAndThen","fn","wrap","func","passedInParams","toArray","arguments","slice","then","apply","name","isFunction","originalVariablesFn","vs","varOptions","debouncedRefresh","debounce","refresh","enable","startAutoFetch","leading","defaultAttr","binderAttr","normalize","selector","toMatch","node","isString","list","register","unshift","currentHandler","i","splice","defaultHandlers","reverse","handlersList","attributeMatcher","nodeMatcher","test","matchAttr","matchExpr","attrMatch","isRegExp","matchNode","nodeFilter","filter","attrFilter","filtered","select","property","alias","converter","acceptList","ret","matchConverter","isRegex","normalized","currentConverter","getConverter","currentValue","convertArray","converterName","v","convertObject","mapValues","converted","defaultconverters","c","rbrace","charAt","substring","isNumeric","parseJSON","matchValue","$parentEl","closest","MutationObserver","observer","mutations","forEach","mutation","added","addedNodes","removed","removedNodes","mutconfig","childList","subtree","characterData","observe","channelOptions","currentData","isEqual","getInnerVariables","str","inner","interpolate","variablesToInterpolate","values","interpolationMap","interpolated","outerVariable","originalOuter","innerVariable","thisval","undefined","op","subscriptions","unfetched","getSubscribers","topic","getAllTopics","pluck","flatten","uniq","getTopicDependencies","innerList","vname","updateAndCheckForRefresh","debouncedFetch","debounceOptions","maxWait","fetch","changed","notify","variablesList","innerVariables","getVariables","vars","query","changeSet","oldValue","interpolatedName","ip","stopAutoFetch","changeList","force","changedVariables","shouldSilence","intersection","except","Deferred","resolve","promise","callTarget","object","subscription","matchingTopics","size","variable","attrs","it","toSave","save","subscriber","id","uniqueId","token","reject","unsubscribeAll","listenerMap","topicSubscribers","globalSubscribers","executedOpns","response","operation","listeners","listener","serial","parallel","opts","do","parseFloat","s","upperCase","toUpperCase","lowerCase","titleCase","txt","substr","item","oldfn","newfn","supported","isNegative","floatMatcher","results","exec","number","suffix","getDigits","digits","roundTo","Math","max","ceil","log","LN10","TXT","numberTXT","toString","decimalSet","iTXT","addDecimals","decimals","minDecimals","hasCommas","hasDecimals","iDec","iChar","toADD","round","pow","getSuffix","formatTXT","fixesTXT","RegExp","isCurrency","string","format","isNumber","isNaN","formats","abs","sign","leftOfDecimal","d","lastIndexOf","isShortFormat","nextChar","leadingText","rightOfPrefix","shortFormatTest","shortFormatTestResult","valScale","floor","min","Number","SUFFIX","valWithoutLeading","scales","limitDigits","subFormats","preffix","formatted","BaseView","propertyHandlers","getUIValue","offVal","onVal","prototype","uiChangeEvent","propName","noop","listOfOperations","fnName","args","$loopTemplate","children","$me","empty","dataval","datakey","clone","newNode","templated","template","oldHTML","html","cleanedHTML","append","settableValue","isChecked","addedClasses","removeClass","addClass","valueToTemplate","bindTemplate","protoProps","staticProps","parent","child","has","constructor","Surrogate","__super__","View"],"mappings":"AAAA;ACAAA,OAAOC,KAAOC,QAAQ,aACtBF,OAAOC,KAAKE,QAAU;;AYDtB,YACA,IAAIO,QAASR,QAAQ,YAErBI,QAAOC,QAAU,SAAUkB,SACvB,GAAIX,WASAgB,QAAQ,EAGZ,IAAIyN,gBAAiB3O,EAAEc,QAAO,KAAUZ,SAAUW,QAClD,IAAIT,KAAMuO,eAAevO,GAEzB,IAAIkD,YAEAI,WACI7C,QAAS8N,gBAGbsE,eAEAnD,eAAgB,SAAUC,OACtB,GAAImD,kBAAmB1R,KAAKyR,YAAYlD,UACxC,IAAIoD,mBAAoB3R,KAAKyR,YAAY,QACzC,OAAOC,kBAAiB7N,OAAO8N,oBAUnClJ,QAAS,SAAUmJ,aAAcC,SAAU5B,OAEvC,GAAIvQ,QAASyN,eAAezN,MAE5B,IAAIyQ,eAAgBzQ,UAAW,CAQ/B,IAPIE,EAAEC,QAAQH,SAAWkS,eACrBzB,cAAgBvQ,EAAEwQ,aAAa1Q,OAAQkS,cAAcjO,SAAWjE,OAAOiE,QAEvEnF,EAAEkI,cAAchH,SAAWkS,eAC3BzB,cAAgBvQ,EAAEwQ,aAAa1Q,OAAO2Q,OAAQuB,cAAcjO,SAAWiO,aAAajO,SAGnFwM,eAAiBF,SAAU,EAAM,CAClC,GAAInL,IAAK9E,IACTJ,GAAEgD,KAAKgP,aAAc,SAAUjL,KAC3B7B,GAAGuK,OAAO1I,IAAKkL,cAK3BxC,OAAQ,SAAUyC,UAAW7N,OACzB,GAAI8N,WAAY/R,KAAKsO,eAAewD,UACpC,IAAIlL,UACJA,QAAOkL,WAAa7N,MAEpBrE,EAAEgD,KAAKmP,UAAW,SAAUC,UACxB,GAAIzM,QAASyM,SAASzM,MACtB,IAAI3F,EAAEuI,WAAW5C,QACbA,OAAOpC,KAAK,KAAMyD,OAAQ3C,MAAO6N,eAC9B,CAAA,IAAIvM,OAAON,QAGd,KAAM,IAAIpD,OAAM,+BAAiCiQ,UAFjDE,UAASzM,OAAON,QAAQ3G,OAAO6G,OAAOc,MAAOW,YAczDZ,QAAS,SAAU8L,UAAWlL,OAAQvH,SAClC,GAAIyF,IAAK9E,IACT,IAAIxB,EAAEkI,cAAcoL,YAAcA,UAAU/S,WAAY,CACpD,GAAI0I,IAAMqK,UAAgB,OAAIlT,IAAIqT,OAASrT,IAAIsT,QAC/C,OAAOzK,IAAGtE,KAAKvE,IAAKkT,UAAU/S,YACrBiJ,KAAK,SAAU6J,UACPjL,QAAWA,OAAOlH,QACnBoF,GAAG2D,QAAQtF,KAAK2B,GAAIlF,EAAE6O,MAAMqD,UAAU/S,WAAY,QAAS8S,YAK3E,GAAIM,MAAQ3T,EAAEkI,cAAcoL,WAAclL,OAASvH,OACnD,OAAOT,KAAIwT,GAAGnK,MAAMrJ,IAAKkJ,WACpBE,KAAK,SAAU6J,UACPM,MAASA,KAAKzS,QACfoF,GAAG2D,QAAQtF,KAAK2B,IAAKgN,WAAYD,aAOrDpO,UAAW,SAAU1E,WAAYoS,YAE7BpS,cAAgB8E,OAAO9E,YAElBoS,WAAW/L,IAAOxF,EAAEuI,WAAWgJ,cAChCA,WAAa3S,EAAE2S,YAGnB,IAAIC,IAAMxR,EAAEyR,SAAS,uBACrB,IAAI5S,OACA2S,GAAIA,GACJ7L,OAAQ4L,WAGZ,IAAIrM,IAAK9E,IAST,OAPAxB,GAAEoE,KAAK7D,WAAY,SAAU8D,MAAO8D,KAC3B7B,GAAG2M,YAAY9K,OAChB7B,GAAG2M,YAAY9K,SAEnB7B,GAAG2M,YAAY9K,KAAO7B,GAAG2M,YAAY9K,KAAK9C,OAAOpF,QAG9C2S,IAEX9N,YAAa,SAAUwO,UAAWR,OAC9BtR,KAAKyR,YAAYK,WAAalS,EAAE2R,OAAOvR,KAAKyR,YAAYK,WAAY,SAAUzO,MAC1E,MAAOA,MAAK+N,KAAOE,SAG3BE,eAAgB,WACZxR,KAAKyR,gBAGb,OAAOjT,GAAEc,OAAOU,KAAM8B;;AT7I1B,YAEA,IAAIgF,aAAchJ,QAAQ,sBAC1B,IAAIiJ,mBAAoBjJ,QAAQ,uBAEhCI,QAAOC,QAAU,SAAUkB,SACvB,GAAIX,WACAE,KACII,aAGAD,eAKR,IAAIT,QAASE,EAAEc,QAAO,KAAUZ,SAAUW,QAE1C,IAAI2H,IAAK,GAAIC,GAAEC,QAAQC,WAAW7I,OAClC,IAAI8I,IAAKJ,GAAGpI,GAEZ,IAAIyI,kBAAmBL,GAAGM,QAC1BF,IAAGG,eAAiBF,gBAEpB,IAAIG,eAAgB,SAAUC,GAAIhG,SAC9B,MAAO7B,GAAE8H,KAAKD,GAAI,SAAUE,MACxB,GAAIC,gBAAiBhI,EAAEiI,QAAQC,WAAWC,MAAM,EAChD,OAAOX,IAAGG,eAAeS,KAAK,WAE1B,MADAZ,IAAGG,eAAiBI,KAAKM,MAAMxG,QAASmG,gBACjCR,GAAGG,mBAMtB3H,GAAEgD,KAAKwE,GAAI,SAAUnD,MAAOiE,MACpBtI,EAAEuI,WAAWlE,QAAmB,cAATiE,MAAkC,WAATA,OAChDd,GAAGc,MAAQV,cAAcvD,MAAOmD,MAIxC,IAAIgB,qBAAsBhB,GAAGpI,SAC7BoI,IAAGpI,UAAY,WACX,GAAIqJ,IAAKD,oBAAoBH,MAAMb,GAAIU,UAMvC,OALAlI,GAAEgD,KAAKyF,GAAI,SAAUpE,MAAOiE,MACpBtI,EAAEuI,WAAWlE,SACboE,GAAGH,MAAQV,cAAcvD,MAAOoE,OAGjCA,IAGXrI,KAAKpB,IAAMwI,EACX,IAAIkB,YAAahK,OAAOM,IAAII,SAC5BgB,MAAKhB,UAAY,GAAI8H,aAAYtI,EAAEc,QAAO,KAAUgJ,YAAc1J,IAAKwI,MACvEpH,KAAKjB,WAAa,GAAIgI,mBAAkBvI,EAAEc,QAAO,KAAUhB,OAAOM,IAAIG,YAAcH,IAAKwI,KAEzF,IAAItC,IAAK9E,IACT,IAAIuI,kBAAmB3I,EAAE4I,SAAS,WAC9B1D,GAAG9F,UAAUyJ,QAAQtF,KAAK2B,GAAG9F,UAAW,MAAM,GAC1C8F,GAAG9F,UAAUK,QAAQJ,UAAUyJ,QAC/B5D,GAAG9F,UAAU2J,kBAElB,KAAOC,SAAS,GAEnB5I,MAAKjB,WAAW0E,UAAU,IAAK8E;;AQjEnC,YACA,IAAIjK,QAASR,QAAQ,YAErBI,QAAOC,QAAU,SAAUkB,SACvB,GAAIX,WASAgB,QAAQ,EAMRT,WAKIyJ,QAAQ,EAKRxJ,OAAO,EAMPsJ,SAAU,KAIlB,IAAI2E,gBAAiB3O,EAAEc,QAAO,KAAUZ,SAAUW,QAClDW,MAAKX,QAAU8N,cAEf,IAAI9E,IAAK8E,eAAevO,IAAII,WAE5B,IAAIoO,eAGJ,IAAIC,SAAU,WACV,OAAO,EAGX,IAAIC,mBAAoB,SAAUC,KAC9B,GAAIC,OAAQD,IAAI1M,MAAM,WAItB,OAHA2M,OAAQ5N,EAAEiH,IAAI2G,MAAO,SAAU9H,KAC3B,MAAOA,KAAIqG,UAAU,EAAGrG,IAAI/B,OAAS,KAM7C,IAAI8J,aAAc,SAAUC,uBAAwBC,QAEhD,GAAIC,oBAEJ,IAAIC,gBAEJjO,GAAEgD,KAAK8K,uBAAwB,SAAUI,eACrC,GAAIN,OAAQF,kBAAkBQ,cAC9B,IAAIC,eAAgBD,aAChBN,QAASA,MAAM7J,SACfnF,EAAEoE,KAAK4K,MAAO,SAAU3K,MAAOmL,eAC3B,GAAIC,SAAUN,OAAOK,cACL,QAAZC,SAAgCC,SAAZD,UAChBrO,EAAEC,QAAQoO,WAEVA,QAAUA,QAAQA,QAAQtK,OAAS,IAGvCmK,cAAgBA,cAAc9K,QAAQ,IAAMgL,cAAgB,IAAKC,YAGzEL,iBAAiBE,eAAkBF,iBAAiBE,gBAAmBC,eAAelK,OAAO+J,iBAAiBE,gBAAkBC,eAEpIF,aAAaE,eAAiBD,eAGlC,IAAIK,KACAN,aAAcA,aACdD,iBAAkBA,iBAEtB,OAAOO,IAGX,IAAIrM,YAEAI,WACIoL,kBAAmBA,kBACnBG,YAAaA,YACbL,YAAaA,YACb/N,QAAS8N,gBAGbiB,iBAEAC,aAEAC,eAAgB,SAAUC,OACtB,MAAIA,OACO3O,EAAE0K,OAAOtK,KAAKoO,cAAe,SAAU/K,MAC1C,MAAOzD,GAAEE,SAASuD,KAAKsB,OAAQ4J,SAG5BvO,KAAKoO,eAGpBI,aAAc,WACV,MAAO5O,GAAEI,KAAKoO,eAAeK,MAAM,UAAUC,UAAUC,OAAO1K,SAElE2K,qBAAsB,SAAUxF,MACvBA,OACDA,KAAOpJ,KAAKwO,eAEhB,IAAIK,aAOJ,OANAjP,GAAEgD,KAAKwG,KAAM,SAAU0F,OACnB,GAAItB,OAAQF,kBAAkBwB,MAC1BtB,OAAM7J,SACNkL,UAAYjP,EAAE+O,KAAKE,UAAUhL,OAAO2J,WAGrCqB,WAGXE,yBAA0B,SAAUpK,OAAQtF,SAIxC,GAHIsF,SACA3E,KAAKqO,UAAYzO,EAAE+O,KAAK3O,KAAKqO,UAAUxK,OAAOc,WAE7CwI,eAAelO,UAAUyJ,SAAWyE,eAAelO,UAAUC,QAAUc,KAAKqO,UAAU1K,OACvF,OAAO,CAEX,KAAK3D,KAAKgP,eAAgB,CACtB,GAAIC,iBAAkBzQ,EAAEc,QAAO,MAC3B4P,QAA6C,EAApC/B,eAAelO,UAAUuJ,SAClCI,SAAS,GACVvJ,QAEHW,MAAKgP,eAAiBpP,EAAE4I,SAAS,WAC7BxI,KAAKmP,MAAMnP,KAAKqO,WAAWrG,KAAK,SAAUoH,SACtC5Q,EAAEc,OAAO8N,YAAagC,SACtBpP,KAAKqO,aACLrO,KAAKqP,OAAOD,UACdrJ,KAAK/F,QACRmN,eAAelO,UAAUuJ,SAAUyG,iBAG1CjP,KAAKgP,eAAerK,SAGxBwK,MAAO,SAAUG,eAEbA,iBAAmBzL,OAAOyL,cAC1B,IAAIC,gBAAiBvP,KAAK4O,qBAAqBU,cAC/C,IAAIE,cAAe,SAAUC,KAAM7B,kBAC/B,MAAOvF,IAAGqH,MAAMD,MAAMzH,KAAK,SAAUhJ,WAEjC,GAAI2Q,aAaJ,OAZA/P,GAAEgD,KAAK5D,UAAW,SAAUiF,MAAO6K,OAC/B,GAAIc,UAAWxC,YAAY0B,MAC3B,KAAKzB,QAAQpJ,MAAO2L,YAChBD,UAAUb,OAAS7K,MACf2J,kBAAoBA,iBAAiBkB,QAAQ,CAC7C,GAAIjI,QAAShD,OAAO+J,iBAAiBkB,OACrClP,GAAEgD,KAAKiE,IAAK,SAAUgJ,kBAClBF,UAAUE,kBAAoB5L,WAKvC0L,YAGf,OAAIJ,gBAAe5L,OACR0E,GAAGqH,MAAMH,gBAAgBvH,KAAK,SAAUuH,gBAE3C/Q,EAAEc,OAAO8N,YAAamC,eACtB,IAAIO,IAAMrC,YAAY6B,cAAeC,eACrC,OAAOC,cAAa5P,EAAE+N,OAAOmC,GAAGjC,cAAeiC,GAAGlC,oBAG/C4B,aAAaF,gBAI5B3G,eAAgB,WACZwE,eAAelO,UAAUC,OAAQ,EACjCc,KAAK+O,4BAGTgB,cAAe,WACX5C,eAAelO,UAAUC,OAAQ,GAQrCuJ,QAAS,SAAUuH,WAAYC,OAC3B,GAAInL,IAAK9E,IACT,IAAIN,QAASyN,eAAezN,MAC5B,IAAIwQ,kBAAmBtQ,EAAEC,QAAQmQ,YAAeA,WAAapQ,EAAEgB,KAAKoP,WAEpE,IAAIG,eAAgBzQ,UAAW,CAQ/B,IAPIE,EAAEC,QAAQH,SAAWwQ,mBACrBC,cAAgBvQ,EAAEwQ,aAAa1Q,OAAQwQ,kBAAkBvM,QAAU,GAEnEnF,EAAEkI,cAAchH,SAAWwQ,mBAC3BC,cAAgBvQ,EAAEwQ,aAAa1Q,OAAO2Q,OAAQH,kBAAkBvM,SAAWuM,iBAAiBvM,QAG5FwM,eAAiBF,SAAU,EAC3B,MAAOzR,GAAE8R,WAAWC,UAAUC,SAGlC,IAAIxR,WAAYgB,KAAKwO,cAGrB,OAFA1J,IAAGuJ,aAEIrO,KAAKmP,MAAMnQ,WAAWgJ,KAAK,SAAU2H,WACxCnR,EAAEc,OAAO8N,YAAauC,WACtB7K,GAAGuK,OAAOM,cAIlBN,OAAQ,SAAU1K,OAAQV,OACtB,GAAIwM,YAAa,SAAUlL,OAAQqB,QAC3BhH,EAAEuI,WAAW5C,QACbA,OAAOpC,KAAK,KAAMyD,QAElBrB,OAAON,QAAQ3G,OAAO6G,OAAOc,MAAOW,QAIvCpI,GAAEkI,cAAc/B,UACjBA,OAAS/E,EAAE8Q,QAAQ/L,SAAUV,SAEjCrE,EAAEgD,KAAK5C,KAAKoO,cAAe,SAAUuC,cACjC,GAAIpL,QAASoL,aAAapL,MAC1B,IAAIoL,aAAajM,MAAO,CACpB,GAAIkM,gBAAiBhR,EAAEyG,KAAK1B,OAAQgM,aAAahM,OAC7C/E,GAAEiR,KAAKD,kBAAoBhR,EAAEiR,KAAKF,aAAahM,SAC/C8L,WAAWlL,OAAQqL,oBAGvBhR,GAAEgD,KAAK+N,aAAahM,OAAQ,SAAU4J,OAClC,GAAIqC,gBAAiBhR,EAAEyG,KAAK1B,OAAQ4J,MAChC3O,GAAEiR,KAAKD,iBACPH,WAAWlL,OAAQqL,qBAcvC5K,QAAS,SAAU8K,SAAU7M,MAAO5E,SAEhC,GAAI0R,MACAvS,GAAEkI,cAAcoK,WAChBC,MAAQD,SACRzR,QAAU4E,QAET8M,UAAYD,UAAY7M,KAE7B,IAAI+M,IAAKvD,YAAY7N,EAAEgB,KAAKmQ,OAAQ3D,YAEpC,IAAI6D,UACJrR,GAAEgD,KAAKmO,MAAO,SAAUrL,IAAK3E,MAC1B,GAAI4E,KAAOqL,GAAGnD,aAAa9M,MAASiQ,GAAGnD,aAAa9M,MAAQA,IAC5DkQ,QAAOtL,KAAOD,KAEjB,IAAIZ,IAAK9E,IACT,OAAOqI,IAAG6I,KAAK/N,KAAKkF,GAAI4I,QACnBjJ,KAAK,WACG3I,SAAYA,QAAQK,QACrBoF,GAAG2D,QAAQtF,KAAK2B,GAAIiM,UAcpCtN,UAAW,SAAUkB,OAAQwM,WAAY9R,SAErC,GAAIX,WACAgG,OAAO,EAGXC,WAAYd,OAAOc,QAEdwM,WAAW/L,IAAOxF,EAAEuI,WAAWgJ,cAChCA,WAAa3S,EAAE2S,YAGnB,IAAIC,IAAMxR,EAAEyR,SAAS,sBACrB,IAAI5S,MAAOD,EAAEc,QACT8R,GAAIA,GACJzM,OAAQA,OACRY,OAAQ4L,YACTzS,SAAUW,QAKb,OAHAW,MAAKoO,cAAc5K,KAAK/E,MAExBuB,KAAK+O,yBAAyBpK,QACvByM,IAOX9N,YAAa,SAAUgO,OACnBtR,KAAKoO,cAAgBxO,EAAE2R,OAAOvR,KAAKoO,cAAe,SAAU/K,MACxD,MAAOA,MAAK+N,KAAOE,SAQ3BE,eAAgB,WACZxR,KAAKoO,kBAIb5P,GAAEc,OAAOU,KAAM8B;;AP3VnB5D,OAAOC,SACHqC,OAAQ,IACRqI,YAAa,OAEbC,WAAY,SAEZ3D,QACIF,QAAS,cACTgB,MAAO;;AWRf,YACA,IAAImD,QAEIuB,MAAO,OACPE,YAAY,EACZvE,QAAS,SAAUZ,KACf,SAAU7B,OAAO6B,QAIrBiF,MAAO,OACPE,YAAY,EACZvE,QAAS,SAAUZ,KAEf,MADAA,QAAS7B,OAAO6B,KACTA,IAAIA,IAAI/B,OAAS,MAI5BgH,MAAO,UACPE,YAAY,EACZvE,QAAS,SAAUZ,KAEf,MADAA,QAAS7B,OAAO6B,KACTA,IAAIiE,aAIfgB,MAAO,QACPE,YAAY,EACZvE,QAAS,SAAUZ,KAEf,MADAA,QAAS7B,OAAO6B,KACTA,IAAI,MAIfiF,MAAO,WACPE,YAAY,EACZvE,QAAS,SAAUZ,KAEf,MADAA,QAAS7B,OAAO6B,KACRA,IAAI/B,QAAU,EAAK+B,IAAI,GAAKA,IAAIA,IAAI/B,OAAS,KAKjE/D,GAAEgD,KAAKwG,KAAM,SAAUyJ,MACpB,GAAIC,OAAQD,KAAKvM,OACjB,IAAIyM,OAAQ,SAAUrN,KAClB,MAAIlH,GAAEkI,cAAchB,KACR9F,EAAE6L,UAAU/F,IAAKoN,OAEjBA,MAAMpN,KAGtBmN,MAAKvM,QAAUyM,QAElB7U,OAAOC,QAAUiL;;ARtDjB,YAIA,IAAIL,WAAY,SAAU4B,MAAOC,UAAWC,YACxC,GAAIC,OA2BJ,OAzBIlL,GAAEuI,WAAWyC,WACbE,IAAItH,MACAmH,MAAOA,MACPrE,QAASsE,UACTC,WAAYA,aAETrM,EAAEkI,cAAckE,YAAcA,UAAUtE,SAC/CsE,UAAUD,MAAQA,MAClBC,UAAUC,WAAaA,WACvBC,IAAItH,KAAKoH,YACFpM,EAAEkI,cAAciE,SAEnBA,MAAMrE,QACNwE,IAAItH,KAAKmH,OAGTnM,EAAEoE,KAAK+H,MAAO,SAAUhF,IAAKD,KACzBoF,IAAItH,MACAmH,MAAOhF,IACPW,QAASZ,IACTmF,WAAYA,gBAKrBC,IAGX,IAAIC,gBAAiB,SAAUJ,MAAOC,WAClC,MAAIhL,GAAEuJ,SAASyB,UAAUD,OACdA,QAAUC,UAAUD,MACpB/K,EAAEuI,WAAWyC,UAAUD,OACvBC,UAAUD,MAAMA,OAChB/K,EAAEoL,QAAQJ,UAAUD,OACpBC,UAAUD,MAAM9J,MAAM8J,QAE1B,EAGX,IAAIxK,mBACA+B,WACI6I,eAAgBA,gBAGpB3B,QAOAC,SAAU,SAAUsB,MAAOC,UAAWC,YAClC,GAAII,YAAalC,UAAU4B,MAAOC,UAAWC,WAC7C7K,MAAKoJ,KAAO6B,WAAWpH,OAAO7D,KAAKoJ,OAGvCpG,QAAS,SAAU2H,MAAOC,WACtB,GAAI/H,MACJjD,GAAEgD,KAAK5C,KAAKoJ,KAAM,SAAU8B,iBAAkB1B,GAC1C,MAAIuB,gBAAeJ,MAAOO,mBACtBrI,MAAQ2G,GACD,GAFX,SAKJxJ,KAAKoJ,KAAKK,OAAO5G,MAAO,EAAGkG,UAAU4B,MAAOC,WAAW,KAG3DO,aAAc,SAAUR,OACpB,MAAO/K,GAAEkB,KAAKd,KAAKoJ,KAAM,SAAUwB,WAC/B,MAAOG,gBAAeJ,MAAOC,cAUrCtE,QAAS,SAAUrC,MAAOmF,MACtB,IAAKA,OAASA,KAAKzF,OACf,MAAOM,MAEXmF,SAAUvF,OAAOuF,MACjBA,KAAOxJ,EAAEyE,OAAO+E,KAAM,OAEtB,IAAIgC,cAAenH,KACnB,IAAIa,IAAK9E,IAET,IAAIqL,cAAe,SAAUT,UAAWlF,IAAK4F,eACzC,MAAO1L,GAAEiH,IAAInB,IAAK,SAAU6F,GACxB,MAAOX,WAAUtE,QAAQiF,EAAGD,iBAGpC,IAAIE,eAAgB,SAAUZ,UAAW3G,MAAOqH,eAC5C,MAAO1L,GAAE6L,UAAUxH,MAAO,SAAUyB,KACjC,MAAOY,SAAQsE,UAAWlF,IAAK4F,iBAGtC,IAAIhF,SAAU,SAAUsE,UAAW3G,MAAOqH,eACtC,GAAII,UAMJ,OAJIA,WADA9L,EAAEC,QAAQoE,QAAU2G,UAAUC,cAAe,EACjCQ,aAAaT,UAAW3G,MAAOqH,eAE/BV,UAAUtE,QAAQrC,MAAOqH,eAe7C,OAXA1L,GAAEgD,KAAKwG,KAAM,SAAUkC,eACnB,GAAIV,WAAY9F,GAAGqG,aAAaG,cAChC,KAAKV,UACD,KAAM,IAAI/I,OAAM,yCAA2CyJ,cAG3DF,cADA5M,EAAEkI,cAAc0E,eAAiBR,UAAUC,cAAe,EAC3CW,cAAcZ,UAAWQ,aAAcE,eAEvChF,QAAQsE,UAAWQ,aAAcE,iBAGjDF,cASXvF,MAAO,SAAU5B,MAAOmF,MACpB,IAAKA,OAASA,KAAKzF,OACf,MAAOM,MAEXmF,SAAUvF,OAAOuF,MAAMO,UACvBP,KAAOxJ,EAAEyE,OAAO+E,KAAM,OAEtB,IAAIgC,cAAenH,KACnB,IAAIa,IAAK9E,IAOT,OANAJ,GAAEgD,KAAKwG,KAAM,SAAUkC,eACnB,GAAIV,WAAY9F,GAAGqG,aAAaG,cAC5BV,WAAU/E,QACVuF,aAAeR,UAAU/E,MAAMuF,aAAcE,kBAG9CF,cAMf,IAAIO,oBACA7N,QAAQ,sBACRA,QAAQ,sBACRA,QAAQ,qBACRA,QAAQ,gCACRA,QAAQ,4BAGZU,GAAEoE,KAAK+I,kBAAkBhC,UAAW,SAAU9G,MAAO+H,WAC7ChL,EAAEC,QAAQ+K,WACVhL,EAAEgD,KAAKgI,UAAW,SAAUgB,GACzBzL,iBAAiBkJ,SAASuC,KAG7BzL,iBAAiBkJ,SAASuB,aAIlC1M,OAAOC,QAAUgC;;AM9KjB,YACAjC,QAAOC,SACHwM,MAAO,IACPrE,QAAS,SAAUrC,OACf,MAAOoO,YAAWpO,MAAO;;AIJjC,YACA/F,QAAOC,SACHwM,MAAO,SAAUzC,MAEb,MAA8B,KAAtBA,KAAKlH,QAAQ,MAAqC,KAAtBkH,KAAKlH,QAAQ,MAGrD6E,MAAO,SAAUH,KACbA,KAAM,EACN,IAAIuN,YAA+B,MAAlBvN,IAAIoG,OAAO,EAE5BpG,KAAOA,IAAI1C,QAAQ,KAAM,GACzB,IAAIkQ,cAAe,mCACnB,IAAIC,SAAUD,aAAaE,KAAK1N,IAChC,IAAI2N,QAAQC,OAAS,EAQrB,QAPIH,SAAWA,QAAQ,KACnBE,OAASF,QAAQ,IAEjBA,SAAWA,QAAQ,KACnBG,OAASH,QAAQ,GAAG3M,eAGhB8M,QACJ,IAAK,IACDD,QAAkB,GAClB,MACJ,KAAK,IACDA,OAAkB,IAATA,MACT,MACJ,KAAK,IACDA,OAAkB,IAATA,MACT,MACJ,KAAK,IACDA,OAAkB,IAATA,OAOjB,MAJAA,QAAShB,WAAWgB,QAChBJ,YAAcI,OAAS,IACvBA,OAAkB,GAATA,QAENA,QAGX/M,QAAU,WAGN,QAASiN,WAAUtP,MAAOuP,QACtBvP,MAAkB,IAAVA,MAAc,EAAIwP,QAAQxP,MAAOyP,KAAKC,IAAI,EAAGH,OAASE,KAAKE,KAAKF,KAAKG,IAAI5P,OAASyP,KAAKI,OAE/F,IAAIC,KAAM,EACV,IAAIC,WAAY/P,MAAMgQ,UACtB,IAAIC,aAAa,CAEjB,KAAK,GAAIC,MAAO,EAAGA,KAAOH,UAAUrQ,OAAQwQ,OAQxC,GAPAJ,KAAOC,UAAUlI,OAAOqI,MACO,MAA3BH,UAAUlI,OAAOqI,MACjBD,YAAa,EAEbV,SAGU,GAAVA,OACA,MAAOO,IAOf,KAHKG,aACDH,KAAO,KAEJP,OAAS,GACZO,KAAO,IACPP,QAEJ,OAAOO,KAGX,QAASK,aAAYnQ,MAAOoQ,SAAUC,YAAaC,WAC/CA,UAAYA,YAAa,CACzB,IAAIP,WAAY/P,MAAMgQ,UACtB,IAAIO,aAAeR,UAAU1P,MAAM,KAAKX,OAAS,CACjD,IAAI8Q,MAAO,CAEX,IAAIF,UACA,IAAK,GAAIG,OAAQV,UAAUrQ,OAAS,EAAG+Q,MAAQ,EAAGA,QAC1CF,YACAA,YAA2C,MAA5BR,UAAUlI,OAAO4I,QAEhCD,MAAQA,KAAO,GAAK,EACP,IAATA,OACAT,UAAYA,UAAUpB,OAAO,EAAG8B,OAAS,IAAMV,UAAUpB,OAAO8B,QAMhF,IAAIL,SAAW,EAAG,CACd,GAAIM,MAUJ,KATIX,UAAU1P,MAAM,KAAKX,QAAU,GAC/BgR,MAAQL,YACJK,MAAQ,IACRX,WAAa,MAGjBW,MAAQL,YAAcN,UAAU1P,MAAM,KAAK,GAAGX,OAG3CgR,MAAQ,GACXX,WAAa,IACbW,QAGR,MAAOX,WAGX,QAASP,SAAQxP,MAAOuP,QACpB,MAAOE,MAAKkB,MAAM3Q,MAAQyP,KAAKmB,IAAI,GAAIrB,SAAWE,KAAKmB,IAAI,GAAIrB,QAGnE,QAASsB,WAAUC,WACfA,UAAYA,UAAU/R,QAAQ,IAAK,GACnC,IAAIgS,UAAWD,UAAUzQ,MAAM,GAAI2Q,QAAO,WAAY,KACtD,OAAQD,UAASrR,OAAS,EAAKqR,SAAS,GAAGf,WAAa,GAG5D,QAASiB,YAAWC,QAChB,GAAI7C,GAAI9T,EAAEoH,KAAKuP,OAEf,OAAU,MAAN7C,GACM,QAANA,GACM,OAANA,GACM,OAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,OAANA,GACM,OAANA,GACM,QAANA,GACM,OAANA,GACM,QAANA,GACM,QAANA,GAEO,GAGJ,EAGX,QAAS8C,QAAO/B,OAAQ0B,WAIpB,GAHInV,EAAEC,QAAQwT,UACVA,OAASA,OAAOA,OAAO1P,OAAS,KAE/B/D,EAAEuJ,SAASkK,UAAYzT,EAAEyV,SAAShC,QACnC,MAAOA,OAGX,KAAK0B,WAAyC,YAA5BA,UAAUvO,cACxB,MAAO6M,QAAOY,UAGlB,IAAIqB,MAAMjC,QACN,MAAO,GAIX0B,WAAYA,UAAU/R,QAAQ,SAAU,MAGxC,IAAIuS,SAAUR,UAAUzQ,MAAM,IAC9B,IAAIiR,QAAQ5R,OAAS,EACjB,MAAOyR,QAAO1B,KAAK8B,IAAInC,QAASkC,QAAUlC,QAAU,EAAK,EAAI,GAIjE,IAAIoC,MAAQpC,QAAU,EAAK,GAAK,GAChCA,QAASK,KAAK8B,IAAInC,OAGlB,IAAIqC,eAAgBX,SACpB,IAAIY,GAAID,cAAc1U,QAAQ,IAC1B2U,GAAI,KACJD,cAAgBA,cAAc3J,UAAU,EAAG4J,GAG/C,IAAI1K,YAAayK,cAAclP,aAC/B,IAAI3D,OAAQoI,WAAW2K,YAAY,IACnC,IAAIC,eAAgBhT,MAAQ,EAE5B,IAAIgT,cAAe,CACf,GAAIC,UAAWJ,cAAc5J,OAAOjJ,MAAQ,EAC3B,OAAbiT,WACAD,eAAgB,GAIxB,GAAIE,aAAcF,cAAgBd,UAAUhJ,UAAU,EAAGlJ,OAAS,EAClE,IAAImT,eAAgCjB,UAAUnC,OAA1BiD,cAAiChT,MAAQ,EAAsBA,MAGnF,IAAIgT,cAAe,CACf,GAAII,iBAAkB,SACtB,IAAIC,uBAAwBF,cAAcnV,MAAMoV,gBAC3CC,wBAA0D,IAAjCA,sBAAsBvS,SAEhDkS,eAAgB,EAChBE,YAAc,IAKtB,GAAIF,cAAe,CACf,GAAIM,UAAsB,IAAX9C,OAAe,EAAIK,KAAK0C,MAAM1C,KAAKG,IAAIH,KAAK8B,IAAInC,UAAY,EAAIK,KAAKI,MAOpF,IANAqC,SAAa9C,OAASK,KAAKmB,IAAI,GAAI,EAAIsB,UAAa,IAAQA,SAAYA,SAAW,EACnFA,SAAWzC,KAAKC,IAAIwC,SAAU,GAC9BA,SAAWzC,KAAK2C,IAAIF,SAAU,GAC9B9C,QAAkBK,KAAKmB,IAAI,GAAI,EAAIsB,UAG9Bb,MAAMgB,OAAON,iBAAkD,KAA/BA,cAAchV,QAAQ,KAepD,CAEH+T,UAAYA,UAAUnC,OAAO/P,MAAQ,EACrC,IAAI0T,QAASzB,UAAUC,UACvBA,WAAYA,UAAUnC,OAAO,EAAGmC,UAAUpR,OAAS4S,OAAO5S,OAE1D,IAAI6S,mBAAoBpB,QAAkB,KAATK,KAAe,EAAI,IAAMpC,OAAQ0B,WAAa0B,OAAON,UAAYI,MAClG,OAAIrB,YAAWa,cAAyB,KAATN,MAC3Be,kBAAoBA,kBAAkB5D,OAAO6C,KAAK9R,QAC3C8R,KAAOM,YAAcS,mBAGzBT,YAAcS,kBA1BrB,GAAIE,aAAcJ,OAAON,cACzB,OAAI3C,QAASK,KAAKmB,IAAI,GAAI6B,aAClBxB,WAAWa,aACJN,KAAOM,YAAcxC,UAAUF,OAAQiD,OAAON,gBAAkBS,OAAON,UAEvEJ,YAAcN,KAAOlC,UAAUF,OAAQiD,OAAON,gBAAkBS,OAAON,UAG9EjB,WAAWa,aACJN,KAAOM,YAAcrC,KAAKkB,MAAMvB,QAAUoD,OAAON,UAEjDJ,YAAcN,KAAO/B,KAAKkB,MAAMvB,QAAUoD,OAAON,UAmBxE,GAAIQ,YAAa5B,UAAUzQ,MAAM,IACjC,IAAI+P,SACJ,IAAIC,YACAqC,YAAWhT,OAAS,GACpB0Q,SAAWsC,WAAW,GAAGhT,OAASgT,WAAW,GAAG3T,QAAQ,GAAIiS,QAAO,SAAU,KAAM,IAAItR,OACvF2Q,YAAcqC,WAAW,GAAGhT,OAASgT,WAAW,GAAG3T,QAAQ,GAAIiS,QAAO,KAAM,KAAM,IAAItR,OACtFoR,UAAY4B,WAAW,GAAKA,WAAW,GAAG3T,QAAQ,GAAIiS,QAAO,SAAU,KAAM,KAE7EZ,SAAW,CAGf,IAAIW,UAAWD,UAAUzQ,MAAM,GAAI2Q,QAAO,WAAY,KACtD,IAAI2B,SAAU5B,SAAS,GAAGf,UAC1B,IAAIX,QAAU0B,SAASrR,OAAS,EAAKqR,SAAS,GAAGf,WAAa,EAE9DZ,SAAoB0B,UAAUzQ,MAAM,KAAKX,OAAS,EAAK,IAAM,EAE7D0P,OAASI,QAAQJ,OAAQgB,UAEzBoB,KAAmB,IAAXpC,OAAgB,GAAKoC,IAE7B,IAAIlB,WAA2E,MAA9DQ,UAAUnC,OAAOmC,UAAUpR,OAAS,EAAI2P,OAAO3P,OAAQ,EACxE,IAAIkT,WAAYpB,KAAOmB,QAAUxC,YAAYf,OAAQgB,SAAUC,YAAaC,WAAajB,MAGzF,OAAOuD,WArOX,GAAIJ,SAAU,GAAI,IAAK,IAAK,IAAK,IAwOjC,OAAOrB;;AHpRf,YACAlX,QAAOC,SACHmU,EAAG,SAAU5M,KACT,MAAOA,KAAM,IAGjB6M,UAAW,SAAU7M,KACjB,OAAQA,IAAM,IAAI8M,eAEtBC,UAAW,SAAU/M,KACjB,OAAQA,IAAM,IAAIc,eAEtBkM,UAAW,SAAUhN,KAEjB,MADAA,MAAY,GACLA,IAAI1C,QAAQ,SAAU,SAAU2P,KAAM,MAAOA,KAAI7G,OAAO,GAAG0G,cAAgBG,IAAIC,OAAO,GAAGpM;;AEdxG,YACA,IAAI4C,QAEJ,IAAI4J,YACA,SAAU,OAAQ,UAAW,aAC7B,UAAW,OACX,QACA,OAAQ,MAAO,UACf,MAAO,MAEXpT,GAAEgD,KAAKoQ,UAAW,SAAUvL,IACxB,GAAIoL,OACAlI,MAAOlD,GACPoD,YAAY,EACZvE,QAAS,SAAUZ,KACf,MAAIlH,GAAEkI,cAAchB,KACT9F,EAAE6L,UAAU/F,IAAK9F,EAAE6H,KAEnB7H,EAAE6H,IAAI/B,MAIzB0D,MAAK5F,KAAKqP,QAEd3U,OAAOC,QAAUiL;;AVxBjB,YAEA,IAAIM,kBACA5L,QAAQ,gBACRA,QAAQ,4BACRA,QAAQ,+BACRA,QAAQ,kCACRA,QAAQ,oCACRA,QAAQ,2BACRA,QAAQ,gBACRA,QAAQ,2BACRA,QAAQ,2BACRA,QAAQ,6BACRA,QAAQ,kBAGZ,IAAI8L,gBAEJ,IAAIb,WAAY,SAAUc,iBAAkBC,YAAa7G,SASrD,MARK6G,eACDA,YAAc,KAEdlK,EAAEuI,WAAWlF,WACbA,SACIR,OAAQQ,UAGTzE,EAAEc,OAAO2D,SAAW8G,KAAMF,iBAAkBtE,OAAQuE,cAG/DtL,GAAEoE,KAAK8G,gBAAiB,SAAU7G,MAAOI,SACrC2G,aAAapG,KAAKuF,UAAU9F,QAAQ8G,KAAM9G,QAAQsC,OAAQtC,WAI9D,IAAI+G,WAAY,SAAUC,UAAWlJ,KAAMqB,KACvC,GAAI8H,UAUJ,OARItK,GAAEuJ,SAASc,WACXC,UAA2B,MAAdD,WAAsBA,UAAUzD,gBAAkBzF,KAAKyF,cAC7D5G,EAAEuI,WAAW8B,WAEpBC,UAAYD,UAAUlJ,KAAMqB,KACrBxC,EAAEuK,SAASF,aAClBC,UAAYnJ,KAAKF,MAAMoJ,YAEpBC,UAGX,IAAIE,WAAY,SAAU7E,OAAQ8E,YAC9B,MAAQzK,GAAEuJ,SAASkB,YAAgBA,aAAe9E,OAAU8E,WAAWhJ,GAAGkE,QAG9ErH,QAAOC,SACHiL,KAAMQ,aAONP,SAAU,WACNO,aAAaN,QAAQP,UAAUd,MAAM,KAAMH,aAS/CwC,OAAQ,SAAUC,WAAYF,YAC1B,GAAIG,UAAW5K,EAAE6K,OAAOb,aAAc,SAAU3G,SAC5C,MAAO+G,WAAU/G,QAAQ8G,KAAMQ,aAOnC,OALIF,cACAG,SAAW5K,EAAE6K,OAAOD,SAAU,SAAUvH,SACpC,MAAOmH,WAAUnH,QAAQsC,OAAQ8E,eAGlCG,UAGXxH,QAAS,SAAUuH,WAAYF,WAAYpH,SACvC,GAAIJ,MACJjD,GAAEgD,KAAKgH,aAAc,SAAUL,eAAgBC,GAC3C,MAAIQ,WAAUT,eAAeQ,KAAMQ,aAAeH,UAAUb,eAAehE,OAAQ8E,aAC/ExH,MAAQ2G,GACD,GAFX,SAKJI,aAAaH,OAAO5G,MAAO,EAAGkG,UAAUwB,WAAYF,WAAYpH,WAGpEV,WAAY,SAAUmI,SAAUtI,KAC5B,GAAIoI,UAAWxK,KAAKsK,OAAOI,SAAUtI,IAErC,OAAOoI,UAAS;;AmBjGxB,YAEAtM,QAAOC,SAEHoH,OAAQ,mBAERwE,KAAM,OAENtH,OAAQ,SAAUwB,OACVrE,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,GAEjC,IAAI6U,eAAgBxY,KAAKe,KAAK,QAE9B,IAAI0X,WAA+BvK,SAAlBsK,cAAgCA,eAAiBvU,QAAWA,KAC7EjE,MAAKuG,KAAK,UAAWkS;;AKf7B,YAEAva,QAAOC,SAEHoH,OAAQ,IAERwE,KAAM,OAENtH,OAAQ,SAAUwB,OACd,GAAIiU,UACJ,IAAIW,iBAAkB5U,KACtB,KAAKzF,EAAEkI,cAAczC,OAAQ,CACzB,GAAImC,cAAepG,KAAKvB,KAAK,SAC7Boa,kBAAoB5U,MAAOA,OAC3B4U,gBAAgBzS,cAAgBnC,MAEpC,GAAI6U,cAAe9Y,KAAKvB,KAAK,gBAC7B,IAAIqa,aACAZ,UAAYtY,EAAEuY,SAASW,aAAcD,iBACrC7Y,KAAKqY,KAAKH,eACP,CACH,GAAIE,SAAUpY,KAAKqY,MACnB,IAAIC,aAAcF,QAAQpV,QAAQ,QAAS,KAAKA,QAAQ,QAAS,IACjEkV,WAAYtY,EAAEuY,SAASG,YAAaO,iBAChCP,cAAgBJ,WACZtY,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,IAEjCM,OAAS,GACTjE,KAAKqY,KAAKpU,SAEVjE,KAAKvB,KAAK,gBAAiB6Z,aAC3BtY,KAAKqY,KAAKH;;AJhC1B,YAEAha,QAAOC,SACHoH,OAAQ,gBAERwE,KAAM,OAENtH,OAAQ,SAAUwB,OACVrE,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,IAEjC3D,KAAK0F,IAAIzB;;ACXjB,YAEA/F,QAAOC,SAEH4L,KAAM,QAENxE,OAAQ,IAER9C,OAAQ,SAAUwB,MAAOsC,MACjB3G,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,GAGjC,IAAI+U,cAAe1Y,KAAKvB,KAAK,gBACxBia,gBACDA,iBAEAA,aAAanS,OACbvG,KAAK2Y,YAAYD,aAAanS,OAG9B3G,EAAEyV,SAASpR,SACXA,MAAQ,SAAWA,OAEvByU,aAAanS,MAAQtC,MAErBjE,KAAK4Y,SAAS3U,OACdjE,KAAKvB,KAAK,gBAAiBia;;AI3BnC,YAEAxa,QAAOC,SAEH4L,KAAM,IAENxE,OAAQ,IAER9C,OAAQ,SAAUwB,MAAOsC,MACrBvG,KAAKuG,KAAKA,KAAMtC;;ARTxB,YAEA/F,QAAOC,SAEHoH,OAAQ,IAERwE,KAAM,SAAUhJ,MACZ,MAAgC,KAAxBA,KAAKC,QAAQ,QAGzBkC,cAAe,SAAUnC,MACrBA,KAAOA,KAAKiC,QAAQ,MAAO,IAC3BhD,KAAKkF,IAAInE,OAGboD,KAAM,SAAUpD,KAAMkD,OAClBlD,KAAOA,KAAKiC,QAAQ,MAAO,GAC3B,IAAI8B,IAAK9E,IAYT,OAXAA,MAAKkF,IAAInE,MAAMqE,GAAGrE,KAAM,WACpB,GAAIwW,kBAAmB3X,EAAEyE,OAAOJ,MAAMK,MAAM,KAAM,OAClDiT,kBAAmBA,iBAAiB1Q,IAAI,SAAU5C,OAC9C,GAAIuT,QAASvT,MAAMK,MAAM,KAAK,EAC9B,IAAIsC,QAAS3C,MAAM8H,UAAU9H,MAAMjD,QAAQ,KAAO,EAAGiD,MAAMjD,QAAQ,KACnE,IAAIyW,MAA2B,KAAnBjZ,EAAEoH,KAAKgB,QAAkBA,OAAOtC,MAAM,OAClD,QAAS4D,KAAMsP,OAAQ5Q,OAAQ6Q,QAGnC3S,GAAGG,QAAQ,gBAAkBlG,WAAYwY,iBAAkBtF,QAAQ,OAEhE;;AD7Bf,YAEA/T,QAAOC,SAEHoH,OAAQ,IAERwE,KAAM,SAAUhJ,MACZ,MAAoC,KAA5BA,KAAKC,QAAQ,YAGzBmD,KAAM,SAAUpD,KAAMkD,OAClBlD,KAAOA,KAAKiC,QAAQ,UAAW,GAC/B,IAAI8B,IAAK9E,IAYT,OAXAxB,GAAE,WACE,GAAI+Y,kBAAmB3X,EAAEyE,OAAOJ,MAAMK,MAAM,KAAM,OAClDiT,kBAAmBA,iBAAiB1Q,IAAI,SAAU5C,OAC9C,GAAIuT,QAASvT,MAAMK,MAAM,KAAK,EAC9B,IAAIsC,QAAS3C,MAAM8H,UAAU9H,MAAMjD,QAAQ,KAAO,EAAGiD,MAAMjD,QAAQ,KACnE,IAAIyW,MAA2B,KAAnBjZ,EAAEoH,KAAKgB,QAAkBA,OAAOtC,MAAM,OAClD,QAAS4D,KAAMsP,OAAQ5Q,OAAQ6Q,QAGnC3S,GAAGG,QAAQ,gBAAkBlG,WAAYwY,iBAAkBtF,QAAQ,OAEhE;;AExBf,YACA,IAAI7R,YAAatC,QAAQ,6BACzBI,QAAOC,SAEH4L,KAAM,UAENxE,OAAQ,IAER9C,OAAQ,SAAUwB,OACdA,MAASzF,EAAEkI,cAAczC,OAASA,SAAWJ,OAAOI,MACpD,IAAIyT,eAAgB1X,KAAKvB,KAAK,mBACzBiZ,iBACDA,cAAgB1X,KAAK2X,WACrB3X,KAAKvB,KAAK,mBAAoBiZ,eAElC,IAAIE,KAAM5X,KAAK6X,OACfjY,GAAEgD,KAAKqB,MAAO,SAAU6T,QAASC,SAC7BD,SAAoB,EACpB,IAAI/V,OAAQ2V,cAAcM,OAC1BjW,OAAMa,KAAK,SAAU4G,EAAGyO,SACpBA,QAAUzZ,EAAEyZ,SACZrY,EAAEgD,KAAKqV,QAAQxZ,OAAQ,SAAUiH,IAAKC,KAClC,GAAIuS,WAAatY,EAAEuY,SAASzS,KAAOzB,MAAO6T,QAASjV,MAAOkV,QAASpS,IAAKoS,SACxEE,SAAQxZ,KAAKkH,IAAKvF,WAAW0F,eAAeoS,aAEhD,IAAIE,SAAUH,QAAQI,MACtB,IAAIC,aAAcF,QAAQpV,QAAQ,QAAS,KAAKA,QAAQ,QAAS,IACjE,IAAIkV,WAAYtY,EAAEuY,SAASG,aAAerU,MAAO6T,QAASnS,IAAKoS,QAASlV,MAAOkV,SAE3EE,SAAQI,KADRC,cAAgBJ,UACHJ,QAEAI,WAEjBN,IAAIW,OAAON;;AKjC3B,YAEA/Z,QAAOC,SAEHoH,OAAQ,IAERwE,KAAM,kCAENtH,OAAQ,SAAUwB,MAAOsC,MACjB3G,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,IAEjC3D,KAAKuG,KAAKA,MAAOtC;;ARZzB,YAGA/F,QAAOC,SAEHoH,OAAQ,IAERwE,KAAM,uBAENtH,OAAQjE,EAAE8Y,KAEVnT,KAAM,WACF,OAAO;;AOZf,YAEAjG,QAAOC,SACHoH,OAAQ,IAERwE,KAAM,2GAENtH,OAAQ,SAAUwB,MAAOsC,MACjB3G,EAAEC,QAAQoE,SACVA,MAAQA,MAAMA,MAAMN,OAAS,GAGjC,IAAI+B,KAAO1F,KAAKe,KAAK,SAAakD,OAASjE,KAAKuG,KAAK,WAActC,KACnEjE,MAAKuG,KAAKA,KAAMb;;A1BbxBxH,OAAOC,QAAW,WACd,YACA,IAAIG,QAASR,QAAQ,YAErB,IAAImC,aAAcnC,QAAQ,uBAC1B,IAAIoC,aAAcpC,QAAQ,iCAC1B,IAAIqC,kBAAmBrC,QAAQ,kCAE/B,IAAIsC,YAAatC,QAAQ,uBACzB,IAAIuC,UAAWvC,QAAQ,eAEvB,IAAIwC,kBAAmBxC,QAAQ,iCAG/BU,GAAE+B,KAAK,KAAKjC,OAAOkC,QAAU,SAAUC,KACnC,GAAIC,OAAQlC,EAAEiC,IACd,IAAIE,WAAYf,EAAEgB,KAAKF,MAAMjC,OAE7B,IAAIoC,OAAQjB,EAAEkB,KAAKH,UAAW,SAAUI,MACpC,MAAwC,KAAhCA,KAAKC,QAAQ1C,OAAOkC,SAGhC,SAAS,OAGbhC,EAAE+B,KAAK,KAAKU,aAAe,SAAUR,KACjC,MAAqC,KAA9BA,IAAIS,SAASF,QAAQ,KAGhC,IAAIG,qBAAsB,SAAUhC,MAChC,GAAII,OAAQf,EAAEW,KACd,IAAIiC,iBAAkB7B,MAAMuB,KAAK,IAAMxC,OAAOkC,OAI9C,OAHIjB,OAAM8B,GAAG,IAAM/C,OAAOkC,UACtBY,gBAAkBA,gBAAgBE,IAAI/B,QAEnC6B,gBAGX,IAAIG,mBAAoB,SAAUC,QAASC,SAIvC,GAHID,kBAAmBhD,KACnBgD,QAAUA,QAAQE,IAAI,KAErBF,UAAYA,QAAQN,SAErB,KADAS,SAAQC,MAAMH,QAAS,oCAAqCD,SACtD,GAAIK,OAAMJ,QAAU,2CAA+CD,SAE7E,OAAOA,SAGX,IAAIM,YAEAC,MAAO9B,YACP+B,WAAY9B,YACZ+B,WAAY9B,iBAEZ+B,WACId,oBAGJe,cAAe,SAAUX,QAAS7C,SACzBA,UACDA,QAAUqB,KAAKX,QAAQV,QAAQK,WAEnCwC,QAAUD,kBAAkBC,QAC5B,IAAIY,KAAM5D,EAAEgD,QACZ,KAAKY,IAAIf,GAAG,IAAM/C,OAAOkC,QACrB,OAAO,CAEXR,MAAKkC,QAAQd,gBAAkBxB,EAAEyC,QAAQrC,KAAKkC,QAAQd,gBAAiBI,QAGvE,IAAIc,SAAUrC,YAAYsC,WAAWH,IACrC,IAAII,GAAI,GAAIF,SAAQG,QAChBC,GAAIlB,SAEJgB,GAAEG,cACFH,EAAEG,eAGNnE,EAAEgD,QAAQQ,YAAYY,KAAK,SAAUC,MAAOC,SACxC,GAAI/B,MAAO+B,QAAQ5B,QACnB,IAAI6B,cAAe,SACnB,IAAmC,IAA/BhC,KAAKC,QAAQ+B,cAAqB,CAClChC,KAAOA,KAAKiC,QAAQD,aAAc,GAElC,IAAIE,SAAU/C,YAAYqC,WAAWxB,KAAMqB,IACvCa,SAAQC,eACRD,QAAQC,cAAcC,KAAKf,IAAKrB,QAK5C,IAAIqC,QAAShB,IAAI3D,KAAK,wBACtBmB,GAAEgD,KAAKQ,OAAQ,SAAUC,MACrB1E,QAAQ2E,YAAYD,SAI5BE,YAAa,SAAU/B,QAAS7C,SACvBA,UACDA,QAAUqB,KAAKX,QAAQV,QAAQK,WAEnCwC,QAAUD,kBAAkBC,QAC5B,IAAIY,KAAM5D,EAAEgD,QACZ,KAAKY,IAAIf,GAAG,IAAM/C,OAAOkC,QACrB,OAAO,CAENZ,GAAEE,SAASE,KAAKkC,QAAQd,gBAAiBI,UAC1CxB,KAAKkC,QAAQd,gBAAgBoC,KAAKhC,QAItC,IAAIc,SAAUrC,YAAYsC,WAAWH,IACrC,IAAIE,SAAQG,QACRC,GAAIlB,SAGR,IAAIiC,WAAY,SAAU9E,QAAS+E,WAAYtB,IAAK/C,SAChD,IAAKqE,aAAeA,WAAWC,OAC3B,OAAO,CAEX,IAAIP,QAASzE,QAAQ8E,UAAUC,WAAYtB,IAAK/C,QAChD,IAAIuE,UAAWxB,IAAI3D,KAAK,0BAA4BoF,OAAOT,OAC3DhB,KAAI3D,KAAK,oBAAqBmF,SAGlC,IAAIE,gBACJ,IAAIC,yBAEJvF,GAAEgD,QAAQQ,YAAYY,KAAK,SAAUC,MAAOC,SACxC,GAAI/B,MAAO+B,QAAQ5B,QACnB,IAAI8C,SAAUlB,QAAQmB,KAEtB,IAAIlB,cAAe,SACnB,IAAmC,IAA/BhC,KAAKC,QAAQ+B,cAAqB,CAClChC,KAAOA,KAAKiC,QAAQD,aAAc,GAElC,IAAIE,SAAU/C,YAAYqC,WAAWxB,KAAMqB,IAC3C,IAAI8B,iBAAiB,CAKrB,IAJIjB,SAAWA,QAAQkB,OACnBD,eAAiBjB,QAAQkB,KAAKhB,KAAKf,IAAKrB,KAAMiD,UAG9CE,eAAgB,CAEhB,GAAIE,UAAWxE,EAAEyE,OAAOL,QAAQM,MAAM,KAAM,OACxCF,UAAST,OAAS,IAClBK,QAAUI,SAASG,QACnBnC,IAAI3D,KAAK,aAAesC,KAAMqD,UAGlC,IAAII,UAAYzD,KAAMA,KACtB,IAAI0D,YAAa,eACjB,IAA8B,KAA1BT,QAAQhD,QAAQ,WAGb,IAAIgD,QAAQM,MAAMG,YAAYd,OAAS,EAAG,CAC7C,GAAID,YAAa9D,EAAEyE,OAAOL,QAAQM,MAAMG,YAAa,OACrDhB,WAAU9E,QAAS+E,WAAYtB,KAAOsC,OAAO,IAC7CF,QAAQG,OAASjB,eAEjBc,SAAQG,QAAUX,SAClBD,sBAAsBP,KAAKQ,QAE/BF,cAAaN,KAAKgB,aAI9BpC,IAAI3D,KAAK,gBAAiBqF,cACtBC,sBAAsBJ,QAEtBF,UAAU9E,QAASoF,sBAAuB3B,KAAOsC,OAAO,KAQhEE,QAAS,SAAUC,gBACVA,eAEOjF,EAAEC,QAAQgF,kBAClBA,eAAiB1D,oBAAoB0D,iBAFrCA,eAAiB1D,oBAAoBnB,KAAKX,QAAQF,KAKtD,IAAI2F,IAAK9E,IAETxB,GAAEoE,KAAKiC,eAAgB,SAAUhC,MAAOrB,SACpCsD,GAAGvB,YAAYJ,KAAK2B,GAAItD,QAASsD,GAAGzF,QAAQV,QAAQK,cAO5D+F,UAAW,SAAUC,kBACjB,GAAIF,IAAK9E,IACJgF,oBACDA,iBAAmBhF,KAAKkC,QAAQd,iBAEpC5C,EAAEoE,KAAKoC,iBAAkB,SAAUnC,MAAOrB,SACtCsD,GAAG3C,cAAcgB,KAAK2B,GAAItD,QAASsD,GAAGzF,QAAQV,QAAQK,cAI9DX,WAAY,SAAUgB,SAClB,GAAIX,WAKAS,KAAM,OACNR,QAAS,KAMTS,UAAU,EAEdZ,GAAEc,OAAOZ,SAAUW,QAEnB,IAAIV,SAAUD,SAASC,OAEvBqB,MAAKX,QAAUX,QAEf,IAAIoG,IAAK9E,IACT,IAAIT,OAAQf,EAAEE,SAASS,KACvBX,GAAE,WACEsG,GAAGF,UACHrF,MAAM0F,QAAQ,cAId1F,MAAM2F,IAAI5G,OAAO6G,OAAOF,SAASG,GAAG9G,OAAO6G,OAAOF,QAAS,SAAUI,IAAK5G,MACtE,GAAI6G,cAEJ,IAAIlD,KAAM5D,EAAE6G,IAAIE,OAChB,IAAIC,gBAAkBnF,SAASoF,kBAAkBrD,IAAK,OAEtDxC,GAAEgD,KAAKnE,KAAM,SAAUiH,IAAKC,KACxBA,IAAMA,IAAIrB,MAAM,KAAK,GAAGsB,OACxBF,IAAMvF,iBAAiB0F,MAAMH,IAAKF,gBAClCF,WAAWK,KAAOvF,WAAW0F,eAAeJ,KAE5CtD,IAAI6C,QAAQ,aAAec,KAAML,QAGrC/G,QAAQK,UAAUgH,QAAQV,cAI9B/F,MAAM2F,IAAI5G,OAAO6G,OAAOc,OAAOb,GAAG9G,OAAO6G,OAAOc,MAAO,SAAUZ,IAAK5G,MAElE,GAAI2D,KAAM5D,EAAE6G,IAAIE,OAChB,IAAIW,UAAW9D,IAAI3D,KAAK,gBAExB,IAAI0H,aACJ3H,GAAEoE,KAAKnE,KAAM,SAAU2H,aAAcnC,OACjCrE,EAAEgD,KAAKsD,SAAU,SAAU1B,SACnB5E,EAAEE,SAAS0E,QAAQG,OAAQyB,gBAEvBD,UAAU3B,QAAQzD,MADlByD,QAAQG,OAAOhB,OAAS,EACE/D,EAAEyG,KAAK5H,KAAM+F,QAAQG,QAErBV,WAK1C7B,IAAI6C,QAAQ,YAAakB,aAI7B5G,MAAM2F,IAAI,aAAaE,GAAG,YAAa,SAAUC,IAAK5G,MAClD,GAAI2D,KAAM5D,EAAE6G,IAAIE,OAChB,IAAIe,SAAU,SAAUZ,IAAKa,MACzBA,KAAOA,KAAKC,aACZ,IAAIhB,gBAAkBnF,SAASoF,kBAAkBrD,IAAKmE,KACtD,IAAItD,SAAU/C,YAAYqC,WAAWgE,KAAMnE,IAC3C,IAAIqE,gBAAiBtG,iBAAiBmG,QAAQZ,IAAKF,eACnDvC,SAAQR,OAAOU,KAAKf,IAAKqE,eAAgBF,MAGzC/H,GAAEkI,cAAcjI,MAChBmB,EAAEgD,KAAKnE,KAAM6H,SAEbA,QAAQ7H,KAAM,UAItBc,MAAM2F,IAAI,gBAAgBE,GAAG,eAAgB,SAAUC,IAAK5G,MACxDA,KAAOD,EAAEc,QAAO,KAAUb,MAC1BmB,EAAEgD,KAAKnE,KAAKM,WAAY,SAAU4H,KAC/BA,IAAIC,OAAShH,EAAEiH,IAAIF,IAAIC,OAAQ,SAAUlB,KACrC,MAAOtF,YAAW0F,eAAetH,EAAEoH,KAAKF,UAG/C/G,QAAQI,WAAWiH,QAAQvH,QAG3BqG,GAAGzF,QAAQD,UACXkB,iBAAiBf,MAAMmC,IAAI,GAAIoD,OAM/C,OAAOtG,GAAEc,OAAOU,KAAM8B;;A8BpT1B,YAEA,IAAIxC,QAAS,SAAUyZ,WAAYC,aAC/B,GAAIC,QAASjZ,IACb,IAAIkZ,MAMAA,OADAH,YAAcnZ,EAAEuZ,IAAIJ,WAAY,eACxBA,WAAWK,YAEX,WAAc,MAAOH,QAAOhR,MAAMjI,KAAM8H,YAIpDlI,EAAEN,OAAO4Z,MAAOD,OAAQD,YAIxB,IAAIK,WAAY,WAAcrZ,KAAKoZ,YAAcF,MAcjD,OAbAG,WAAUlC,UAAY8B,OAAO9B,UAC7B+B,MAAM/B,UAAY,GAAIkC,WAIlBN,YACAnZ,EAAEN,OAAO4Z,MAAM/B,UAAW4B,YAK9BG,MAAMI,UAAYL,OAAO9B,UAElB+B,MAGX,IAAIK,MAAO,SAAUla,SACjBW,KAAKoC,IAAO/C,QAAW,KAAKb,EAAEa,QAAQqD,IACtC1C,KAAK0C,GAAKrD,QAAQqD,GAClB1C,KAAK3B,WAAW4J,MAAMjI,KAAM8H,WAIhClI,GAAEN,OAAOia,KAAKpC,WACV9Y,WAAY,eAGhBkb,KAAKja,OAASA,OAEdpB,OAAOC,QAAUob;;AblDjB,YACA,IAAIjb,QAASR,QAAQ,eACrB,IAAIgZ,UAAWhZ,QAAQ,iBAEvBI,QAAOC,QAAU2Y,SAASxX,QACtByX,oBAEAK,cAAe,SACfJ,WAAY,WACR,MAAOhX,MAAKoC,IAAIsD,OAGpB/C,aAAc,WACV3C,KAAKoC,IAAI8C,IAAIlF,KAAKoX,gBAGtB/Y,WAAY,WACR,GAAIyG,IAAK9E,IACT,IAAIqX,UAAWrX,KAAKoC,IAAI3D,KAAKH,OAAOwK,WAEhCuO,WACArX,KAAKoC,IAAI8C,IAAIlF,KAAKoX,eAAehS,GAAGpF,KAAKoX,cAAe,WACpD,GAAI1R,KAAMZ,GAAGkS,YAEb,IAAIpQ,UACJA,QAAOyQ,UAAY3R,IAEnBZ,GAAG1C,IAAI6C,QAAQ3G,OAAO6G,OAAOF,QAAS2B,UAG9CkQ,SAASK,UAAU9Y,WAAW4J,MAAMjI,KAAM8H,cAE7CkB,SAAU;;AChCf,YAEA,IAAI8N,UAAWhZ,QAAQ,SAEvBI,QAAOC,QAAU2Y,SAASxX,QACtByX,oBAIA1Y,WAAY,eAEX2K,SAAU;;AFXf,YACA,IAAI8N,UAAWhZ,QAAQ,uBAEvBI,QAAOC,QAAU2Y,SAASxX,QAEtByX,oBAIAC,WAAY,WACR,GAAI5U,KAAMpC,KAAKoC,GAGf,IAAI6U,QAAiC/I,SAAtB9L,IAAI3D,KAAK,SAA0B2D,IAAI3D,KAAK,SAAW,CAEtE,IAAIyY,OAA+BhJ,SAAtB9L,IAAIrB,KAAK,SAA0BqB,IAAImE,KAAK,SAAU,CAEnE,IAAIb,KAAOtD,IAAIf,GAAG,YAAe6V,MAAQD,MACzC,OAAOvR,MAEXrH,WAAY,WACRyY,SAASK,UAAU9Y,WAAW4J,MAAMjI,KAAM8H,cAE7CkB,SAAU;;AbvBf,YAEA,IAAID,WAAY,SAAUC,SAAU/F,SAUhC,MATIrD,GAAEuI,WAAWlF,WACbA,SACIR,OAAQQ,UAGX+F,WACDA,SAAW,KAEf/F,QAAQ+F,SAAWA,SACZ/F,QAGX,IAAIpC,OAAQ,SAAUoI,QAASC,MAC3B,MAAItJ,GAAEuJ,SAASF,SACJA,UAAYC,KAAKF,SAEjBxK,EAAEyK,SAAS5H,GAAG6H,KAAKF,UAIlC,IAAI/I,cACAmJ,QAOAC,SAAU,SAAUL,SAAU/F,SAC1BjD,KAAKoJ,KAAKE,QAAQP,UAAUC,SAAU/F,WAG1CV,WAAY,SAAUyG,UAClB,MAAOpJ,GAAEkB,KAAKd,KAAKoJ,KAAM,SAAUF,MAC/B,MAAOrI,OAAMmI,SAAUE,SAI/BlG,QAAS,SAAUgG,SAAU/F,SACzB,GAAIJ,MACJjD,GAAEgD,KAAK5C,KAAKoJ,KAAM,SAAUG,eAAgBC,GACxC,MAAIR,YAAaO,eAAeP,UAC5BnG,MAAQ2G,GACD,GAFX,SAKJxJ,KAAKoJ,KAAKK,OAAO5G,MAAO,EAAGkG,UAAUC,SAAU/F,WAKvD,IAAIyG,kBACA5L,QAAQ,yBACRA,QAAQ,wBACRA,QAAQ,kBAEZ8B,GAAEgD,KAAK8G,gBAAgBC,UAAW,SAAU1G,SACxChD,YAAYoJ,SAASpG,QAAQ+F,SAAU/F,WAG3C/E,OAAOC,QAAU8B;;AK/DjB,YAEA/B,QAAOC,QAAU,SAAUoH,OAAQvH,YAC/B,IAAKJ,OAAOyO,iBACR,OAAO,CAIX,IAAIC,UAAW,GAAID,kBAAiB,SAAUE,WAC5CA,UAAUC,QAAQ,SAAUC,UAC1B,GAAIC,OAAQlO,EAAEiO,SAASE,YAAY7L,KAAK,KACxC4L,OAAQA,MAAMpL,IAAI9C,EAAEiO,SAASE,YAAYrC,OAAO,MAEhD,IAAIsC,SAAUpO,EAAEiO,SAASI,cAAc/L,KAAK,KAC5C8L,SAAUA,QAAQtL,IAAI9C,EAAEiO,SAASI,cAAcvC,OAAO,OAElDoC,OAASA,MAAM/I,QAEf3F,WAAW4G,QAAQ8H,OAEnBE,SAAWA,QAAQjJ,QAEnB3F,WAAW+G,UAAU6H,YAK7B,IAAIE,YACA9K,YAAY,EACZ+K,WAAW,EACXC,SAAS,EACTC,eAAe,EAEnBX,UAASY,QAAQ3H,OAAQuH;;ATjC7B,YAEA,IAAI9O,YAAaF,QAAQ,oBACzB,IAAIG,SAAUH,QAAQ,yBAEtBI,QAAOC,SACHC,IAAKJ,WAELK,WAAY,SAAUC,QAClB,GAAIC,OAAQC,EAAE,QAAQC,KAAK,UAE3B,IAAIC,WACAC,SACIC,KACIC,QAAS,GACTC,QAAS,GACTP,MAAOA,MAEPQ,cAEAC,WACIC,WACIC,OAAO,MAKvBd,KACIe,KAAM,OACNC,UAAU,GAIlB,IAAIC,SAAUb,EAAEc,QAAO,KAAUZ,SAAUJ,OAC3C,IAAIiB,OAAQf,EAAEa,QAAQjB,IAAIe,KAC1B,IAAIK,QAASD,MAAMd,KAAK,YACxB,IAAIgB,WAAYJ,QAAQV,QAAQC,IAAIG,WAAWW,MAC/C,IAAIC,uBAAwBH,SAAWC,aAAc,GAASG,EAAEC,QAAQJ,YAAcG,EAAEE,SAASL,UAAWD,QAC5G,IAAIO,oBAAqBP,QAAUG,qBAE/BI,qBACAV,QAAQV,QAAQC,IAAII,UAAUC,UAAUC,OAAQ,GAIhDc,KAAKrB,QADLL,QAAUA,OAAOK,SAAYL,OAAOK,kBAAmBV,SACxCK,OAAOK,QAEP,GAAIV,SAAQoB,QAAQV,SAGvCX,WAAWK,WAAWG,EAAEc,QAAO,GAC3BX,QAASqB,KAAKrB,SACfU,QAAQjB;;AQpDnB,YAEAF,QAAOC,SAEH0C,MAAO,SAAUoJ,UAAWiC,WAAYzK,SACpC,MAAI7B,GAAEuJ,SAASc,WACW,MAAdA,WAAsBA,UAAUzD,gBAAkB0F,WAAW1F,cAC9D5G,EAAEuI,WAAW8B,WACbA,UAAUiC,WAAYzK,SACtB7B,EAAEuK,SAASF,WACXiC,WAAWrL,MAAMoJ,WADrB,QAKXxE,kBAAmB,SAAUrD,IAAKsI,UAC9B,GAAIlF,gBAAiBpD,IAAI3D,KAAK,aAAeiM,SAE7C,KAAKlF,iBAAgC,SAAbkF,UAAoC,YAAbA,UAAyB,CAGpE,GADAlF,eAAiBpD,IAAI3D,KAAK,cACrB+G,eAAgB,CACjB,GAAI2G,WAAY/J,IAAIgK,QAAQ,mBACxBD,aACA3G,eAAiB2G,UAAU1N,KAAK,cAIpC+G,iBACAA,eAAiB5F,EAAEyE,OAAOmB,eAAelB,MAAM,KAAM,SAI7D,MAAOkB;;ADhCf,YAEAtH,QAAOC,SAEH2H,eAAgB,SAAUrH,MACtB,GAAIoN,QAAS,qBACb,IAAIH,WAAYjN,IAqBhB,OApBoB,gBAATA,QACPA,KAAOA,KAAKmH,OAEC,SAATnH,KACAiN,WAAY,EACI,UAATjN,KACPiN,WAAY,EACI,SAATjN,KACPiN,UAAY,KACI,cAATjN,KACPiN,UAAY,GACmB,MAAxBA,UAAUI,OAAO,IAAuC,MAAxBJ,UAAUI,OAAO,GACxDJ,UAAYjN,KAAKsN,UAAU,EAAGtN,KAAKkF,OAAS,GACrCnF,EAAEwN,UAAUvN,MACnBiN,WAAajN,KACNoN,OAAO9B,KAAKtL,QAEnBiN,UAAYlN,EAAEyN,UAAUxN,QAGzBiN","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","window.Flow = require('./flow.js');\nwindow.Flow.version = '<%= version %>'; //populated by grunt\n","'use strict';\n\nvar domManager = require('./dom/dom-manager');\nvar Channel = require('./channels/run-channel');\n\nmodule.exports = {\n    dom: domManager,\n\n    initialize: function (config) {\n        var model = $('body').data('f-model');\n\n        var defaults = {\n            channel: {\n                run: {\n                    account: '',\n                    project: '',\n                    model: model,\n\n                    operations: {\n                    },\n                    variables: {\n                        autoFetch: {\n                            start: false\n                        }\n                    }\n                }\n            },\n            dom: {\n                root: 'body',\n                autoBind: true\n            }\n        };\n\n        var options = $.extend(true, {}, defaults, config);\n        var $root = $(options.dom.root);\n        var initFn = $root.data('f-on-init');\n        var opnSilent = options.channel.run.operations.silent;\n        var isInitOperationSilent = initFn && (opnSilent === true || (_.isArray(opnSilent) && _.contains(opnSilent, initFn)));\n        var preFetchVariables = !initFn || isInitOperationSilent;\n\n        if (preFetchVariables) {\n            options.channel.run.variables.autoFetch.start = true;\n        }\n\n        if (config && config.channel && (config.channel instanceof Channel)) {\n            this.channel = config.channel;\n        } else {\n            this.channel = new Channel(options.channel);\n        }\n\n        domManager.initialize($.extend(true, {\n            channel: this.channel\n        }, options.dom));\n    }\n};\n","module.exports = (function () {\n    'use strict';\n    var config = require('../config');\n\n    var nodeManager = require('./nodes/node-manager');\n    var attrManager = require('./attributes/attribute-manager');\n    var converterManager = require('../converters/converter-manager');\n\n    var parseUtils = require('../utils/parse-utils');\n    var domUtils = require('../utils/dom');\n\n    var autoUpdatePlugin = require('./plugins/auto-update-bindings');\n\n    //Jquery selector to return everything which has a f- property set\n    $.expr[':'][config.prefix] = function (obj) {\n        var $this = $(obj);\n        var dataprops = _.keys($this.data());\n\n        var match = _.find(dataprops, function (attr) {\n            return (attr.indexOf(config.prefix) === 0);\n        });\n\n        return !!(match);\n    };\n\n    $.expr[':'].webcomponent = function (obj) {\n        return obj.nodeName.indexOf('-') !== -1;\n    };\n\n    var getMatchingElements = function (root) {\n        var $root = $(root);\n        var matchedElements = $root.find(':' + config.prefix);\n        if ($root.is(':' + config.prefix)) {\n            matchedElements = matchedElements.add($root);\n        }\n        return matchedElements;\n    };\n\n    var getElementOrError = function (element, context) {\n        if (element instanceof $) {\n            element = element.get(0);\n        }\n        if (!element || !element.nodeName) {\n            console.error(context, 'Expected to get DOM Element, got ', element);\n            throw new Error(context + ': Expected to get DOM Element, got' + (typeof element));\n        }\n        return element;\n    };\n\n    var publicAPI = {\n\n        nodes: nodeManager,\n        attributes: attrManager,\n        converters: converterManager,\n        //utils for testing\n        private: {\n            matchedElements: []\n        },\n\n        unbindElement: function (element, channel) {\n            if (!channel) {\n                channel = this.options.channel.variables;\n            }\n            element = getElementOrError(element);\n            var $el = $(element);\n            if (!$el.is(':' + config.prefix)) {\n                return false;\n            }\n            this.private.matchedElements = _.without(this.private.matchedElements, element);\n\n            //FIXME: have to readd events to be able to remove them. Ugly\n            var Handler = nodeManager.getHandler($el);\n            var h = new Handler.handle({\n                el: element\n            });\n            if (h.removeEvents) {\n                h.removeEvents();\n            }\n\n            $(element.attributes).each(function (index, nodeMap) {\n                var attr = nodeMap.nodeName;\n                var wantedPrefix = 'data-f-';\n                if (attr.indexOf(wantedPrefix) === 0) {\n                    attr = attr.replace(wantedPrefix, '');\n\n                    var handler = attrManager.getHandler(attr, $el);\n                    if (handler.stopListening) {\n                        handler.stopListening.call($el, attr);\n                    }\n                }\n            });\n\n            var subsid = $el.data('f-subscription-id') || [];\n            _.each(subsid, function (subs) {\n                channel.unsubscribe(subs);\n            });\n        },\n\n        bindElement: function (element, channel) {\n            if (!channel) {\n                channel = this.options.channel.variables;\n            }\n            element = getElementOrError(element);\n            var $el = $(element);\n            if (!$el.is(':' + config.prefix)) {\n                return false;\n            }\n            if (!_.contains(this.private.matchedElements, element)) {\n                this.private.matchedElements.push(element);\n            }\n\n            //Send to node manager to handle ui changes\n            var Handler = nodeManager.getHandler($el);\n            new Handler.handle({\n                el: element\n            });\n\n            var subscribe = function (channel, varsToBind, $el, options) {\n                if (!varsToBind || !varsToBind.length) {\n                    return false;\n                }\n                var subsid = channel.subscribe(varsToBind, $el, options);\n                var newsubs = ($el.data('f-subscription-id') || []).concat(subsid);\n                $el.data('f-subscription-id', newsubs);\n            };\n\n            var attrBindings = [];\n            var nonBatchableVariables = [];\n            //NOTE: looping through attributes instead of .data because .data automatically camelcases properties and make it hard to retrvieve\n            $(element.attributes).each(function (index, nodeMap) {\n                var attr = nodeMap.nodeName;\n                var attrVal = nodeMap.value;\n\n                var wantedPrefix = 'data-f-';\n                if (attr.indexOf(wantedPrefix) === 0) {\n                    attr = attr.replace(wantedPrefix, '');\n\n                    var handler = attrManager.getHandler(attr, $el);\n                    var isBindableAttr = true;\n                    if (handler && handler.init) {\n                        isBindableAttr = handler.init.call($el, attr, attrVal);\n                    }\n\n                    if (isBindableAttr) {\n                        //Convert pipes to converter attrs\n                        var withConv = _.invoke(attrVal.split('|'), 'trim');\n                        if (withConv.length > 1) {\n                            attrVal = withConv.shift();\n                            $el.data('f-convert-' + attr, withConv);\n                        }\n\n                        var binding = { attr: attr };\n                        var commaRegex = /,(?![^\\[]*\\])/;\n                        if (attrVal.indexOf('<%') !== -1) {\n                            //Assume it's templated for later use\n\n                        } else if (attrVal.split(commaRegex).length > 1) {\n                            var varsToBind = _.invoke(attrVal.split(commaRegex), 'trim');\n                            subscribe(channel, varsToBind, $el, { batch: true });\n                            binding.topics = varsToBind;\n                        } else {\n                            binding.topics = [attrVal];\n                            nonBatchableVariables.push(attrVal);\n                        }\n                        attrBindings.push(binding);\n                    }\n                }\n            });\n            $el.data('attr-bindings', attrBindings);\n            if (nonBatchableVariables.length) {\n                // console.log('subscribe', nonBatchableVariables, $el.get(0))\n                subscribe(channel, nonBatchableVariables, $el, { batch: false });\n            }\n        },\n\n        /**\n         * Bind all provided elements\n         * @param  {Array|jQuerySelector} elementsToBind (Optional) If not provided uses the default root provided at initialization\n         */\n        bindAll: function (elementsToBind) {\n            if (!elementsToBind) {\n                elementsToBind = getMatchingElements(this.options.root);\n            } else if (!_.isArray(elementsToBind)) {\n                elementsToBind = getMatchingElements(elementsToBind);\n            }\n\n            var me = this;\n            //parse through dom and find everything with matching attributes\n            $.each(elementsToBind, function (index, element) {\n                me.bindElement.call(me, element, me.options.channel.variables);\n            });\n        },\n        /**\n         * Unbind provided elements\n         * @param  {Array} elementsToUnbind (Optional). If not provided unbinds everything\n         */\n        unbindAll: function (elementsToUnbind) {\n            var me = this;\n            if (!elementsToUnbind) {\n                elementsToUnbind = this.private.matchedElements;\n            }\n            $.each(elementsToUnbind, function (index, element) {\n                me.unbindElement.call(me, element, me.options.channel.variables);\n            });\n        },\n\n        initialize: function (options) {\n            var defaults = {\n                /**\n                 * Root of the element for flow to manage from.\n                 * @type {String} jQuery selector\n                 */\n                root: 'body',\n                channel: null,\n\n                /**\n                 * Any variables added to the dom after Flow.initialize has been called will be automatically parsed and subscriptions added to channels. Note, this does not work in IE versions < 11\n                 * @type {Boolean}\n                 */\n                autoBind: true\n            };\n            $.extend(defaults, options);\n\n            var channel = defaults.channel;\n\n            this.options = defaults;\n\n            var me = this;\n            var $root = $(defaults.root);\n            $(function () {\n                me.bindAll();\n                $root.trigger('f.domready');\n\n                //Attach listeners\n                // Listen for changes to ui and publish to api\n                $root.off(config.events.trigger).on(config.events.trigger, function (evt, data) {\n                    var parsedData = {}; //if not all subsequent listeners will get the modified data\n\n                    var $el = $(evt.target);\n                    var attrConverters =  domUtils.getConvertersList($el, 'bind');\n\n                    _.each(data, function (val, key) {\n                        key = key.split('|')[0].trim(); //in case the pipe formatting syntax was used\n                        val = converterManager.parse(val, attrConverters);\n                        parsedData[key] = parseUtils.toImplicitType(val);\n\n                        $el.trigger('f.convert', { bind: val });\n                    });\n\n                    channel.variables.publish(parsedData);\n                });\n\n                // Listen for changes from api and update ui\n                $root.off(config.events.react).on(config.events.react, function (evt, data) {\n                    // console.log(evt.target, data, \"root on\");\n                    var $el = $(evt.target);\n                    var bindings = $el.data('attr-bindings');\n\n                    var toconvert = {};\n                    $.each(data, function (variableName, value) {\n                        _.each(bindings, function (binding) {\n                            if (_.contains(binding.topics, variableName)) {\n                                if (binding.topics.length > 1) {\n                                    toconvert[binding.attr] = _.pick(data, binding.topics);\n                                } else {\n                                    toconvert[binding.attr] = value;\n                                }\n                            }\n                        });\n                    });\n                    $el.trigger('f.convert', toconvert);\n                });\n\n                // data = {proptoupdate: value} || just a value (assumes 'bind' if so)\n                $root.off('f.convert').on('f.convert', function (evt, data) {\n                    var $el = $(evt.target);\n                    var convert = function (val, prop) {\n                        prop = prop.toLowerCase();\n                        var attrConverters =  domUtils.getConvertersList($el, prop);\n                        var handler = attrManager.getHandler(prop, $el);\n                        var convertedValue = converterManager.convert(val, attrConverters);\n                        handler.handle.call($el, convertedValue, prop);\n                    };\n\n                    if ($.isPlainObject(data)) {\n                        _.each(data, convert);\n                    } else {\n                        convert(data, 'bind');\n                    }\n                });\n\n                $root.off('f.ui.operate').on('f.ui.operate', function (evt, data) {\n                    data = $.extend(true, {}, data); //if not all subsequent listeners will get the modified data\n                    _.each(data.operations, function (opn) {\n                       opn.params = _.map(opn.params, function (val) {\n                           return parseUtils.toImplicitType($.trim(val));\n                       });\n                    });\n                    channel.operations.publish(data);\n                });\n\n                if (me.options.autoBind) {\n                    autoUpdatePlugin($root.get(0), me);\n                }\n            });\n        }\n    };\n\n    return $.extend(this, publicAPI);\n}());\n","'use strict';\n\nvar VarsChannel = require('./variables-channel');\nvar OperationsChannel = require('./operations-channel');\n\nmodule.exports = function (options) {\n    var defaults = {\n        run: {\n            variables: {\n\n            },\n            operations: {\n\n            }\n        }\n    };\n    var config = $.extend(true, {}, defaults, options);\n\n    var rm = new F.manager.RunManager(config);\n    var rs = rm.run;\n\n    var $creationPromise = rm.getRun();\n    rs.currentPromise = $creationPromise;\n\n    var createAndThen = function (fn, context) {\n        return _.wrap(fn, function (func) {\n            var passedInParams = _.toArray(arguments).slice(1);\n            return rs.currentPromise.then(function () {\n                rs.currentPromise = func.apply(context, passedInParams);\n                return rs.currentPromise;\n            });\n        });\n    };\n\n    //Make sure nothing happens before the run is created\n    _.each(rs, function (value, name) {\n        if (_.isFunction(value) && name !== 'variables'  && name !== 'create') {\n            rs[name] = createAndThen(value, rs);\n        }\n    });\n\n    var originalVariablesFn = rs.variables;\n    rs.variables = function () {\n        var vs = originalVariablesFn.apply(rs, arguments);\n        _.each(vs, function (value, name) {\n            if (_.isFunction(value)) {\n                vs[name] = createAndThen(value, vs);\n            }\n        });\n        return vs;\n    };\n\n    this.run = rs;\n    var varOptions = config.run.variables;\n    this.variables = new VarsChannel($.extend(true, {}, varOptions, { run: rs }));\n    this.operations = new OperationsChannel($.extend(true, {}, config.run.operations, { run: rs }));\n\n    var me = this;\n    var debouncedRefresh = _.debounce(function (data) {\n        me.variables.refresh.call(me.variables, null, true);\n        if (me.variables.options.autoFetch.enable) {\n            me.variables.startAutoFetch();\n        }\n    }, 200, { leading: true });\n\n    this.operations.subscribe('*', debouncedRefresh);\n};\n","module.exports = {\n    prefix: 'f',\n    defaultAttr: 'bind',\n\n    binderAttr: 'f-bind',\n\n    events: {\n        trigger: 'update.f.ui',\n        react: 'update.f.model'\n    }\n\n};\n","'use strict';\n\nvar normalize = function (selector, handler) {\n    if (_.isFunction(handler)) {\n        handler = {\n            handle: handler\n        };\n    }\n    if (!selector) {\n        selector = '*';\n    }\n    handler.selector = selector;\n    return handler;\n};\n\nvar match = function (toMatch, node) {\n    if (_.isString(toMatch)) {\n        return toMatch === node.selector;\n    } else {\n        return $(toMatch).is(node.selector);\n    }\n};\n\nvar nodeManager = {\n    list: [],\n\n    /**\n     * Add a new node handler\n     * @param  {string} selector jQuery-compatible selector to use to match nodes\n     * @param  {function} handler  Handlers are new-able functions. They will be called with $el as context.? TODO: Think this through\n     */\n    register: function (selector, handler) {\n        this.list.unshift(normalize(selector, handler));\n    },\n\n    getHandler: function (selector) {\n        return _.find(this.list, function (node) {\n            return match(selector, node);\n        });\n    },\n\n    replace: function (selector, handler) {\n        var index;\n        _.each(this.list, function (currentHandler, i) {\n            if (selector === currentHandler.selector) {\n                index = i;\n                return false;\n            }\n        });\n        this.list.splice(index, 1, normalize(selector, handler));\n    }\n};\n\n//bootstraps\nvar defaultHandlers = [\n    require('./input-checkbox-node'),\n    require('./default-input-node'),\n    require('./default-node')\n];\n_.each(defaultHandlers.reverse(), function (handler) {\n    nodeManager.register(handler.selector, handler);\n});\n\nmodule.exports = nodeManager;\n","'use strict';\n\nvar defaultHandlers = [\n    require('./no-op-attr'),\n    require('./events/init-event-attr'),\n    require('./events/default-event-attr'),\n    require('./foreach/default-foreach-attr'),\n    require('./binds/checkbox-radio-bind-attr'),\n    require('./binds/input-bind-attr'),\n    require('./class-attr'),\n    require('./positive-boolean-attr'),\n    require('./negative-boolean-attr'),\n    require('./binds/default-bind-attr'),\n    require('./default-attr')\n];\n\nvar handlersList = [];\n\nvar normalize = function (attributeMatcher, nodeMatcher, handler) {\n    if (!nodeMatcher) {\n        nodeMatcher = '*';\n    }\n    if (_.isFunction(handler)) {\n        handler = {\n            handle: handler\n        };\n    }\n    return $.extend(handler, { test: attributeMatcher, target: nodeMatcher });\n};\n\n$.each(defaultHandlers, function (index, handler) {\n    handlersList.push(normalize(handler.test, handler.target, handler));\n});\n\n\nvar matchAttr = function (matchExpr, attr, $el) {\n    var attrMatch;\n\n    if (_.isString(matchExpr)) {\n        attrMatch = (matchExpr === '*' || (matchExpr.toLowerCase() === attr.toLowerCase()));\n    } else if (_.isFunction(matchExpr)) {\n        //TODO: remove element selectors from attributes\n        attrMatch = matchExpr(attr, $el);\n    } else if (_.isRegExp(matchExpr)) {\n        attrMatch = attr.match(matchExpr);\n    }\n    return attrMatch;\n};\n\nvar matchNode = function (target, nodeFilter) {\n    return (_.isString(nodeFilter)) ? (nodeFilter === target) : nodeFilter.is(target);\n};\n\nmodule.exports = {\n    list: handlersList,\n    /**\n     * Add a new attribute handler\n     * @param  {string|function|regex} attributeMatcher Description of which attributes to match\n     * @param  {string} nodeMatcher      Which nodes to all attributes to. Use jquery Selector syntax\n     * @param  {function|object} handler    Handler can either be a function (The function will be called with $element as context, and attribute value + name), or an object with {init: fn,  handle: fn}. The init function will be called when page loads; use this to define event handlers\n     */\n    register: function (attributeMatcher, nodeMatcher, handler) {\n        handlersList.unshift(normalize.apply(null, arguments));\n    },\n\n    /**\n     * Find an attribute matcher matching some criteria\n     * @param  {string} attrFilter attribute to match\n     * @param  {string | $el} nodeFilter node to match\n     * @return {array|null}\n     */\n    filter: function (attrFilter, nodeFilter) {\n        var filtered = _.select(handlersList, function (handler) {\n            return matchAttr(handler.test, attrFilter);\n        });\n        if (nodeFilter) {\n            filtered = _.select(filtered, function (handler) {\n                return matchNode(handler.target, nodeFilter);\n            });\n        }\n        return filtered;\n    },\n\n    replace: function (attrFilter, nodeFilter, handler) {\n        var index;\n        _.each(handlersList, function (currentHandler, i) {\n            if (matchAttr(currentHandler.test, attrFilter) && matchNode(currentHandler.target, nodeFilter)) {\n                index = i;\n                return false;\n            }\n        });\n        handlersList.splice(index, 1, normalize(attrFilter, nodeFilter, handler));\n    },\n\n    getHandler: function (property, $el) {\n        var filtered = this.filter(property, $el);\n        //There could be multiple matches, but the top first has the most priority\n        return filtered[0];\n    }\n};\n\n","'use strict';\n\n//TODO: Make all underscore filters available\n\nvar normalize = function (alias, converter, acceptList) {\n    var ret = [];\n    //nomalize('flip', fn)\n    if (_.isFunction(converter)) {\n        ret.push({\n            alias: alias,\n            convert: converter,\n            acceptList: acceptList\n        });\n    } else if ($.isPlainObject(converter) && converter.convert) {\n        converter.alias = alias;\n        converter.acceptList = acceptList;\n        ret.push(converter);\n    } else if ($.isPlainObject(alias)) {\n        //normalize({alias: 'flip', convert: function})\n        if (alias.convert) {\n            ret.push(alias);\n        } else {\n            // normalize({flip: fun})\n            $.each(alias, function (key, val) {\n                ret.push({\n                    alias: key,\n                    convert: val,\n                    acceptList: acceptList\n                });\n            });\n        }\n    }\n    return ret;\n};\n\nvar matchConverter = function (alias, converter) {\n    if (_.isString(converter.alias)) {\n        return alias === converter.alias;\n    } else if (_.isFunction(converter.alias)) {\n        return converter.alias(alias);\n    } else if (_.isRegex(converter.alias)) {\n        return converter.alias.match(alias);\n    }\n    return false;\n};\n\nvar converterManager = {\n    private: {\n        matchConverter: matchConverter\n    },\n\n    list: [],\n    /**\n     * Add a new attribute converter\n     * @param  {string|function|regex} alias formatter name\n     * @param  {function|object} converter    converter can either be a function, which will be called with the value, or an object with {alias: '', parse: $.noop, convert: $.noop}\n     * @param {Boolean} acceptList decides if the converter is a 'list' converter or not; list converters take in arrays as inputs, others expect single values.\n     */\n    register: function (alias, converter, acceptList) {\n        var normalized = normalize(alias, converter, acceptList);\n        this.list = normalized.concat(this.list);\n    },\n\n    replace: function (alias, converter) {\n        var index;\n        _.each(this.list, function (currentConverter, i) {\n            if (matchConverter(alias, currentConverter)) {\n                index = i;\n                return false;\n            }\n        });\n        this.list.splice(index, 1, normalize(alias, converter)[0]);\n    },\n\n    getConverter: function (alias) {\n        return _.find(this.list, function (converter) {\n            return matchConverter(alias, converter);\n        });\n    },\n\n    /**\n     * Pipes the value sequentially through a list of provided converters\n     * @param  {*} value Input for the converter to tag\n     * @param  {Array|Object} list  list of converters (maps to converter alias)\n     * @return {*}       converted value\n     */\n    convert: function (value, list) {\n        if (!list || !list.length) {\n            return value;\n        }\n        list = [].concat(list);\n        list = _.invoke(list, 'trim');\n\n        var currentValue = value;\n        var me = this;\n\n        var convertArray = function (converter, val, converterName) {\n            return _.map(val, function (v) {\n                return converter.convert(v, converterName);\n            });\n        };\n        var convertObject = function (converter, value, converterName) {\n            return _.mapValues(value, function (val, key) {\n               return convert(converter, val, converterName);\n           });\n        };\n        var convert = function (converter, value, converterName) {\n            var converted;\n            if (_.isArray(value) && converter.acceptList !== true) {\n                converted = convertArray(converter, value, converterName);\n            } else {\n                converted = converter.convert(value, converterName);\n            }\n            return converted;\n        };\n        _.each(list, function (converterName) {\n            var converter = me.getConverter(converterName);\n            if (!converter) {\n                throw new Error('Could not find not find converter for ' + converterName);\n            }\n            if ($.isPlainObject(currentValue) && converter.acceptList !== true) {\n                currentValue = convertObject(converter, currentValue, converterName);\n            } else {\n                currentValue = convert(converter, currentValue, converterName);\n            }\n        });\n        return currentValue;\n    },\n\n    /**\n     * Counter-part to 'convert'. Translates converted values back to their original form\n     * @param  {String} value Value to parse\n     * @param  {String | Array} list  List of parsers to run this through. Outermost is invoked first\n     * @return {*}\n     */\n    parse: function (value, list) {\n        if (!list || !list.length) {\n            return value;\n        }\n        list = [].concat(list).reverse();\n        list = _.invoke(list, 'trim');\n\n        var currentValue = value;\n        var me = this;\n        _.each(list, function (converterName) {\n            var converter = me.getConverter(converterName);\n            if (converter.parse) {\n                currentValue = converter.parse(currentValue, converterName);\n            }\n        });\n        return currentValue;\n    }\n};\n\n\n//Bootstrap\nvar defaultconverters = [\n    require('./number-converter'),\n    require('./string-converter'),\n    require('./array-converter'),\n    require('./underscore-utils-converter'),\n    require('./numberformat-converter'),\n];\n\n$.each(defaultconverters.reverse(), function (index, converter) {\n    if (_.isArray(converter)) {\n        _.each(converter, function (c) {\n           converterManager.register(c);\n        });\n    } else {\n        converterManager.register(converter);\n    }\n});\n\nmodule.exports = converterManager;\n","'use strict';\n\nmodule.exports = {\n\n    toImplicitType: function (data) {\n        var rbrace = /^(?:\\{.*\\}|\\[.*\\])$/;\n        var converted = data;\n        if (typeof data === 'string') {\n            data = data.trim();\n\n            if (data === 'true') {\n                converted = true;\n            } else if (data === 'false') {\n                converted = false;\n            } else if (data === 'null') {\n                converted = null;\n            } else if (data === 'undefined') {\n                converted = '';\n            } else if (converted.charAt(0) === '\\'' || converted.charAt(0) === '\"') {\n                converted = data.substring(1, data.length - 1);\n            } else if ($.isNumeric(data)) {\n                converted = +data;\n            } else if (rbrace.test(data)) {\n                //TODO: This only works with double quotes, i.e., [1,\"2\"] works but not [1,'2']\n                converted = $.parseJSON(data) ;\n            }\n        }\n        return converted;\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    match: function (matchExpr, matchValue, context) {\n        if (_.isString(matchExpr)) {\n            return (matchExpr === '*' || (matchExpr.toLowerCase() === matchValue.toLowerCase()));\n        } else if (_.isFunction(matchExpr)) {\n            return matchExpr(matchValue, context);\n        } else if (_.isRegExp(matchExpr)) {\n            return matchValue.match(matchExpr);\n        }\n    },\n\n    getConvertersList: function ($el, property) {\n        var attrConverters = $el.data('f-convert-' + property);\n\n        if (!attrConverters && (property === 'bind' || property === 'foreach')) {\n            //Only bind inherits from parents\n            attrConverters = $el.data('f-convert');\n            if (!attrConverters) {\n                var $parentEl = $el.closest('[data-f-convert]');\n                if ($parentEl) {\n                    attrConverters = $parentEl.data('f-convert');\n                }\n            }\n\n            if (attrConverters) {\n                attrConverters = _.invoke(attrConverters.split('|'), 'trim');\n            }\n        }\n\n        return attrConverters;\n    }\n};\n","'use strict';\n\nmodule.exports = function (target, domManager) {\n    if (!window.MutationObserver) {\n        return false;\n    }\n\n    // Create an observer instance\n    var observer = new MutationObserver(function (mutations) {\n      mutations.forEach(function (mutation) {\n        var added = $(mutation.addedNodes).find(':f');\n        added = added.add($(mutation.addedNodes).filter(':f'));\n\n        var removed = $(mutation.removedNodes).find(':f');\n        removed = removed.add($(mutation.removedNodes).filter(':f'));\n\n        if (added && added.length) {\n            // console.log('mutation observer added', added.get(), mutation.addedNodes);\n            domManager.bindAll(added);\n        }\n        if (removed && removed.length) {\n            // console.log('mutation observer removed', removed);\n            domManager.unbindAll(removed);\n        }\n      });\n    });\n\n    var mutconfig = {\n        attributes: false,\n        childList: true,\n        subtree: true,\n        characterData: false\n    };\n    observer.observe(target, mutconfig);\n    // Later, you can stop observing\n    // observer.disconnect();\n};\n","'use strict';\nvar config = require('../config');\n\nmodule.exports = function (options) {\n    var defaults = {\n        /**\n         * Determine when to update state\n         * @type {String | Array | Object} Possible options are\n         *       - true: never trigger any updates. Use this if you know your model state won't change based on other variables\n         *       - false: always trigger updates.\n         *       - [array of variable names]: Variables in this array will not trigger updates, everything else will\n         *       - { except: [array of variables]}: Variables in this array will trigger updates, nothing else will\n         */\n        silent: false,\n\n        /**\n         * Allows you to auto-fetch variables from the API as they're being subscribed. If this is set to enabled: false you'll need to explicitly call #refresh to get data and notify your listeners\n         * @type {Object}\n         */\n        autoFetch: {\n            /**\n             * Enable auto-fetch behavior. If set to false during instantiation there's no way to enable this again.\n             * @type {Boolean}\n             */\n            enable: true,\n            /**\n             * If auto-fetch is enabled control when to start fetching. Typically you'd want to start right-away, but if you want to wait till something else happens (like an operation or user action) set to false and control using the #startAutoFetch function\n             * @type {Boolean}\n             */\n            start: true,\n\n            /**\n             * Control time to wait between calls to #subscribe before calling #fetch. See http://drupalmotion.com/article/debounce-and-throttle-visual-explanation for an explanation of how debouncing works\n             * @type {Number} Milliseconds to wait\n             */\n            debounce: 200\n        }\n    };\n\n    var channelOptions = $.extend(true, {}, defaults, options);\n    this.options = channelOptions;\n\n    var vs = channelOptions.run.variables();\n\n    var currentData = {};\n\n    //TODO: actually compare objects and so on\n    var isEqual = function (a, b) {\n        return false;\n    };\n\n    var getInnerVariables = function (str) {\n        var inner = str.match(/<(.*?)>/g);\n        inner = _.map(inner, function (val) {\n            return val.substring(1, val.length - 1);\n        });\n        return inner;\n    };\n\n    //Replaces stubbed out keynames in variablestointerpolate with their corresponding values\n    var interpolate = function (variablesToInterpolate, values) {\n        //{price[1]: price[<time>]}\n        var interpolationMap = {};\n        //{price[1]: 1}\n        var interpolated = {};\n\n        _.each(variablesToInterpolate, function (outerVariable) {\n            var inner = getInnerVariables(outerVariable);\n            var originalOuter = outerVariable;\n            if (inner && inner.length) {\n                $.each(inner, function (index, innerVariable) {\n                    var thisval = values[innerVariable];\n                    if (thisval !== null && thisval !== undefined) {\n                        if (_.isArray(thisval)) {\n                            //For arrayed things get the last one for interpolation purposes\n                            thisval = thisval[thisval.length - 1];\n                        }\n                        //TODO: Regex to match spaces and so on\n                        outerVariable = outerVariable.replace('<' + innerVariable + '>', thisval);\n                    }\n                });\n                interpolationMap[outerVariable] = (interpolationMap[outerVariable]) ? [originalOuter].concat(interpolationMap[outerVariable]) : originalOuter;\n            }\n            interpolated[originalOuter] = outerVariable;\n        });\n\n        var op = {\n            interpolated: interpolated,\n            interpolationMap: interpolationMap\n        };\n        return op;\n    };\n\n    var publicAPI = {\n        //for testing\n        private: {\n            getInnerVariables: getInnerVariables,\n            interpolate: interpolate,\n            currentData: currentData,\n            options: channelOptions\n        },\n\n        subscriptions: [],\n\n        unfetched: [],\n\n        getSubscribers: function (topic) {\n            if (topic) {\n                return _.filter(this.subscriptions, function (subs) {\n                    return _.contains(subs.topics, topic);\n                });\n            } else {\n                return this.subscriptions;\n            }\n        },\n        getAllTopics: function () {\n            return _(this.subscriptions).pluck('topics').flatten().uniq().value();\n        },\n        getTopicDependencies: function (list) {\n            if (!list) {\n                list = this.getAllTopics();\n            }\n            var innerList = [];\n            _.each(list, function (vname) {\n                var inner = getInnerVariables(vname);\n                if (inner.length) {\n                    innerList = _.uniq(innerList.concat(inner));\n                }\n            });\n            return innerList;\n        },\n\n        updateAndCheckForRefresh: function (topics, options) {\n            if (topics) {\n                this.unfetched = _.uniq(this.unfetched.concat(topics));\n            }\n            if (!channelOptions.autoFetch.enable || !channelOptions.autoFetch.start || !this.unfetched.length) {\n                return false;\n            }\n            if (!this.debouncedFetch) {\n                var debounceOptions = $.extend(true, {}, {\n                    maxWait: channelOptions.autoFetch.debounce * 4,\n                    leading: false\n                }, options);\n\n                this.debouncedFetch = _.debounce(function (topics) {\n                    this.fetch(this.unfetched).then(function (changed) {\n                        $.extend(currentData, changed);\n                        this.unfetched = [];\n                        this.notify(changed);\n                    }.bind(this));\n                }, channelOptions.autoFetch.debounce, debounceOptions);\n            }\n\n            this.debouncedFetch(topics);\n        },\n\n        fetch: function (variablesList) {\n            // console.log('fetch called', variablesList);\n            variablesList = [].concat(variablesList);\n            var innerVariables = this.getTopicDependencies(variablesList);\n            var getVariables = function (vars, interpolationMap) {\n                return vs.query(vars).then(function (variables) {\n                    // console.log('Got variables', variables);\n                    var changeSet = {};\n                    _.each(variables, function (value, vname) {\n                        var oldValue = currentData[vname];\n                        if (!isEqual(value, oldValue)) {\n                            changeSet[vname] = value;\n                            if (interpolationMap && interpolationMap[vname]) {\n                                var map = [].concat(interpolationMap[vname]);\n                                _.each(map, function (interpolatedName) {\n                                    changeSet[interpolatedName] = value;\n                                });\n                            }\n                        }\n                    });\n                    return changeSet;\n                });\n            };\n            if (innerVariables.length) {\n                return vs.query(innerVariables).then(function (innerVariables) {\n                    //console.log('inner', innerVariables);\n                    $.extend(currentData, innerVariables);\n                    var ip =  interpolate(variablesList, innerVariables);\n                    return getVariables(_.values(ip.interpolated), ip.interpolationMap);\n                });\n            } else {\n                return getVariables(variablesList);\n            }\n        },\n\n        startAutoFetch: function () {\n            channelOptions.autoFetch.start = true;\n            this.updateAndCheckForRefresh();\n        },\n\n        stopAutoFetch: function () {\n            channelOptions.autoFetch.start = false;\n        },\n\n        /**\n         * Check and notify all listeners\n         * @param  {Object | Array} changeList Array or key-value pairs of changed variables.\n         * @param  {Boolean} force skipping checking for silent updates and force trigger\n         */\n        refresh: function (changeList, force) {\n            var me = this;\n            var silent = channelOptions.silent;\n            var changedVariables = _.isArray(changeList) ?  changeList : _.keys(changeList);\n\n            var shouldSilence = silent === true;\n            if (_.isArray(silent) && changedVariables) {\n                shouldSilence = _.intersection(silent, changedVariables).length >= 1;\n            }\n            if ($.isPlainObject(silent) && changedVariables) {\n                shouldSilence = _.intersection(silent.except, changedVariables).length !== changedVariables.length;\n            }\n\n            if (shouldSilence && force !== true) {\n                return $.Deferred().resolve().promise();\n            }\n\n            var variables = this.getAllTopics();\n            me.unfetched = [];\n\n            return this.fetch(variables).then(function (changeSet) {\n                $.extend(currentData, changeSet);\n                me.notify(changeSet);\n            });\n        },\n\n        notify: function (topics, value) {\n            var callTarget = function (target, params) {\n                if (_.isFunction(target)) {\n                    target.call(null, params);\n                } else {\n                    target.trigger(config.events.react, params);\n                }\n            };\n\n            if (!$.isPlainObject(topics)) {\n                topics = _.object([topics], [value]);\n            }\n            _.each(this.subscriptions, function (subscription) {\n                var target = subscription.target;\n                if (subscription.batch) {\n                    var matchingTopics = _.pick(topics, subscription.topics);\n                    if (_.size(matchingTopics) === _.size(subscription.topics)) {\n                        callTarget(target, matchingTopics);\n                    }\n                } else {\n                    _.each(subscription.topics, function (topic) {\n                        var matchingTopics = _.pick(topics, topic);\n                        if (_.size(matchingTopics)) {\n                            callTarget(target, matchingTopics);\n                        }\n                    });\n                }\n            });\n        },\n\n        /**\n         * Variable name & parameters to send to variables API\n         * @param  {String | Object} variable string or {variablename: value}\n         * @param  {*} value (optional)   value of variable if previous arg was a string\n         * @param {Object} options Supported options: {silent: Boolean}\n         * @return {$promise}\n         */\n        publish: function (variable, value, options) {\n            // console.log('publish', arguments);\n            var attrs;\n            if ($.isPlainObject(variable)) {\n                attrs = variable;\n                options = value;\n            } else {\n                (attrs = {})[variable] = value;\n            }\n            var it = interpolate(_.keys(attrs), currentData);\n\n            var toSave = {};\n            _.each(attrs, function (val, attr) {\n               var key = (it.interpolated[attr]) ? it.interpolated[attr] : attr;\n               toSave[key] = val;\n            });\n            var me = this;\n            return vs.save.call(vs, toSave)\n                .then(function () {\n                    if (!options || !options.silent) {\n                        me.refresh.call(me, attrs);\n                    }\n                });\n        },\n\n\n\n       /**\n        * Subscribe to changes on a channel\n        * @param  {Array|String} topics List of topics\n        * @param  {Function|Object} subscriber If this is not a function, a `trigger` method is called if available, if not event is triggered on $(object).\n        * @param  {Object} options       Set `batch` to true or false\n        * @return {String}            Subscription ID. Use this to un-subcribe later\n        */\n        subscribe: function (topics, subscriber, options) {\n            // console.log('subscribing', topics, subscriber);\n            var defaults = {\n                batch: false\n            };\n\n            topics = [].concat(topics);\n            //use jquery to make event sink\n            if (!subscriber.on && !_.isFunction(subscriber)) {\n                subscriber = $(subscriber);\n            }\n\n            var id  = _.uniqueId('epichannel.variable');\n            var data = $.extend({\n                id: id,\n                topics: topics,\n                target: subscriber\n            }, defaults, options);\n\n            this.subscriptions.push(data);\n\n            this.updateAndCheckForRefresh(topics);\n            return id;\n        },\n\n        /**\n         * Un-subscribe from all subscriptions referenced by this token.\n         * @param  {String} token Token obtained from subscribe\n         */\n        unsubscribe: function (token) {\n            this.subscriptions = _.reject(this.subscriptions, function (subs) {\n                return subs.id === token;\n            });\n        },\n\n        /**\n         * Un-subscribe from everything.\n         * @return {[type]} [description]\n         */\n        unsubscribeAll: function () {\n            this.subscriptions = [];\n        }\n    };\n\n    $.extend(this, publicAPI);\n};\n","'use strict';\nvar config = require('../config');\n\nmodule.exports = function (options) {\n    var defaults = {\n        /**\n         * Determine when to update state\n         * @type {String | Array | Object} Possible options are\n         *       - true: never trigger any updates. Use this if you know your model state won't change based on operations\n         *       - false: always trigger updates.\n         *       - [array of variable names]: Variables in this array will not trigger updates, everything else will\n         *       - { except: [array of operations]}: Variables in this array will trigger updates, nothing else will\n         */\n        silent: false\n    };\n\n    var channelOptions = $.extend(true, {}, defaults, options);\n    var run = channelOptions.run;\n\n    var publicAPI = {\n        //for testing\n        private: {\n            options: channelOptions\n        },\n\n        listenerMap: {},\n\n        getSubscribers: function (topic) {\n            var topicSubscribers = this.listenerMap[topic] || [];\n            var globalSubscribers = this.listenerMap['*'] || [];\n            return topicSubscribers.concat(globalSubscribers);\n        },\n\n        //Check for updates\n        /**\n         * Triggers update on sibling variables channel\n         * @param  {string|array} executedOpns operations which just happened\n         * @param  {*} response  response from the operation\n         * @param  {boolean} force  ignore all silence options and force refresh\n         */\n        refresh: function (executedOpns, response, force) {\n            // console.log('Operations refresh', executedOpns);\n            var silent = channelOptions.silent;\n\n            var shouldSilence = silent === true;\n            if (_.isArray(silent) && executedOpns) {\n                shouldSilence = _.intersection(silent, executedOpns).length === silent.length;\n            }\n            if ($.isPlainObject(silent) && executedOpns) {\n                shouldSilence = _.intersection(silent.except, executedOpns).length !== executedOpns.length;\n            }\n\n            if (!shouldSilence || force === true) {\n                var me = this;\n                _.each(executedOpns, function (opn) {\n                    me.notify(opn, response);\n                });\n            }\n        },\n\n        notify: function (operation, value) {\n            var listeners = this.getSubscribers(operation);\n            var params = {};\n            params[operation] = value;\n\n            _.each(listeners, function (listener) {\n                var target = listener.target;\n                if (_.isFunction(target)) {\n                    target.call(null, params, value, operation);\n                } else if (target.trigger) {\n                    listener.target.trigger(config.events.react, params);\n                } else {\n                    throw new Error('Unknown listener format for ' + operation);\n                }\n            });\n        },\n\n        /**\n         * Operation name & parameters to send to operations API\n         * @param  {string | object} operation Name of Operation. If array, needs to be in {operations: [{name: opn, params:[]}], serial: boolean}] format\n         * @param  {*} params (optional)   params to send to opertaion\n         * @param {option} options Supported options: {silent: Boolean}\n         * @return {$promise}\n         */\n        publish: function (operation, params, options) {\n            var me = this;\n            if ($.isPlainObject(operation) && operation.operations) {\n                var fn = (operation.serial) ? run.serial : run.parallel;\n                return fn.call(run, operation.operations)\n                        .then(function (response) {\n                            if (!params || !params.silent) {\n                                me.refresh.call(me, _.pluck(operation.operations, 'name'), response);\n                            }\n                        });\n            } else {\n                //TODO: check if interpolated\n                var opts = ($.isPlainObject(operation)) ? params : options;\n                return run.do.apply(run, arguments)\n                    .then(function (response) {\n                        if (!opts || !opts.silent) {\n                            me.refresh.call(me, [operation], response);\n                        }\n                    });\n            }\n            // console.log('operations publish', operation, params);\n        },\n\n        subscribe: function (operations, subscriber) {\n            // console.log('operations subscribe', operations, subscriber);\n            operations = [].concat(operations);\n            //use jquery to make event sink\n            if (!subscriber.on && !_.isFunction(subscriber)) {\n                subscriber = $(subscriber);\n            }\n\n            var id  = _.uniqueId('epichannel.operation');\n            var data = {\n                id: id,\n                target: subscriber\n            };\n\n            var me = this;\n\n            $.each(operations, function (index, opn) {\n                if (!me.listenerMap[opn]) {\n                    me.listenerMap[opn] = [];\n                }\n                me.listenerMap[opn] = me.listenerMap[opn].concat(data);\n            });\n\n            return id;\n        },\n        unsubscribe: function (operation, token) {\n            this.listenerMap[operation] = _.reject(this.listenerMap[operation], function (subs) {\n                return subs.id === token;\n            });\n        },\n        unsubscribeAll: function () {\n            this.listenerMap = {};\n        }\n    };\n    return $.extend(this, publicAPI);\n};\n","'use strict';\nmodule.exports = {\n    alias: 'i',\n    convert: function (value) {\n        return parseFloat(value, 10);\n    }\n};\n","'use strict';\nmodule.exports = {\n    s: function (val) {\n        return val + '';\n    },\n\n    upperCase: function (val) {\n        return (val + '').toUpperCase();\n    },\n    lowerCase: function (val) {\n        return (val + '').toLowerCase();\n    },\n    titleCase: function (val) {\n        val = val + '';\n        return val.replace(/\\w\\S*/g, function (txt) {return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n    }\n};\n","'use strict';\nvar list = [\n    {\n        alias: 'list',\n        acceptList: true,\n        convert: function (val) {\n            return [].concat(val);\n        }\n    },\n    {\n        alias: 'last',\n        acceptList: true,\n        convert: function (val) {\n            val = [].concat(val);\n            return val[val.length - 1];\n        }\n    },\n    {\n        alias: 'reverse',\n        acceptList: true,\n        convert: function (val) {\n            val = [].concat(val);\n            return val.reverse();\n        }\n    },\n    {\n        alias: 'first',\n        acceptList: true,\n        convert: function (val) {\n            val = [].concat(val);\n            return val[0];\n        }\n    },\n    {\n        alias: 'previous',\n        acceptList: true,\n        convert: function (val) {\n            val = [].concat(val);\n            return (val.length <= 1) ? val[0] : val[val.length - 2];\n        }\n    }\n];\n\n_.each(list, function (item) {\n   var oldfn = item.convert;\n   var newfn = function (val) {\n       if ($.isPlainObject(val)) {\n            return _.mapValues(val, oldfn);\n       } else {\n            return oldfn(val);\n       }\n   };\n   item.convert = newfn;\n});\nmodule.exports = list;\n","'use strict';\nvar list = [];\n\nvar supported = [\n    'values', 'keys', 'compact', 'difference',\n    'flatten', 'rest',\n    'union',\n    'uniq', 'zip', 'without',\n    'xor', 'zip'\n];\n_.each(supported, function (fn) {\n    var item = {\n        alias: fn,\n        acceptList: true,\n        convert: function (val) {\n            if ($.isPlainObject(val)) {\n                return _.mapValues(val, _[fn]);\n            } else {\n                return _[fn](val);\n            }\n        }\n    };\n    list.push(item);\n});\nmodule.exports = list;\n","'use strict';\nmodule.exports = {\n    alias: function (name) {\n        //TODO: Fancy regex to match number formats here\n        return (name.indexOf('#') !== -1 || name.indexOf('0') !== -1);\n    },\n\n    parse: function (val) {\n        val+= '';\n        var isNegative = val.charAt(0) === '-';\n\n        val  = val.replace(/,/g, '');\n        var floatMatcher = /([-+]?[0-9]*\\.?[0-9]+)(K?M?B?%?)/i;\n        var results = floatMatcher.exec(val);\n        var number, suffix = '';\n        if (results && results[1]) {\n            number = results[1];\n        }\n        if (results && results[2]) {\n            suffix = results[2].toLowerCase();\n        }\n\n        switch (suffix) {\n            case '%':\n                number = number / 100;\n                break;\n            case 'k':\n                number = number * 1000;\n                break;\n            case 'm':\n                number = number * 1000000;\n                break;\n            case 'b':\n                number = number * 1000000000;\n                break;\n        }\n        number = parseFloat(number);\n        if (isNegative && number > 0) {\n            number = number * -1;\n        }\n        return number;\n    },\n\n    convert: (function (value) {\n        var scales = ['', 'K', 'M', 'B', 'T'];\n\n        function getDigits(value, digits) {\n            value = value === 0 ? 0 : roundTo(value, Math.max(0, digits - Math.ceil(Math.log(value) / Math.LN10)));\n\n            var TXT = '';\n            var numberTXT = value.toString();\n            var decimalSet = false;\n\n            for (var iTXT = 0; iTXT < numberTXT.length; iTXT++) {\n                TXT += numberTXT.charAt(iTXT);\n                if (numberTXT.charAt(iTXT) === '.') {\n                    decimalSet = true;\n                } else {\n                    digits--;\n                }\n\n                if (digits <= 0) {\n                    return TXT;\n                }\n            }\n\n            if (!decimalSet) {\n                TXT += '.';\n            }\n            while (digits > 0) {\n                TXT += '0';\n                digits--;\n            }\n            return TXT;\n        }\n\n        function addDecimals(value, decimals, minDecimals, hasCommas) {\n            hasCommas = hasCommas || true;\n            var numberTXT = value.toString();\n            var hasDecimals = (numberTXT.split('.').length > 1);\n            var iDec = 0;\n\n            if (hasCommas) {\n                for (var iChar = numberTXT.length - 1; iChar > 0; iChar--) {\n                    if (hasDecimals) {\n                        hasDecimals = (numberTXT.charAt(iChar) !== '.');\n                    } else {\n                        iDec = (iDec + 1) % 3;\n                        if (iDec === 0) {\n                            numberTXT = numberTXT.substr(0, iChar) + ',' + numberTXT.substr(iChar);\n                        }\n                    }\n                }\n\n            }\n            if (decimals > 0) {\n                var toADD;\n                if (numberTXT.split('.').length <= 1) {\n                    toADD = minDecimals;\n                    if (toADD > 0) {\n                        numberTXT += '.';\n                    }\n                } else {\n                    toADD = minDecimals - numberTXT.split('.')[1].length;\n                }\n\n                while (toADD > 0) {\n                    numberTXT += '0';\n                    toADD--;\n                }\n            }\n            return numberTXT;\n        }\n\n        function roundTo(value, digits) {\n            return Math.round(value * Math.pow(10, digits)) / Math.pow(10, digits);\n        }\n\n        function getSuffix(formatTXT) {\n            formatTXT = formatTXT.replace('.', '');\n            var fixesTXT = formatTXT.split(new RegExp('[0|,|#]+', 'g'));\n            return (fixesTXT.length > 1) ? fixesTXT[1].toString() : '';\n        }\n\n        function isCurrency(string) {\n            var s = $.trim(string);\n\n            if (s === '$' ||\n                s === '' ||\n                s === '' ||\n                s === '' ||\n                s === '' ||\n                s === '' ||\n                s === 'K?' ||\n                s === 'kr' ||\n                s === '' ||\n                s === '' ||\n                s === '' ||\n                s === '' ||\n                s === '') {\n\n                return true;\n            }\n\n            return false;\n        }\n\n        function format(number, formatTXT) {\n            if (_.isArray(number)) {\n                number = number[number.length - 1];\n            }\n            if (!_.isString(number) && !_.isNumber(number)) {\n                return number;\n            }\n\n            if (!formatTXT || formatTXT.toLowerCase() === 'default') {\n                return number.toString();\n            }\n\n            if (isNaN(number)) {\n                return '?';\n            }\n\n            //var formatTXT;\n            formatTXT = formatTXT.replace('&euro;', '');\n\n            // Divide +/- Number Format\n            var formats = formatTXT.split(';');\n            if (formats.length > 1) {\n                return format(Math.abs(number), formats[((number >= 0) ? 0 : 1)]);\n            }\n\n            // Save Sign\n            var sign = (number >= 0) ? '' : '-';\n            number = Math.abs(number);\n\n\n            var leftOfDecimal = formatTXT;\n            var d = leftOfDecimal.indexOf('.');\n            if (d > -1) {\n                leftOfDecimal = leftOfDecimal.substring(0, d);\n            }\n\n            var normalized = leftOfDecimal.toLowerCase();\n            var index = normalized.lastIndexOf('s');\n            var isShortFormat = index > -1;\n\n            if (isShortFormat) {\n                var nextChar = leftOfDecimal.charAt(index + 1);\n                if (nextChar === ' ') {\n                    isShortFormat = false;\n                }\n            }\n\n            var leadingText = isShortFormat ? formatTXT.substring(0, index) : '';\n            var rightOfPrefix = isShortFormat ? formatTXT.substr(index + 1) : formatTXT.substr(index);\n\n            //first check to make sure 's' is actually short format and not part of some leading text\n            if (isShortFormat) {\n                var shortFormatTest = /[0-9#*]/;\n                var shortFormatTestResult = rightOfPrefix.match(shortFormatTest);\n                if (!shortFormatTestResult || shortFormatTestResult.length === 0) {\n                    //no short format characters so this must be leading text ie. 'weeks '\n                    isShortFormat = false;\n                    leadingText = '';\n                }\n            }\n\n            //if (formatTXT.charAt(0) == 's')\n            if (isShortFormat) {\n                var valScale = number === 0 ? 0 : Math.floor(Math.log(Math.abs(number)) / (3 * Math.LN10));\n                valScale = ((number / Math.pow(10, 3 * valScale)) < 1000) ? valScale : (valScale + 1);\n                valScale = Math.max(valScale, 0);\n                valScale = Math.min(valScale, 4);\n                number = number / Math.pow(10, 3 * valScale);\n                //if (!isNaN(Number(formatTXT.substr(1) ) ) )\n\n                if (!isNaN(Number(rightOfPrefix)) && rightOfPrefix.indexOf('.') === -1) {\n                    var limitDigits = Number(rightOfPrefix);\n                    if (number < Math.pow(10, limitDigits)) {\n                        if (isCurrency(leadingText)) {\n                            return sign + leadingText + getDigits(number, Number(rightOfPrefix)) + scales[valScale];\n                        } else {\n                            return leadingText + sign + getDigits(number, Number(rightOfPrefix)) + scales[valScale];\n                        }\n                    } else {\n                        if (isCurrency(leadingText)) {\n                            return sign + leadingText + Math.round(number) + scales[valScale];\n                        } else {\n                            return leadingText + sign + Math.round(number) + scales[valScale];\n                        }\n                    }\n                } else {\n                    //formatTXT = formatTXT.substr(1);\n                    formatTXT = formatTXT.substr(index + 1);\n                    var SUFFIX = getSuffix(formatTXT);\n                    formatTXT = formatTXT.substr(0, formatTXT.length - SUFFIX.length);\n\n                    var valWithoutLeading = format(((sign === '') ? 1 : -1) * number, formatTXT) + scales[valScale] + SUFFIX;\n                    if (isCurrency(leadingText) && sign !== '') {\n                        valWithoutLeading = valWithoutLeading.substr(sign.length);\n                        return sign + leadingText + valWithoutLeading;\n                    }\n\n                    return leadingText + valWithoutLeading;\n                }\n            }\n\n            var subFormats = formatTXT.split('.');\n            var decimals;\n            var minDecimals;\n            if (subFormats.length > 1) {\n                decimals = subFormats[1].length - subFormats[1].replace(new RegExp('[0|#]+', 'g'), '').length;\n                minDecimals = subFormats[1].length - subFormats[1].replace(new RegExp('0+', 'g'), '').length;\n                formatTXT = subFormats[0] + subFormats[1].replace(new RegExp('[0|#]+', 'g'), '');\n            } else {\n                decimals = 0;\n            }\n\n            var fixesTXT = formatTXT.split(new RegExp('[0|,|#]+', 'g'));\n            var preffix = fixesTXT[0].toString();\n            var suffix = (fixesTXT.length > 1) ? fixesTXT[1].toString() : '';\n\n            number = number * ((formatTXT.split('%').length > 1) ? 100 : 1);\n            //            if (formatTXT.indexOf('%') !== -1) number = number * 100;\n            number = roundTo(number, decimals);\n\n            sign = (number === 0) ? '' : sign;\n\n            var hasCommas = (formatTXT.substr(formatTXT.length - 4 - suffix.length, 1) === ',');\n            var formatted = sign + preffix + addDecimals(number, decimals, minDecimals, hasCommas) + suffix;\n\n            //  console.log(originalNumber, originalFormat, formatted)\n            return formatted;\n        }\n\n        return format;\n    }())\n};\n","'use strict';\nvar BaseView = require('./default-input-node');\n\nmodule.exports = BaseView.extend({\n\n    propertyHandlers: [\n\n    ],\n\n    getUIValue: function () {\n        var $el = this.$el;\n        //TODO: file a issue for the vensim manager to convert trues to 1s and set this to true and false\n\n        var offVal =  ($el.data('f-off') !== undefined) ? $el.data('f-off') : 0;\n        //attr = initial value, prop = current value\n        var onVal = ($el.attr('value') !== undefined) ? $el.prop('value'): 1;\n\n        var val = ($el.is(':checked')) ? onVal : offVal;\n        return val;\n    },\n    initialize: function () {\n        BaseView.prototype.initialize.apply(this, arguments);\n    }\n}, { selector: ':checkbox,:radio' });\n","'use strict';\nvar config = require('../../config');\nvar BaseView = require('./default-node');\n\nmodule.exports = BaseView.extend({\n    propertyHandlers: [],\n\n    uiChangeEvent: 'change',\n    getUIValue: function () {\n        return this.$el.val();\n    },\n\n    removeEvents: function () {\n        this.$el.off(this.uiChangeEvent);\n    },\n\n    initialize: function () {\n        var me = this;\n        var propName = this.$el.data(config.binderAttr);\n\n        if (propName) {\n            this.$el.off(this.uiChangeEvent).on(this.uiChangeEvent, function () {\n                var val = me.getUIValue();\n\n                var params = {};\n                params[propName] = val;\n\n                me.$el.trigger(config.events.trigger, params);\n            });\n        }\n        BaseView.prototype.initialize.apply(this, arguments);\n    }\n}, { selector: 'input, select' });\n","'use strict';\n\nvar BaseView = require('./base');\n\nmodule.exports = BaseView.extend({\n    propertyHandlers: [\n\n    ],\n\n    initialize: function () {\n    }\n}, { selector: '*' });\n","'use strict';\n\n// Attributes which are just parameters to others and can just be ignored\nmodule.exports = {\n\n    target: '*',\n\n    test: /^(?:model|convert)$/i,\n\n    handle: $.noop,\n\n    init: function () {\n        return false;\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    target: '*',\n\n    test: function (attr, $node) {\n        return (attr.indexOf('on-init') === 0);\n    },\n\n    init: function (attr, value) {\n        attr = attr.replace('on-init', '');\n        var me = this;\n        $(function () {\n            var listOfOperations = _.invoke(value.split('|'), 'trim');\n            listOfOperations = listOfOperations.map(function (value) {\n                var fnName = value.split('(')[0];\n                var params = value.substring(value.indexOf('(') + 1, value.indexOf(')'));\n                var args = ($.trim(params) !== '') ? params.split(',') : [];\n                return { name: fnName, params: args };\n            });\n\n            me.trigger('f.ui.operate', { operations: listOfOperations, serial: true });\n        });\n        return false; //Don't bother binding on this attr. NOTE: Do readonly, true instead?;\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    target: '*',\n\n    test: function (attr, $node) {\n        return (attr.indexOf('on-') === 0);\n    },\n\n    stopListening: function (attr) {\n        attr = attr.replace('on-', '');\n        this.off(attr);\n    },\n\n    init: function (attr, value) {\n        attr = attr.replace('on-', '');\n        var me = this;\n        this.off(attr).on(attr, function () {\n            var listOfOperations = _.invoke(value.split('|'), 'trim');\n            listOfOperations = listOfOperations.map(function (value) {\n                var fnName = value.split('(')[0];\n                var params = value.substring(value.indexOf('(') + 1, value.indexOf(')'));\n                var args = ($.trim(params) !== '') ? params.split(',') : [];\n                return { name: fnName, params: args };\n            });\n\n            me.trigger('f.ui.operate', { operations: listOfOperations, serial: true });\n        });\n        return false; //Don't bother binding on this attr. NOTE: Do readonly, true instead?;\n    }\n};\n","'use strict';\nvar parseUtils = require('../../../utils/parse-utils');\nmodule.exports = {\n\n    test: 'foreach',\n\n    target: '*',\n\n    handle: function (value, prop) {\n        value = ($.isPlainObject(value) ? value : [].concat(value));\n        var $loopTemplate = this.data('foreach-template');\n        if (!$loopTemplate) {\n            $loopTemplate = this.children();\n            this.data('foreach-template', $loopTemplate);\n        }\n        var $me = this.empty();\n        _.each(value, function (dataval, datakey) {\n            dataval = dataval + '';\n            var nodes = $loopTemplate.clone();\n            nodes.each(function (i, newNode) {\n                newNode = $(newNode);\n                _.each(newNode.data(), function (val, key) {\n                    var templated =  _.template(val, { value: dataval, index: datakey, key: datakey });\n                    newNode.data(key, parseUtils.toImplicitType(templated));\n                });\n                var oldHTML = newNode.html();\n                var cleanedHTML = oldHTML.replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n                var templated = _.template(cleanedHTML, { value: dataval, key: datakey, index: datakey });\n                if (cleanedHTML === templated) {\n                    newNode.html(dataval);\n                } else {\n                    newNode.html(templated);\n                }\n                $me.append(newNode);\n            });\n        });\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    target: ':checkbox,:radio',\n\n    test: 'bind',\n\n    handle: function (value) {\n        if (_.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        var settableValue = this.attr('value'); //initial value\n        /*jslint eqeq: true*/\n        var isChecked = (settableValue !== undefined) ? (settableValue == value) : !!value;\n        this.prop('checked', isChecked);\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    target: 'input, select',\n\n    test: 'bind',\n\n    handle: function (value) {\n        if (_.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        this.val(value);\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    test: 'class',\n\n    target: '*',\n\n    handle: function (value, prop) {\n        if (_.isArray(value)) {\n            value = value[value.length - 1];\n        }\n\n        var addedClasses = this.data('added-classes');\n        if (!addedClasses) {\n            addedClasses = {};\n        }\n        if (addedClasses[prop]) {\n            this.removeClass(addedClasses[prop]);\n        }\n\n        if (_.isNumber(value)) {\n            value = 'value-' + value;\n        }\n        addedClasses[prop] = value;\n        //Fixme: prop is always \"class\"\n        this.addClass(value);\n        this.data('added-classes', addedClasses);\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    target: '*',\n\n    test: /^(?:checked|selected|async|autofocus|autoplay|controls|defer|ismap|loop|multiple|open|required|scoped)$/i,\n\n    handle: function (value, prop) {\n        if (_.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        /*jslint eqeq: true*/\n        var val = (this.attr('value')) ? (value == this.prop('value')) : !!value;\n        this.prop(prop, val);\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    target: '*',\n\n    test: /^(?:disabled|hidden|readonly)$/i,\n\n    handle: function (value, prop) {\n        if (_.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        this.prop(prop, !value);\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    target: '*',\n\n    test: 'bind',\n\n    handle: function (value) {\n        var templated;\n        var valueToTemplate = value;\n        if (!$.isPlainObject(value)) {\n            var variableName = this.data('f-bind');//Hack because i don't have access to variable name here otherwise\n            valueToTemplate = { value: value };\n            valueToTemplate[variableName] = value;\n        }\n        var bindTemplate = this.data('bind-template');\n        if (bindTemplate) {\n            templated = _.template(bindTemplate, valueToTemplate);\n            this.html(templated);\n        } else {\n            var oldHTML = this.html();\n            var cleanedHTML = oldHTML.replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n            templated = _.template(cleanedHTML, valueToTemplate);\n            if (cleanedHTML === templated) { //templating did nothing\n                if (_.isArray(value)) {\n                    value = value[value.length - 1];\n                }\n                value += '';\n                this.html(value);\n            } else {\n                this.data('bind-template', cleanedHTML);\n                this.html(templated);\n            }\n        }\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    test: '*',\n\n    target: '*',\n\n    handle: function (value, prop) {\n        this.prop(prop, value);\n    }\n};\n","'use strict';\n\nvar extend = function (protoProps, staticProps) {\n    var parent = this;\n    var child;\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (protoProps && _.has(protoProps, 'constructor')) {\n        child = protoProps.constructor;\n    } else {\n        child = function () { return parent.apply(this, arguments); };\n    }\n\n    // Add static properties to the constructor function, if supplied.\n    _.extend(child, parent, staticProps);\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () { this.constructor = child; };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate();\n\n    // Add prototype properties (instance properties) to the subclass,\n    // if supplied.\n    if (protoProps) {\n        _.extend(child.prototype, protoProps);\n    }\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    return child;\n};\n\nvar View = function (options) {\n    this.$el = (options.$el) || $(options.el);\n    this.el = options.el;\n    this.initialize.apply(this, arguments);\n\n};\n\n_.extend(View.prototype, {\n    initialize: function () {},\n});\n\nView.extend = extend;\n\nmodule.exports = View;\n"]}