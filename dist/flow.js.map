{"version":3,"sources":["webpack:///webpack/bootstrap 5b1317d5833f7e76d0af","webpack:///external \"_\"","webpack:///./src/config.js","webpack:///./src/channels/channel-router/utils/index.js","webpack:///./src/utils/parse-utils.js","webpack:///./src/channels/channel-utils.js","webpack:///./src/channels/channel-router/index.js","webpack:///./src/channels/route-handlers/route-matchers.js","webpack:///./src/utils/general/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/index.js","webpack:///./src/utils/animation.js","webpack:///./src/dom/attribute-manager/attr-template-utils.js","webpack:///./src/dom/node-manager/default-input-node.js","webpack:///./src/dom/node-manager/default-node.js","webpack:///./src/dom/attribute-manager/attributes/loop-attrs/loop-attr-utils.js","webpack:///./src/utils/general/promise-utils.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-utils.js","webpack:///./src/channels/channel-manager-enhancements/interpolatable/interpolatable-utils.js","webpack:///./src/flow.js","webpack:///./src/dom/dom-manager.js","webpack:///./src/dom/dom-manager-utils/dom-parse-helpers/index.js","webpack:///./src/dom/dom-manager-utils/dom-parse-helpers/parse-converters.js","webpack:///./src/dom/dom-manager-utils/dom-parse-helpers/parse-channel.js","webpack:///./src/dom/dom-manager-utils/dom-parse-helpers/parse-topics.js","webpack:///./src/dom/dom-manager-utils/dom-channel-prefix-helpers/index.js","webpack:///./src/dom/converter-manager/index.js","webpack:///./src/dom/converter-manager/converters/number-converters/index.js","webpack:///./src/dom/converter-manager/converters/string-converters/index.js","webpack:///./src/dom/converter-manager/converters/array-converters/index.js","webpack:///./src/dom/converter-manager/converters/general-util-converters/index.js","webpack:///./src/dom/converter-manager/converters/numberformat-converter/index.js","webpack:///./src/dom/converter-manager/converters/number-compare-converters/index.js","webpack:///./src/dom/converter-manager/converters/boolean-conditional-converters/index.js","webpack:///./src/dom/converter-manager/converters/collection-converters/index.js","webpack:///./src/dom/node-manager/index.js","webpack:///./src/dom/node-manager/input-checkbox-node.js","webpack:///./src/utils/base-view.js","webpack:///./src/dom/attribute-manager/index.js","webpack:///./src/dom/attribute-manager/attributes/no-op-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/events/default-event-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/loop-attrs/foreach-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/loop-attrs/repeat-attr/index.js","webpack:///./src/utils/general/debounce-and-merge.js","webpack:///./src/dom/attribute-manager/attributes/class-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/boolean-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/toggles/show-if-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/toggles/hide-if-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/binds/checkbox-radio-bind-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/binds/input-bind-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/binds/default-bind-attr/index.js","webpack:///./src/dom/attribute-manager/attributes/binds/bind-utils/index.js","webpack:///./src/dom/attribute-manager/attributes/default-attr/index.js","webpack:///./src/dom/plugins/auto-update-bindings.js","webpack:///./src/channels/configured-channel-manager.js","webpack:///./src/channels/channel-manager.js","webpack:///external \"jQuery\"","webpack:///./src/channels/channel-router/utils/handler-utils.js","webpack:///./src/channels/channel-router/utils/silencable.js","webpack:///./src/channels/channel-router/utils/exclude-read-only.js","webpack:///./src/channels/route-handlers/index.js","webpack:///./src/channels/route-handlers/json-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/default-run-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-meta-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-variables-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-variables-route-handler/retriable-variable-fetch.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-operations-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/scenario-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/runid-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/run-router-factory.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/world-users-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/world-current-user-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/index.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-operations-handler.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-status-handler.js","webpack:///./src/channels/route-handlers/epicenter-route-handlers/multi-run-route-handler/index.js","webpack:///./src/channels/route-handlers/dom-route-handler/index.js","webpack:///./src/channels/channel-manager-enhancements/index.js","webpack:///./src/channels/channel-manager-enhancements/interpolatable/index.js","webpack:///./src/channels/channel-manager-enhancements/interpolatable/subscribe-interpolator.js","webpack:///./src/channels/channel-manager-enhancements/interpolatable/publish-interpolator.js","webpack:///./src/channels/channel-manager-enhancements/routable/index.js"],"names":["module","exports","prefix","binderAttr","events","trigger","convert","error","attrs","checkboxOffValue","repeat","templateId","errorAttr","animation","addAttr","changeAttr","initialAttr","CHANNEL_DELIMITER","stripSuffixDelimiter","text","indexOf","length","replace","mapWithPrefix","dataArray","map","datapt","name","$","extend","withPrefix","callback","prefixList","arr","concat","data","forEach","mapped","unprefixTopics","list","unprefixed","item","unprefix","toImplicitType","objRegex","arrRegex","converted","trim","charAt","substring","isNumeric","test","bracketReplaced","parsed","split","val","JSON","parse","e","console","splitUnescapedCommas","str","regex","m","op","exec","index","lastIndex","match","groupIndex","push","splitNameArgs","value","fnName","params","args","p","toPublishableFormat","OPERATIONS_SEPERATOR","listOfOperations","objectToPublishable","obj","Object","keys","t","publishableToObject","mergeWith","result","reduce","accum","topic","normalizeParamOptions","publishValue","options","isPlainObject","Array","isArray","notifySubscribeHandlers","handlers","topics","grouped","groupByHandlers","promises","filter","handler","subscribeHandler","mergedOptions","matched","promise","makePromise","subsResponse","then","topicsWithData","normalized","normalizeSubscribeResponse","prefixed","when","apply","arguments","notifyUnsubscribeHandlers","recentlyUnsubscribedTopics","remainingTopics","h","unsubsKey","unsubsGrouped","remainingGrouped","unsubscribeHandler","unprefixedUnsubs","matchingRemainingHandler","_","find","remainingHandler","matchingTopicsRemaining","unprefixedRemaining","passthroughPublishInterceptors","publishData","groupSequentiallyByHandlers","$initialProm","Deferred","resolve","dataSoFar","publishableData","excludeReadOnly","readOnly","publishHandler","publishProm","published","silencable","silent","isDefault","router","notifier","myHandlers","Handler","isFunction","expose","matchString","addRoute","Error","id","uniqueId","unshift","removeRoute","routeid","ROUTE_DELIMITER","matchPrefix","prefixMatcher","hasPrefix","isOnlyPrefix","matchDefaultPrefix","defaultPrefixMatcher","forcePrefix","matchRegex","toMatch","RegExp","regexMatcher","random","min","max","parseInt","rnd","_random","VARIABLES_PREFIX","META_PREFIX","OPERATIONS_PREFIX","_shouldFetch","ignoreOperations","filtered","r","isIgnored","isVariable","isOperation","RunService","F","service","Run","GenericRunRouteHandler","config","defaults","serviceOptions","channelOptions","variables","autoFetch","debounce","operations","meta","opts","rs","operationNotifier","variableNotifier","metaHandler","operationsHandler","variablesHandler","subscribed","channel","TOPICS","subscribeOpts","includeMine","subscribe","RUN_VARIABLES","publishable","excludingSilenced","notify","fetch","RUN_OPERATIONS","CONSENSUS_UPDATE","consensus","closed","RUN_RESET","runRouter","oldhandler","prom","shouldFetch","excludeFromFetch","exclude","_findMostConsequtive","reduced","prev","count","maxCount","Math","buildDiffArray","currentcontents","newContents","contents","isSame","fill","a","i","elToContents","el","outerHTML","elementsToContents","$els","child","get","addChangeClassesToList","$currentEls","$newEls","isInitial","reversedContents","diffFromEnd","diffFromBeginning","slice","reverse","endMatches","beginningMatches","placeHoldersCount","placeHolders","undefined","$el","eq","curr","removeAttr","attr","addContentAndAnimate","newValue","current","html","setTimeout","CURRENT_INDEX_KEY","CURRENT_INDEX_ATTR","getKnownDataForEl","closestKnownDataEl","closest","knownData","updateKnownDataForEl","stringify","removeKnownData","getTemplateTags","template","templateTagsUsed","isTemplated","findMissingReferences","knownDataKeys","isKnownTag","tag","knownTags","key","missingReferences","refKey","refToMarkup","stubMissingReferences","refId","addBackMissingReferences","originalTemplateVal","commentRef","elTemplateMap","WeakMap","getOriginalContents","resolver","originalHTML","set","clearOriginalContents","delete","BaseView","propertyHandlers","uiChangeEvent","getUIValue","removeEvents","off","initialize","propName","triggerChangeOn","changeHandler","payload","source","restoreOriginal","bind","handlerDebounceTime","debouncedHandler","on","prototype","selector","require","IN_OF_REGEX","KEY_VALUE_REGEX","extractVariableName","attrVal","inMatch","varName","parseKeyAlias","itMatch","alias","parseValueAlias","aliasesFromTopics","relevantTopic","defaultKey","keyAlias","valueAlias","parseTopics","$def","toReturn","reject","promisify","fn","promisifiedFunction","makeConsensusService","consensisAPIResponse","window","Consensus","stage","consensusGroup","worldId","interpolationRegex","extractDependencies","deps","interpolateWithValues","interpolatedTopic","dependency","toReplace","Flow","dom","utils","model","run","root","autoBind","domManager","unbindAll","bindAll","ChannelManager","constants","version","expr","pseudos","attributes","nodeName","getMatchingElements","$root","matchedElements","is","add","getElementOrError","element","context","triggerError","msg","message","unbindAllAttributes","domEl","each","nodeMap","wantedPrefix","attrManager","getHandler","unbind","unbindAllNodeHandlers","nodeManager","handle","removeAllSubscriptions","subscriptions","subs","unsubscribe","publicAPI","nodes","converters","Map","unbindElement","existingData","subsid","subscriptionId","animAttrs","join","removeData","bindElement","isExcluded","changeEventOverrides","uiChangeEvents","triggerSelector","matchingEvent","filterPrefix","attrList","parseTopicsFromAttributeValue","init","channelPrefix","getChannelForAttribute","addPrefixToTopics","getConvertersForEl","channelConfig","getChannelConfigForElement","attrsWithSubscriptions","subsOptions","batch","onError","subscribableTopics","isEqual","previousData","toConvert","dataForAttr","pick","k","assign","elementsToBind","elementsToUnbind","me","plugins","attachUIListeners","parseValue","converterManager","evt","elMeta","target","sourceMeta","action","parsedValue","actualName","prefixedName","addDefaultPrefix","publish","last","attachConversionListner","prop","convertedValue","deferred","autoUpdatePlugin","convertersToArray","conv","v","getConvertersFromAttr","attribute","withConv","getFConvertAttrVal","suffix","baseAttr","suffixAttr","getAllConverters","convertersAsPipes","whiteListedGenericAttributes","canUseFConvert","$parentEl","parents","resolvedConverters","parentConv","attrib","specified","commaRegex","topicsPart","mappedTopics","currentName","hasChannelDefined","DEFAULT_OPERATIONS_PREFIX","DEFAULT_VARIABLES_PREFIX","isUnprefixed","defaultPrefix","needsDefaultPrefix","hasDefaultPrefix","normalize","converter","acceptList","ret","matchConverter","isString","isRegExp","private","register","currentConverter","splice","getConverter","norm","Function","currentValue","convertArray","converterName","convertObject","mapValues","defaultconverters","c","parseFloat","plus","operand","Number","minus","multiplyBy","divideBy","s","upperCase","toUpperCase","lowerCase","toLowerCase","titleCase","txt","substr","parseLimitArgs","starting","limit","toRet","input","n","stripped","first","previous","size","src","pickEvery","startIndex","newfn","toArray","indexOfActualValue","newArgs","parseArgs","toCompare","trueVal","falseVal","valueToCompare","isNumber","isAllowedLeading","validPrefixes","checkValMatch","validStandalone","validFirstChars","validLastChars","isValidFirstChar","isValidLastChar","validRemainingChars","areRemainingCharactersValid","char","isMatch","parts","isNegative","floatMatcher","results","number","scales","roundTo","digits","round","pow","getDigits","ceil","log","LN10","TXT","numberTXT","toString","decimalSet","iTXT","addDecimals","decimals","minDecimals","hasCommas","hasDecimals","iDec","iChar","toADD","getSuffix","formatTXT","fixesTXT","format","isNaN","entityCodeMapping","code","formats","abs","sign","leftOfDecimal","d","lastIndexOf","isShortFormat","nextChar","leadingText","rightOfPrefix","shortFormatTest","shortFormatTestResult","valScale","floor","limitDigits","SUFFIX","valWithoutLeading","subFormats","preffix","formatted","greaterThan","greaterThanEqual","equalsNumber","lessThan","lessThanEqual","toBool","not","ifTrue","ifFalse","valueToFilterBy","except","valueToReject","any","some","every","node","currentHandler","defaultHandlers","default","offAttr","offAttrVal","offVal","onAttrVal","onVal","has","extendView","protoProps","staticProps","constructor","Surrogate","__super__","View","handlersList","attributeMatcher","nodeMatcher","matchAttr","matchExpr","attrMatch","matchNode","nodeFilter","attributeManager","attrFilter","noopAttr","eventNameFromAttr","eventName","nameSpacedEvent","defaultEventAttr","matching","preventDefault","elAnimatedMap","foreachAttr","stubbedTemplate","templateFn","$dummyEl","dataval","datakey","templateData","templated","templatedWithReferences","newNode","$newNode","append","isInitialAnim","$withAnimAttrs","children","empty","templateIdAttr","loopAttrHandler","nextUntil","remove","replaceWith","$dummyOldDiv","$removed","isEmpty","hasData","insertAfter","executeAndResolve","promisifiedFn","debounceAndMerge","debounceInterval","argumentsReducers","arrayReducer","newVal","queue","timer","mergeArgs","oldArgs","merged","newArg","reducer","debouncedFunction","call","clearTimeout","mergedArgs","pop","elClassesMap","deleteAddedClasses","addedClasses","removeClass","classAttr","addClass","booleanAttrHandler","showifHandler","hide","show","hideifHandler","checkboxAttrHandler","settableValue","isChecked","inputBindAttr","toAliasMap","getNewContent","currentContents","translateDataToInsertable","translateDataToTemplatable","templatedHTML","bindAttrHandler","extractAlias","bindTemplate","originalContents","aliasMap","originalName","AS_REGEX","asMatch","defaultAttr","isEnabled","MutationObserver","observer","mutations","mutation","added","addedNodes","removed","removedNodes","attributeName","mutconfig","attributeFilter","childList","subtree","characterData","publicApi","enable","observe","disable","disconnect","InterpolatableRoutableChannelManager","interpolatable","routable","defaultRouteHandlers","routes","cm","makeSubs","cache","cacheBySubsId","sentDataBySubsId","copy","callbackSubscriber","subscription","checkAndNotifyBatch","matchingTopics","intersection","relevantDataFromPublish","cachedDataForSubs","knownDataForSubs","hasDataForAllTopics","checkAndNotify","needsThisTopic","isWildCard","getTopicsFromSubsList","subcriptionList","publishResponses","cb","token","olderLength","remaining","uniq","findBestHandler","matchOptions","thishandler","topicMapping","bestHandler","values","dataPt","lastHandler","response","isAlreadyInPublishableFormat","silentOptions","found","readOnlyOptions","isReadonly","warn","getOptions","SCENARIO_PREFIX","RUN_PREFIX","WORLD_PREFIX","sampleRunidLength","runidRegex","EpicenterRouteHandler","channelManagerContext","runidHandlerOpts","runidHandler","multiRunHandler","exposable","runManagerOpts","runManager","scenarioManager","rm","hasEnoughInfo","isMultiplayer","strategy","scenarioManagerOpts","sm","epicenterRouter","RunManagerRouteHandler","rmOptions","manager","RunManager","$creationPromise","getRun","currentChannelOpts","currentRunChannel","runRouteHandler","runMangerRouter","RunMetaRouteHandler","$runServicePromise","mergeAndSend","runMeta","requestedTopics","toSend","runService","cachedValues","loadPromise","load","toSave","save","res","mergeVariables","newval","RunVariablesRouteHandler","debouncedVariableQuery","debouncedFetchers","retriableFetch","knownTopics","variablesToFetch","difference","unsubscribedTopics","isUnsubscribed","isRemaining","isAutoFetchEnabled","missingVariables","variableData","query","catch","responseJSON","info","information","goodVariables","vName","baseName","isBad","names","RunOperationsRouteHandler","operationsResponse","serial","ScenarioManagerRouteHandler","ScenarioManager","baselinePromise","baseline","baselineOptions","currentRunPromise","runOptions","baselineHandler","currentRunHandler","scenarioManagerRouter","RunidRouteHandler","runid","runChannelFactory","knownRunIDServiceChannels","runChannel","MULTI_USER_PREFIX","USER_PREFIX","CONSENSUS_PREFIX","WorldRoutesHandler","runPromise","world","err","$runPromise","alreadyStubbedRunChannel","channelManager","worldChannel","getWorldChannel","updateConfig","currentRunHandlerOpts","$worldProm","getWorld","worldChannelMap","getChannelForWorld","worldid","am","AuthManager","handlerOptions","getSession","getCurrentUserSessionInfo","getChannel","usersRouteHandler","usersHandler","currentUserRouteHandler","currentUserHandler","ConsensusManager","consensusRouteHandler","consensusHandler","worldRouteHandler","WorldUsersRouteHandler","store","users","mark","userid","isOnline","u","userId","parsedUsersPromise","session","lastName","isMe","presenceSubsId","userids","PRESENCE","user","ps","Presence","markOnline","markOffline","WorldCurrentUserRouteHandler","stillNeedRoles","userFields","myUser","toNotify","field","isSubscribingToRole","ROLES","role","ConsensusRouteHandler","consensusProm","getConsensus","force","getCurrent","opnHandler","OperationsHandler","statusHandler","StatusHandler","status","isComplete","consensusManager","ConsensusOperationsHandler","actions","cs","submitActions","ConsensusStatusHandler","normalizePlayers","rolePlayerMap","playersForRole","playersWithRole","player","userName","normalizeConsensus","submitted","amWaiting","pending","normalizedConsensus","dataForTopics","TypeError","forceClose","MultiRunRouteHandler","topicParamMap","extractFiltersFromTopic","topicString","filters","filterParam","include","runs","debouncedFetch","subsMap","DOMRouteHandler","knownEls","domOptions","debouncedChangeHandler","elID","overrides","matchingEventOverride","changeEvent","toKill","subsidMap","subscribeInterpolator","dependencySubsId","newDependentId","existing","publishInterpolator","getDependencies","inner","interpolateWithDependencies","mergeInterpolatedTopicsWithData","originalTopics","interpolatedTopics","original","subscribeFn","onDependencyChange","interpolatedSubscribe","dependencies","innerSubsId","handleDependencyValueChange","dependenciesMeta","isSameData","outerSubsId","handleInterpolatedValueChange","actualData","actualMeta","toSendback","noop","publishInputs","valuesToInterpolate","ip","publishFunction","fetchFn","interpolatedPublishfunction","normalizedPublishInputs","handleDependencyChange","resolvedDependencies","interpolated","newPublishProm","allTopics","withRouter","BaseChannelManager","optsToPassOn","omit","rt"],"mappings":"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","file":"flow.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 17);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5b1317d5833f7e76d0af","module.exports = _;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"_\"\n// module id = 0\n// module chunks = 0","module.exports = {\n    prefix: 'f',\n    binderAttr: 'f-bind',\n\n    events: {\n        /** UI Change to publish to the channel. */\n        trigger: 'update.f.ui',\n\n        /** Trigger with payload '{attrToUpdate: value}', for e.g. { bind: 34 }. This will run this through all the converts and pass it to attr handler. Useful to by-pass getting this from the model directly.  */\n        convert: 'f.convert',\n\n        /** On a bind or other flow-related error  */\n        error: 'f.error',\n    },\n\n    attrs: {\n        checkboxOffValue: 'data-off-value',\n        //Used by repeat attr handler to keep track of template after first evaluation\n        repeat: {\n            templateId: 'repeat-template-id' //don't prefix by f or dom-manager unbind will kill it\n        },\n    },\n\n    errorAttr: 'data-flow-error',\n    animation: {\n        addAttr: 'data-add',\n        changeAttr: 'data-update',\n        initialAttr: 'data-initial',\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","const CHANNEL_DELIMITER = ':';\n\nexport { default as silencable } from './silencable';\nexport { default as excludeReadOnly } from './exclude-read-only';\n\n/**\n * \n * @param {string} text\n * @returns {string}\n */\nexport function stripSuffixDelimiter(text) {\n    if (text && text.indexOf(CHANNEL_DELIMITER) === (text.length - 1)) {\n        text = text.replace(CHANNEL_DELIMITER, '');\n    }\n    return text;\n}\n\n/**\n * \n * @param {Publishable[]} dataArray \n * @param {string} prefix \n * @returns {Publishable[]} array with name prefixed\n */\nexport function mapWithPrefix(dataArray, prefix) {\n    if (!prefix) return dataArray;\n    return (dataArray || []).map(function (datapt) {\n        const name = (prefix + datapt.name).replace(/:$/, ''); //replace trailing delimiters\n        return $.extend(true, {}, datapt, { name: name });\n    });\n}\n\n/**\n * \n * @param {Function} callback \n * @param {string|string[]} prefixList\n * @returns {Function}\n */\nexport function withPrefix(callback, prefixList) {\n    const arr = [].concat(prefixList);\n\n    /**\n     * @param {Publishable[]} data\n     */\n    return function (data) {\n        arr.forEach(function (prefix) {\n            const mapped = mapWithPrefix(data, prefix);\n            callback(mapped);\n        });\n    };\n}\n\n/**\n * \n * @param {string[]} list \n * @param {string} prefix\n * @returns {string[]} Item with prefix removed\n */\nexport function unprefixTopics(list, prefix) {\n    if (!prefix) return list;\n    const unprefixed = list.map(function (item) {\n        return item.replace(prefix, '');\n    });\n    return unprefixed;\n}\n\n/**\n * \n * @param {Publishable[]} list \n * @param {string} prefix\n * @returns {Publishable[]} Item with prefix removed\n */\nexport function unprefix(list, prefix) {\n    if (!prefix) return list;\n    const unprefixed = list.map(function (item) {\n        if (item.name) {\n            return $.extend(true, {}, item, { name: item.name.replace(prefix, '') });\n        }\n        return item.replace(prefix, '');\n    });\n    return unprefixed;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-router/utils/index.js","/* eslint-disable complexity */\nfunction toImplicitType(data) {\n    const objRegex = /^(?:\\{.*\\})$/;\n    const arrRegex = /^(?:\\[.*])$/;\n\n    let converted = data;\n    if (typeof data === 'string') {\n        converted = data.trim();\n\n        if (converted === 'true') {\n            converted = true;\n        } else if (converted === 'false') {\n            converted = false;\n        } else if (converted === 'null') {\n            converted = null;\n        } else if (converted === 'undefined') {\n            converted = '';\n        } else if (converted.charAt(0) === '\\'' || converted.charAt(0) === '\"') {\n            converted = converted.substring(1, converted.length - 1);\n        } else if ($.isNumeric(converted)) {\n            converted = +converted;\n        } else if (arrRegex.test(converted)) {\n            const bracketReplaced = converted.replace(/[[\\]]/g, '');\n            if (!bracketReplaced) return [];\n            const parsed = bracketReplaced.split(/,(?![^[]*])/).map((val)=> {\n                return toImplicitType(val);\n            });\n            return parsed;\n        } else if (objRegex.test(converted)) {\n            try {\n                converted = JSON.parse(converted);\n            } catch (e) {\n                console.error('toImplicitType: couldn\\'t convert', converted);\n            }\n        }\n    }\n    return converted;\n}\n\nfunction splitUnescapedCommas(str) {\n    const regex = /(\\\\.|[^,])+/g;\n    let m;\n\n    const op = [];\n    while ((m = regex.exec(str)) !== null) { //eslint-disable-line\n        // This is necessary to avoid infinite loops with zero-width matches\n        if (m.index === regex.lastIndex) {\n            regex.lastIndex++;\n        }\n        m.forEach(function (match, groupIndex) {\n            if (groupIndex === 0) {\n                op.push(match.replace('\\\\', ''));\n            }\n        });\n    }\n    return op;\n}\n\nfunction splitNameArgs(value) {\n    value = value.trim();\n    const fnName = value.split('(')[0];\n    const params = value.substring(value.indexOf('(') + 1, value.indexOf(')'));\n    const args = splitUnescapedCommas(params).map((p)=> p.trim());\n    return { name: fnName, args: args };\n}\n\n/**\n * @param  {string} value\n * @returns {{ name: string, value: any}[]}       [description]\n */\nfunction toPublishableFormat(value) {\n    const OPERATIONS_SEPERATOR = '&&';\n    const split = (value || '').split(OPERATIONS_SEPERATOR);\n    const listOfOperations = split.map(function (value) {\n        if (value && value.indexOf('=') !== -1) {\n            const split = value.split('=');\n            return { name: split[0].trim(), value: split[1].trim() };\n        }\n        const parsed = splitNameArgs(value);\n        return { name: parsed.name, value: parsed.args };\n    });\n    return listOfOperations;\n}\n\nexport { toImplicitType, toPublishableFormat, splitNameArgs };\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/parse-utils.js","/**\n * \n * @param {Object} obj\n * @returns {Publishable[]}\n */\nexport function objectToPublishable(obj) {\n    var mapped = Object.keys(obj || {}).map(function (t) {\n        return { name: t, value: obj[t] };\n    });\n    return mapped;\n}\n\n/**\n * Converts arrays of the form [{ name: '', value: ''}] to {[name]: value}\n * @param {Publishable[]} arr\n * @param {Object} [mergeWith]\n * @returns {Object}\n */\nexport function publishableToObject(arr, mergeWith) {\n    var result = (arr || []).reduce(function (accum, topic) {\n        accum[topic.name] = topic.value;\n        return accum;\n    }, $.extend(true, {}, mergeWith));\n    return result;\n}\n\n/**\n * @typedef NormalizedParam\n * @property {Publishable[]} params\n * @property {Object} options\n */\n\n/**\n *\n * @param {string|Object|Array} topic \n * @param {*} publishValue \n * @param {Object} [options]\n * @returns {NormalizedParam}\n */\nexport function normalizeParamOptions(topic, publishValue, options) {\n    if (!topic) {\n        return { params: [], options: {} };\n    }\n    if ($.isPlainObject(topic)) {\n        return { params: objectToPublishable(topic), options: publishValue };\n    }\n    if (Array.isArray(topic)) {\n        return { params: topic, options: publishValue };\n    }\n    return { params: [{ name: topic, value: publishValue }], options: options };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-utils.js","import { groupByHandlers, groupSequentiallyByHandlers, normalizeSubscribeResponse } from './utils/handler-utils';\nimport { unprefix, unprefixTopics, mapWithPrefix, silencable, excludeReadOnly } from './utils';\nimport { makePromise } from 'utils/general';\nimport _ from 'lodash';\n\n\n/**\n * Handle subscriptions\n * @param  {Handler[]} handlers Array of the form [{ match: function (){}, }]\n * @param  {Array<string>} topics   Array of strings\n * @param  {SubscribeOptions} [options]\n * @returns {Promise<Publishable[]>} Returns populated topics if available\n */\nexport function notifySubscribeHandlers(handlers, topics, options) {\n    const grouped = groupByHandlers(topics, handlers);\n    const promises = [];\n    grouped.filter((handler)=> handler.subscribeHandler).forEach(function (handler) {\n        const mergedOptions = $.extend(true, {}, handler.options, options);\n        const unprefixed = unprefixTopics(handler.data, handler.matched);\n        const promise = makePromise(()=> {\n            const subsResponse = handler.subscribeHandler(unprefixed, mergedOptions, handler.matched);\n            return subsResponse;\n        }).then((topicsWithData)=> {\n            const normalized = normalizeSubscribeResponse(topicsWithData, unprefixed);\n            const prefixed = mapWithPrefix(normalized, handler.matched);\n            return prefixed;\n        });\n        promises.push(promise);\n    });\n    return $.when.apply(null, promises).then(function () {\n        const arr = [].concat.apply([], arguments);\n        return arr;\n    });\n}\n\n/**\n * \n * @param {Handler[]} handlers \n * @param {Array<string>} recentlyUnsubscribedTopics\n * @param {Array<string>} remainingTopics \n */\nexport function notifyUnsubscribeHandlers(handlers, recentlyUnsubscribedTopics, remainingTopics) {\n    handlers = handlers.map(function (h, index) {\n        h.unsubsKey = index;\n        return h;\n    });\n\n    const unsubsGrouped = groupByHandlers(recentlyUnsubscribedTopics, handlers);\n    const remainingGrouped = groupByHandlers(remainingTopics, handlers);\n\n    unsubsGrouped.filter((h)=> h.unsubscribeHandler).forEach(function (handler) {\n        const unprefixedUnsubs = unprefixTopics(handler.data, handler.matched);\n        const matchingRemainingHandler = _.find(remainingGrouped, function (remainingHandler) {\n            return remainingHandler.unsubsKey === handler.unsubsKey;\n        });\n        const matchingTopicsRemaining = matchingRemainingHandler ? matchingRemainingHandler.data : [];\n        const unprefixedRemaining = unprefixTopics(matchingTopicsRemaining || [], handler.matched);\n        handler.unsubscribeHandler(unprefixedUnsubs, unprefixedRemaining);\n    });\n}\n/**\n * \n * @param {Handler[]} handlers \n * @param {Publishable[]} publishData \n * @param {PublishOptions} [options]\n * @returns {Promise}\n */\nexport function passthroughPublishInterceptors(handlers, publishData, options) {\n    const grouped = groupSequentiallyByHandlers(publishData, handlers);\n    let $initialProm = $.Deferred().resolve([]).promise();\n    grouped.forEach(function (handler) {\n        $initialProm = $initialProm.then(function (dataSoFar) {\n            const mergedOptions = $.extend(true, {}, handler.options, options);\n            const unprefixed = unprefix(handler.data, handler.matched);\n\n            const publishableData = excludeReadOnly(unprefixed, mergedOptions.readOnly);\n            if (!publishableData.length) {\n                return dataSoFar;\n            }\n\n            const result = handler.publishHandler ? handler.publishHandler(publishableData, mergedOptions, handler.matched) : publishableData;\n            const publishProm = $.Deferred().resolve(result).promise();\n            return publishProm.then(function (published) {\n                return silencable(published, mergedOptions.silent);\n            }).then(function (published) {\n                let mapped = mapWithPrefix(published, handler.matched);\n                if (handler.isDefault && handler.matched) {\n                    mapped = mapped.concat(published);\n                }\n                return mapped;\n            }).then(function (mapped) {\n                return [].concat(dataSoFar, mapped);\n            });\n        });\n    });\n    return $initialProm;\n}\n\n/**\n * Router\n * @param  {Handler[]} handlers\n * @param {Object} [options]\n * @param {Function} [notifier]\n * @returns {Router}\n */\nexport default function router(handlers, options, notifier) {\n    let myHandlers = (handlers || []).map((Handler)=> {\n        let handler = Handler;\n        if (_.isFunction(Handler)) {\n            handler = new Handler(options, notifier);\n            $.extend(this, handler.expose);\n        }\n        if (typeof handler.match === 'string') {\n            const matchString = handler.match;\n            handler.name = matchString;\n            handler.match = (t)=> t === matchString ? '' : false;\n        }\n        return handler;\n    });\n\n    const expose = myHandlers.reduce((accum, h)=> {\n        $.extend(true, accum, h.expose);\n        return accum;\n    }, {});\n\n    return {\n        expose: expose,\n        match: (topic)=> {\n            return myHandlers.reduce((match, handler)=> {\n                const matched = handler.match(topic);\n                if (match === false && matched !== false) {\n                    return '';\n                }\n                return match;\n            }, false);\n        },\n\n        /**\n         * @param {Array<string>} topics\n         * @param {SubscribeOptions} [options]\n         * @returns {Promise<Publishable[]>} Returns populated topics if available\n         */\n        subscribeHandler: function (topics, options) {\n            return notifySubscribeHandlers(myHandlers, topics, options);\n        },\n        /**\n         * @param {Array<string>} recentlyUnsubscribedTopics\n         * @param {Array<string>} remainingTopics\n         * @returns {void}\n         */\n        unsubscribeHandler: function (recentlyUnsubscribedTopics, remainingTopics) {\n            return notifyUnsubscribeHandlers(myHandlers, recentlyUnsubscribedTopics, remainingTopics);\n        },\n\n        /**\n         * @param {Publishable[]} data\n         * @param {PublishOptions} [options]\n         * @returns {Promise}\n         */\n        publishHandler: function (data, options) {\n            return passthroughPublishInterceptors(myHandlers, data, options);\n        },\n\n        addRoute: function (handler) {\n            if (!handler || !handler.match) {\n                throw Error('Handler does not have a valid `match` property');\n            }\n            handler.id = _.uniqueId('routehandler-');\n            myHandlers.unshift(handler);\n            return handler.id;\n        },\n        removeRoute: function (routeid) {\n            myHandlers = myHandlers.filter((handler)=> {\n                return handler.id !== routeid;\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-router/index.js","const ROUTE_DELIMITER = ':';\n\n/**\n * \n * @param {string} prefix\n * @returns {matchFunction}\n */\nexport function matchPrefix(prefix) {\n    return function prefixMatcher(topic) {\n        const hasPrefix = topic.indexOf(prefix) === 0;\n        if (hasPrefix) return prefix;\n\n        const isOnlyPrefix = prefix.replace(/:/g, '') === topic;\n        if (isOnlyPrefix) return topic;\n\n        return false;\n    };\n}\n\n/**\n* \n* @param {string} prefix\n* @returns {matchFunction}\n*/\nexport function matchDefaultPrefix(prefix) {\n    return function defaultPrefixMatcher(topic, forcePrefix) {\n        const hasPrefix = topic.indexOf(prefix) === 0;\n        return (hasPrefix || forcePrefix) ? prefix : '';\n    };\n}\n\n/**\n * \n * @param {string} regex\n * @returns {matchFunction}\n */\nexport function matchRegex(regex) {\n    var toMatch = new RegExp('^' + regex + ROUTE_DELIMITER);\n    return function regexMatcher(topic) {\n        var match = topic.match(toMatch);\n        if (match && match.length) {\n            return match[0];\n        }\n        return false;\n    };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/route-matchers.js","import { uniqueId, random as _random } from 'lodash';\n\nexport { makePromise, promisify } from './promise-utils';\nexport { default as debounceAndMerge } from './debounce-and-merge';\n\nexport function random(prefix, min, max) {\n    if (!min) {\n        min = parseInt(uniqueId(), 10);\n    }\n    if (!max) {\n        max = 100000; //eslint-disable-line no-magic-numbers\n    }\n    var rnd = _random(min, max, false) + '';\n    if (prefix) {\n        rnd = prefix + rnd;\n    }\n    return rnd;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/general/index.js","import MetaRouteHandler from './run-meta-route-handler';\nimport VariablesRouteHandler from './run-variables-route-handler';\nimport OperationsRouteHandler from './run-operations-route-handler';\n\nimport router from 'channels/channel-router';\nimport { withPrefix, silencable } from 'channels/channel-router/utils';\nimport { matchPrefix, matchDefaultPrefix } from 'channels/route-handlers/route-matchers';\n\nimport _ from 'lodash';\nimport { objectToPublishable } from 'channels/channel-utils';\n\nexport const VARIABLES_PREFIX = 'variables:';\nexport const META_PREFIX = 'meta:';\nexport const OPERATIONS_PREFIX = 'operations:';\n\n/**\n * \n * @param {Publishable[]} result \n * @param {string[]} ignoreOperations \n * @returns {boolean}\n */\nexport function _shouldFetch(result, ignoreOperations) {\n    const filtered = (result || []).filter((r)=> {\n        const name = r.name || '';\n        const isIgnored = (ignoreOperations || []).indexOf(name.replace(OPERATIONS_PREFIX, '')) !== -1;\n        const isVariable = name.indexOf(VARIABLES_PREFIX) === 0;\n        const isOperation = name.indexOf(OPERATIONS_PREFIX) === 0;\n\n        return isVariable || (isOperation && !isIgnored);\n    });\n    return filtered.length > 0;\n}\n\nconst RunService = F.service.Run;\nexport default function GenericRunRouteHandler(config, notifier) {\n    const defaults = {\n        serviceOptions: {},\n        channelOptions: {\n            variables: {\n                autoFetch: true,\n                debounce: 200,\n                silent: false,\n                readOnly: false,\n            },\n            operations: {\n                readOnly: false,\n                silent: false,\n            },\n            meta: {\n                silent: false,\n                autoFetch: true,\n                readOnly: ['id', 'created', 'account', 'project', 'model', 'lastModified']\n            },\n        }\n    };\n    const opts = $.extend(true, {}, defaults, config);\n\n    const serviceOptions = _.result(opts, 'serviceOptions');\n\n    let $initialProm = null;\n    if (serviceOptions instanceof RunService) {\n        $initialProm = $.Deferred().resolve(serviceOptions).promise();\n    } else if (serviceOptions.then) {\n        $initialProm = serviceOptions;\n    } else {\n        const rs = new RunService(serviceOptions);\n        $initialProm = $.Deferred().resolve(rs).promise();\n    }\n\n    const operationNotifier = withPrefix(notifier, OPERATIONS_PREFIX);\n    const variableNotifier = withPrefix(notifier, [VARIABLES_PREFIX, '']);\n\n    const metaHandler = new MetaRouteHandler($initialProm, withPrefix(notifier, META_PREFIX));\n    const operationsHandler = new OperationsRouteHandler($initialProm, operationNotifier);\n    const variablesHandler = new VariablesRouteHandler($initialProm, variableNotifier);\n\n    let subscribed = false;\n    const channelOptions = opts.channelOptions;\n    $initialProm.then((rs)=> {\n        if (rs.channel && !subscribed) {\n            subscribed = true;\n            const { TOPICS } = rs.channel;\n            const subscribeOpts = { includeMine: false };\n            //TODO: Provide subscription fn to individual channels and let them handle it?\n            rs.channel.subscribe(TOPICS.RUN_VARIABLES, (data, meta)=> {\n                const publishable = objectToPublishable(data);\n                const excludingSilenced = silencable(publishable, channelOptions.variables.silent);\n                if (!excludingSilenced.length) {\n                    return;\n                }\n                variablesHandler.notify(excludingSilenced, meta);\n                variablesHandler.fetch();//Variables channel #notify also does a fetch, but this is not supposed to know about that. Debouncing will take care of duplicate fetches anyway.\n            }, this, subscribeOpts);\n            rs.channel.subscribe(TOPICS.RUN_OPERATIONS, (data, meta)=> {\n                const publishable = [{ name: data.name, value: data.result }];\n                const excludingSilenced = silencable(publishable, channelOptions.operations.silent);\n                if (!excludingSilenced.length) {\n                    return;\n                }\n                operationsHandler.notify(excludingSilenced, meta);\n                variablesHandler.fetch();\n            }, this, subscribeOpts);\n            rs.channel.subscribe(TOPICS.CONSENSUS_UPDATE, (consensus, meta)=> {\n                if (consensus.closed) {\n                    variablesHandler.fetch(); \n                    // I should also do operationsHandler.notify but I don't know what to notify them about\n                    //Just remove the 'include Mine' check for operations? That's just cached anyway\n                }\n            }, this, { includeMine: true });\n            rs.channel.subscribe(TOPICS.RUN_RESET, (data, meta)=> {\n                const publishable = [{ name: 'reset', value: data }];\n                const excludingSilenced = silencable(publishable, channelOptions.operations.silent);\n                if (!excludingSilenced.length) {\n                    return;\n                }\n                operationsHandler.notify(excludingSilenced, meta);\n            }, this, subscribeOpts);\n\n            // rs.channel.subscribe('', (data, meta)=> {\n            //     console.log('everything', data, meta);\n            // });\n        }\n    });\n\n    const handlers = [\n        $.extend({}, metaHandler, { \n            name: 'meta',\n            match: matchPrefix(META_PREFIX),\n            options: opts.channelOptions.meta,\n        }),\n        $.extend({}, operationsHandler, { \n            name: 'operations',\n            match: matchPrefix(OPERATIONS_PREFIX),\n            options: opts.channelOptions.operations,\n        }),\n        $.extend({}, variablesHandler, { \n            isDefault: true,\n            name: 'variables',\n            match: matchDefaultPrefix(VARIABLES_PREFIX),\n            options: opts.channelOptions.variables,\n        }),\n    ];\n\n    // router.addRoute(prefix('meta:'), metaChannel, opts.channelOptions.meta);\n\n    const runRouter = router(handlers);\n    const oldhandler = runRouter.publishHandler;\n    runRouter.publishHandler = function (publishable) {\n        const prom = oldhandler.apply(router, arguments);\n        return prom.then(function (result) { //all the silencing will be taken care of by the router\n            const shouldFetch = _shouldFetch(result, ['reset']);\n            if (shouldFetch) {\n                const excludeFromFetch = result.map((r)=> r.name); //This was just published, no need to get the value again\n                variablesHandler.fetch({ exclude: excludeFromFetch });\n            }\n            return result;\n        });\n    };\n    return runRouter;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/index.js","export function _findMostConsequtive(arr, match) {\n    const reduced = arr.reduce((accum, val)=> {\n        if (val === match) {\n            if (accum.prev === match) {\n                accum.count = accum.count + 1;\n            } else {\n                accum.count = 1;\n            }\n        }\n        accum.maxCount = Math.max(accum.maxCount, accum.count);\n        accum.prev = val;\n        return accum;\n    }, { prev: null, count: 0, maxCount: 0 });\n    return reduced.maxCount;\n}\n\nfunction buildDiffArray(currentcontents, newContents) {\n    return newContents.map((contents, index)=> {\n        const isSame = contents === currentcontents[index]; \n        return isSame;\n    });\n}\n\nfunction fill(count, val) {\n    const a = [];\n    for (let i = 0; i < count; i++) {\n        a.push(val);\n    }\n    return a;\n}\n\nfunction elToContents(el) {\n    //ignore data attributes for comparison\n    return el.outerHTML\n        .replace(/\\s?data-[a-zA-Z]*=['\"][a-zA-Z0-9]*['\"]/g, '')\n        .replace(/\\s\\s/g, ' ').trim();\n}\n\nfunction elementsToContents($els) {\n    return $els.map((index, child)=> {\n        return elToContents(child);\n    }).get();\n}\n\nconst defaults = {\n    addAttr: 'data-add',\n    changeAttr: 'data-update',\n    initialAttr: 'data-initial',\n};\n\n/**\n * Compares 2 lists and Adds add or update classes\n * @param {JQuery<HTMLElement>} $currentEls existing elements\n * @param {JQuery<HTMLElement>} $newEls   new elements\n * @param {boolean} isInitial check if this is initial data or it's updating\n * @param {{ addAttr: string, changeAttr: string}} [options]\n * @returns {JQuery<HTMLElement>} elements with updated attributes\n */\nexport function addChangeClassesToList($currentEls, $newEls, isInitial, options) {\n    const opts = $.extend({}, defaults, options);\n\n    let currentcontents = elementsToContents($currentEls);\n    const newContents = elementsToContents($newEls);\n    const reversedContents = currentcontents;\n\n    //Guess if data was added to end or beginning of array\n    const diffFromEnd = buildDiffArray(currentcontents, newContents);\n    const diffFromBeginning = buildDiffArray(reversedContents.slice().reverse(), newContents.slice().reverse());\n\n    const endMatches = _findMostConsequtive(diffFromEnd, true);\n    const beginningMatches = _findMostConsequtive(diffFromBeginning, true);\n\n    const placeHoldersCount = newContents.length - currentcontents.length;\n    const placeHolders = fill(placeHoldersCount, undefined);\n\n    if (beginningMatches <= endMatches) {\n        currentcontents = currentcontents.concat(placeHolders);\n    } else {\n        currentcontents = placeHolders.concat(currentcontents);\n    }\n\n    for (let i = 0; i < newContents.length; i++) {\n        const $el = $newEls.eq(i);\n        const curr = currentcontents[i];\n        $el.removeAttr(opts.initialAttr);\n\n        const contents = elToContents($el.get(0));\n        if (curr === undefined) {\n            $el.attr({\n                [opts.addAttr]: true,\n                [opts.initialAttr]: isInitial || null\n            });\n            $el.removeAttr(opts.changeAttr);\n        } else if (curr !== contents) {\n            $el.attr({\n                [opts.changeAttr]: true,\n                [opts.initialAttr]: isInitial || null\n            });\n            $el.removeAttr(opts.addAttr);\n        } else {\n            $el.removeAttr(`${opts.addAttr} ${opts.changeAttr}`);\n        }\n    }\n\n    return $newEls;\n}\n\nexport function addContentAndAnimate($el, newValue, isInitial, options) {\n    const opts = $.extend({}, defaults, options);\n    const current = $el.html().trim();\n\n    $el.removeAttr(`${opts.changeAttr} ${opts.initialAttr}`);\n    if (current === `${newValue}`.trim()) {\n        return $el;\n    }\n\n    $el.html(newValue);\n    setTimeout(function () {\n        $el.attr({\n            [opts.changeAttr]: true,\n            [opts.initialAttr]: isInitial || null //jquery removes if set to null\n        });\n    }, 0); //need this to trigger animation\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/animation.js","import { uniqueId } from 'lodash';\n\nconst CURRENT_INDEX_KEY = 'current-index';\nconst CURRENT_INDEX_ATTR = `data-${CURRENT_INDEX_KEY}`;\n\nexport function getKnownDataForEl($el) {\n    const closestKnownDataEl = $el.closest(`[${CURRENT_INDEX_ATTR}]`);\n    let knownData = {};\n    if (closestKnownDataEl.length) {\n        knownData = closestKnownDataEl.data(CURRENT_INDEX_KEY);\n    }\n    return knownData;\n}\nexport function updateKnownDataForEl($el, data) {\n    $el.attr(CURRENT_INDEX_ATTR, JSON.stringify(data));\n}\nexport function removeKnownData($el) {\n    $el.removeAttr(CURRENT_INDEX_ATTR);\n}\n\nexport function getTemplateTags(template) {\n    template = template.replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n    const templateTagsUsed = template.match(/<%[=-]?([\\s\\S]+?)%>/g);\n    return templateTagsUsed || [];\n}\nexport function isTemplated(template) {\n    return getTemplateTags(template).length > 0;\n}\n\n\nexport function findMissingReferences(template, knownDataKeys) {\n    function isKnownTag(tag, knownTags) {\n        const match = knownDataKeys.find((key)=> {\n            const regex = new RegExp('\\\\b' + key + '\\\\b');\n            return regex.test(tag);\n        });\n        return match;\n    }\n\n    template = template.replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n    const missingReferences = {};\n    const templateTagsUsed = getTemplateTags(template);\n    if (templateTagsUsed) {\n        templateTagsUsed.forEach(function (tag) {\n            if (tag.match(/\\w+/) && !isKnownTag(tag, knownDataKeys)) {\n                let refKey = missingReferences[tag];\n                if (!refKey) {\n                    refKey = uniqueId('no-ref');\n                    missingReferences[tag] = refKey;\n                }\n            }\n        });\n    }\n    return missingReferences;\n}\n\nfunction refToMarkup(refKey) {\n    return '<!--' + refKey + '-->';\n}\n\nexport function stubMissingReferences(template, missingReferences) {\n    template = template.replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n\n    Object.keys(missingReferences).forEach((tag)=> {\n        const refId = missingReferences[tag];\n        const r = new RegExp(tag, 'g');\n        template = template.replace(r, refToMarkup(refId));\n    });\n    return template;\n}\n\nexport function addBackMissingReferences(template, missingReferences) {\n    Object.keys(missingReferences).forEach((originalTemplateVal)=> {\n        const commentRef = missingReferences[originalTemplateVal];\n        const r = new RegExp(refToMarkup(commentRef), 'g');\n        template = template.replace(r, originalTemplateVal);\n    });\n\n    return template;\n}\n\n\nconst elTemplateMap = new WeakMap();\nexport function getOriginalContents($el, resolver) {\n    const el = $el.get(0);\n    let originalHTML = elTemplateMap.get(el);\n    if (!originalHTML && resolver) {\n        originalHTML = resolver($el).replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n        elTemplateMap.set(el, originalHTML);\n    }\n    return originalHTML;\n}\nexport function clearOriginalContents($el) {\n    const el = $el.get(0);\n    elTemplateMap.delete(el);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attr-template-utils.js","/*eslint no-undef: 0*/\nimport { binderAttr, events } from '../../config';\nimport BaseView from './default-node';\n\nexport default BaseView.extend({\n    propertyHandlers: [],\n\n    uiChangeEvent: 'change.f-node-event',\n    getUIValue: function () {\n        return this.$el.val();\n    },\n\n    removeEvents: function () {\n        this.$el.off(this.uiChangeEvent);\n    },\n\n    initialize: function (options) {\n        const propName = this.$el.data(binderAttr);\n        if (options && options.triggerChangeOn) {\n            this.uiChangeEvent = options.triggerChangeOn;\n        }\n        if (propName) {\n            const changeHandler = function () {\n                const val = this.getUIValue();\n                const payload = [{ name: propName, value: val }];\n                \n                this.$el.trigger(events.trigger, { data: payload, source: 'bind', restoreOriginal: val.length === 0 });\n            }.bind(this);\n\n            const handlerDebounceTime = 200;\n            const debouncedHandler = _.debounce(changeHandler, handlerDebounceTime);\n            const handler = this.uiChangeEvent.indexOf('key') !== -1 ? debouncedHandler : changeHandler;\n            this.$el.off(this.uiChangeEvent).on(this.uiChangeEvent, handler);\n        }\n        BaseView.prototype.initialize.apply(this, arguments);\n    }\n}, { selector: 'input, select, textarea' });\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/node-manager/default-input-node.js","'use strict';\n\nvar BaseView = require('../../utils/base-view');\n\nmodule.exports = BaseView.extend({\n    propertyHandlers: [\n\n    ],\n\n    initialize: function () {\n    }\n}, { selector: '*' });\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/node-manager/default-node.js","const IN_OF_REGEX = /\\((.*)\\) (?:in|of)\\s+(.*)/;\nconst KEY_VALUE_REGEX = /(.*),(.*)/;\n\n/**\n * @param {string} attrVal \n * @returns {string}\n */\nexport function extractVariableName(attrVal) {\n    const inMatch = attrVal.trim().match(IN_OF_REGEX);\n    const varName = inMatch ? inMatch[2] : attrVal;\n    return varName.trim();\n}\n\n/**\n * @param {string} attrVal \n * @returns {string}\n */\nexport function parseKeyAlias(attrVal) {\n    const inMatch = attrVal.match(IN_OF_REGEX);\n    if (!inMatch) {\n        return undefined;\n    }\n    const itMatch = inMatch[1].match(KEY_VALUE_REGEX);\n    const alias = itMatch ? itMatch[1].trim() : undefined;\n    return alias;\n}\n\n/**\n * @param {string} attrVal \n * @returns {string}\n */\nexport function parseValueAlias(attrVal) {\n    const inMatch = attrVal.match(IN_OF_REGEX);\n    if (!inMatch) {\n        return undefined;\n    }\n    const itMatch = inMatch[1].match(KEY_VALUE_REGEX);\n    const alias = itMatch ? itMatch[2] : inMatch[1];\n    return alias.trim();\n}\n\n\n//Public exports\n\nexport function aliasesFromTopics(topics, value) {\n    const relevantTopic = topics[0]; //doesn't support multiple topics\n\n    const defaultKey = $.isPlainObject(value) ? 'key' : 'index';\n    const keyAlias = relevantTopic.keyAlias || defaultKey;\n    const valueAlias = relevantTopic.valueAlias || 'value';\n\n    return { keyAlias: keyAlias, valueAlias: valueAlias };\n}\nexport function parseTopics(topics) {\n    const attrVal = topics[0].name; //doesn't support multiple topics\n    return [{\n        name: extractVariableName(attrVal),\n        keyAlias: parseKeyAlias(attrVal),\n        valueAlias: parseValueAlias(attrVal),\n    }];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/loop-attrs/loop-attr-utils.js","import { isFunction } from 'lodash';\n\n/**\n * @param {any} val \n * @returns {Promise}\n */\nexport function makePromise(val) {\n    //Can be replaced with Promise.resolve when we drop IE11;\n    // if (isFunction(val)) {\n    //     return Promise.resolve(val());\n    // }\n    // return Promise.resolve(val);\n    if (val && val.then) {\n        return val;\n    }\n    const $def = $.Deferred();\n    if (isFunction(val)) {\n        try {\n            const toReturn = val();\n            if (toReturn && toReturn.then) {\n                return toReturn.then((r)=> $def.resolve(r), ((e)=> $def.reject(e)));\n            }\n            $def.resolve(toReturn);\n        } catch (e) {\n            $def.reject(e);\n        }\n    } else {\n        $def.resolve(val);\n    }\n    return $def.promise();\n}\n\n/**\n * \n * @param {function(*)} fn \n * @returns {function(...any): Promise}\n */\nexport function promisify(fn) {\n    if (!isFunction(fn)) {\n        throw new Error(`Promisify requires a function, received ${typeof fn}`);\n    }\n    /**\n     * @param {...*} args \n     * @returns {Promise}\n     */\n    return function promisifiedFunction(args) {\n        const $def = $.Deferred();\n        try {\n            const toReturn = fn.apply(fn, arguments);\n            if (toReturn && toReturn.then) {\n                return toReturn.then((r)=> {\n                    return $def.resolve(r);\n                }, (e)=> {\n                    return $def.reject(e);\n                });\n            } else {\n                $def.resolve(toReturn);\n            }\n        } catch (e) {\n            $def.reject(e);\n        }\n        return $def.promise();\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/general/promise-utils.js","export function makeConsensusService(consensisAPIResponse) {\n    return new window.F.service.Consensus({\n        name: consensisAPIResponse.stage,\n        consensusGroup: consensisAPIResponse.name,\n        worldId: consensisAPIResponse.worldId,\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-utils.js","var interpolationRegex = /<(.*?)>/g;\n/**\n *  \n * @param {string} topic topic to extract dependencies from\n * @returns {string[]} dependencies\n */\nexport function extractDependencies(topic) {\n    var deps = (topic.match(interpolationRegex) || []).map((val)=> {\n        return val.substring(1, val.length - 1); \n    });\n    return deps;\n}\n\n/**\n * @param {string} topic topic with dependencies\n * @param {{string: any}} data object with values of dependencies\n * @returns {string} interpolated string\n */\nexport function interpolateWithValues(topic, data) {\n    var interpolatedTopic = topic.replace(interpolationRegex, (match, dependency)=> {\n        var val = data[dependency];\n        var toReplace = Array.isArray(val) ? val[val.length - 1] : val;\n        return toReplace;\n    });\n    return interpolatedTopic;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/interpolatable/interpolatable-utils.js","import domManager from './dom/dom-manager';\n\nimport ChannelManager from 'channels/configured-channel-manager';\nimport config from 'config';\n\nimport * as utils from './utils';\n\nconst Flow = {\n    dom: domManager,\n    utils: utils,\n    initialize: function (config) {\n        const model = $('body').data('f-model');\n        const defaults = {\n            channel: {\n                //FIXME: Defaults can't be here..\n                defaults: {\n                    run: {\n                        model: model,\n                    }\n                },\n            },\n            dom: {\n                root: 'body',\n                autoBind: true\n            }\n        };\n\n        const options = $.extend(true, {}, defaults, config);\n   \n        if (config && config.channel && (config.channel instanceof ChannelManager)) {\n            this.channel = config.channel;\n        } else {\n            this.channel = new ChannelManager(options.channel);\n        }\n\n        const prom = domManager.initialize($.extend(true, {\n            channel: this.channel\n        }, options.dom));\n        \n        this.channel.subscribe('operations:reset', function () {\n            domManager.unbindAll();\n            domManager.bindAll();\n        });\n\n        return prom;\n    }\n};\nFlow.ChannelManager = ChannelManager;\nFlow.constants = config;\n//set by grunt\nif (RELEASE_VERSION) Flow.version = RELEASE_VERSION; //eslint-disable-line no-undef\nexport default Flow;\n\n\n\n// WEBPACK FOOTER //\n// ./src/flow.js","import { getConvertersForEl, getChannelForAttribute, getChannelConfigForElement, parseTopicsFromAttributeValue } from './dom-manager-utils/dom-parse-helpers';\n\nimport { addPrefixToTopics, addDefaultPrefix } from './dom-manager-utils/dom-channel-prefix-helpers';\nimport { toImplicitType } from 'utils/parse-utils';\n\nimport { pick, isEqual } from 'lodash';\n\nimport { prefix, errorAttr, events, animation } from '../config';\n\nimport converterManager from './converter-manager';\nimport nodeManager from './node-manager';\nimport attrManager from './attribute-manager';\nimport autoUpdatePlugin from './plugins/auto-update-bindings';\n\nexport default (function () {\n    //Jquery selector to return everything which has a f- property set\n    $.expr.pseudos[prefix] = function (el) {\n        if (!el || !el.attributes) {\n            return false;\n        }\n        for (let i = 0; i < el.attributes.length; i++) {\n            const attr = el.attributes[i].nodeName;\n            if (attr.indexOf('data-' + prefix) === 0) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * @param {JQuery<HTMLElement>} root\n     * @returns {JQuery<HTMLElement>}\n     */\n    function getMatchingElements(root) {\n        const $root = $(root);\n        let matchedElements = $root.find(':' + prefix);\n        if ($root.is(':' + prefix)) {\n            matchedElements = matchedElements.add($root);\n        }\n        return matchedElements;\n    }\n\n    /**\n     * @param {JQuery<HTMLElement> | HTMLElement} element\n     * @param {*} [context]\n     * @returns {HTMLElement}\n     */\n    function getElementOrError(element, context) {\n        const el = (element instanceof $) ? element.get(0) : element;\n        if (!el || !el.nodeName) {\n            console.error(context, 'Expected to get DOM Element, got ', element);\n            throw new Error(context + ': Expected to get DOM Element, got' + (typeof element));\n        }\n        return el;\n    }\n\n    //Unbind utils\n    function triggerError($el, e) {\n        let msg = e.message || e;\n        if ($.isPlainObject(msg)) {\n            msg = JSON.stringify(msg);\n        }\n        $el.attr(errorAttr, msg).trigger(events.error, e);\n    }\n    function unbindAllAttributes(domEl) {\n        const $el = $(domEl);\n        $(domEl.attributes).each(function (index, nodeMap) {\n            let attr = nodeMap.nodeName;\n            const wantedPrefix = 'data-f-';\n            if (attr.indexOf(wantedPrefix) === 0) {\n                attr = attr.replace(wantedPrefix, '');\n                const handler = attrManager.getHandler(attr, $el);\n                if (handler.unbind) {\n                    handler.unbind(attr, $el);\n                }\n            }\n        });\n    }\n    function unbindAllNodeHandlers(domEl) {\n        const $el = $(domEl);\n        //FIXME: have to readd events to be able to remove them. Ugly\n        const Handler = nodeManager.getHandler($el);\n        const h = new Handler.handle({\n            el: domEl\n        });\n        if (h.removeEvents) {\n            h.removeEvents();\n        }\n    }\n    function removeAllSubscriptions(subscriptions, channel, el) {\n        [].concat(subscriptions).forEach(function (subs) {\n            try {\n                channel.unsubscribe(subs);\n            } catch (e) {\n                triggerError(el, e);\n            }\n        });\n    }\n\n\n    const publicAPI = {\n\n        nodes: nodeManager,\n        attributes: attrManager,\n        converters: converterManager,\n\n        matchedElements: new Map(),\n\n        /**\n         * Unbind the element; unsubscribe from all updates on the relevant channels.\n         *\n         * @param {JQuery<HTMLElement> | HTMLElement} element The element to remove from the data binding.\n         * @param {Channel} channel (Optional) The channel from which to unsubscribe. Defaults to the [variables channel](../channels/variables-channel/).\n         * @returns {void}\n         */\n        unbindElement: function (element, channel) {\n            if (!channel) {\n                channel = this.options.channel;\n            }\n            const domEl = getElementOrError(element);\n            const $el = $(element);\n            const existingData = this.matchedElements.get(domEl);\n            if (!$el.is(':' + prefix) || !existingData) {\n                return;\n            }\n            this.matchedElements.delete(element);\n            const subscriptions = Object.keys(existingData).reduce((accum, a)=> {\n                const subsid = existingData[a].subscriptionId;\n                if (subsid) accum.push(subsid);\n                return accum;\n            }, []);\n\n            unbindAllNodeHandlers(domEl);\n            unbindAllAttributes(domEl);\n            removeAllSubscriptions(subscriptions, channel, $el);\n\n            const animAttrs = Object.keys(animation).join(' ');\n            $el.removeAttr(animAttrs);\n\n            Object.keys($el.data()).forEach(function (key) {\n                if (key.indexOf('f-') === 0 || key.match(/^f[A-Z]/)) {\n                    $el.removeData(key);\n                }\n            });\n        },\n\n        /**\n         * Bind the element: subscribe from updates on the relevant channels.\n         *\n         * @param {HTMLElement | JQuery<HTMLElement>} element The element to add to the data binding.\n         * @param {Channel} channel (Optional) The channel to subscribe to. Defaults to the [run channel](../channels/run-channel/).\n         * @returns {void}\n         */\n        bindElement: function (element, channel) {\n            const opts = this.options || {};\n            if (!channel) {\n                channel = opts.channel;\n            }\n            // this.unbindElement(element); //unbind actually removes the data,and jquery doesn't refetch when .data() is called..\n            const domEl = getElementOrError(element);\n            const $el = $(domEl);\n            const isExcluded = opts.exclude && $el.is(opts.exclude);\n            if (!$el.is(`:${prefix}`) || isExcluded) {\n                return;\n            }\n\n            //Send to node manager to handle ui changes\n            const changeEventOverrides = opts.uiChangeEvents || {};\n            const triggerSelector = Object.keys(changeEventOverrides).find((selector)=> {\n                return $el.is(selector);\n            });\n            const matchingEvent = triggerSelector && changeEventOverrides[triggerSelector];\n            const Handler = nodeManager.getHandler($el);\n            new Handler.handle({\n                el: domEl,\n                triggerChangeOn: matchingEvent\n            });\n\n            const filterPrefix = `data-${prefix}-`;\n            const attrList = {};\n            $(domEl.attributes).each(function (index, nodeMap) {\n                let attr = nodeMap.nodeName;\n                if (attr.indexOf(filterPrefix) !== 0) {\n                    return;\n                }\n                attr = attr.replace(filterPrefix, '');\n\n                const attrVal = nodeMap.value;\n                let topics = parseTopicsFromAttributeValue(attrVal);\n\n                const handler = attrManager.getHandler(attr, $el);\n                if (handler && handler.init) {\n                    handler.init(attr, topics, $el);\n                }\n                if (topics.length && handler && handler.parse) {\n                    topics = [].concat(handler.parse(topics));\n                }\n\n                const channelPrefix = getChannelForAttribute($el, attr);\n                topics = addPrefixToTopics(topics, channelPrefix);\n\n                const converters = getConvertersForEl($el, attr);\n                attrList[attr] = {\n                    channelPrefix: channelPrefix,\n                    topics: topics,\n                    converters: converters, //Store once instead of calculating on demand. Avoids having to parse through dom every time\n                };\n            });\n            //Need this to be set before subscribing or callback maybe called before it's set\n            this.matchedElements.set(domEl, attrList);\n\n            const channelConfig = getChannelConfigForElement(domEl);\n            const attrsWithSubscriptions = Object.keys(attrList).reduce((accum, name)=> {\n                const attr = attrList[name];\n                const { topics, channelPrefix } = attr;\n                if (!topics.length) {\n                    accum[name] = attr;\n                    return accum;\n                }\n\n                const subsOptions = $.extend({\n                    batch: true,\n                    onError: (e)=> {\n                        console.error('DomManager: Subscription error', domEl, e);\n                        triggerError($el, e);\n                    }\n                }, channelConfig);\n                const subscribableTopics = topics.map((t)=> t.name);\n                const subsid = channel.subscribe(subscribableTopics, (data, meta)=> {\n                    if (meta && isEqual(data, meta.previousData)) {\n                        return;\n                    }\n                    const toConvert = {};\n                    if (subscribableTopics.length === 1) { //If I'm only interested in 1 thing pass in value directly, else make a map;\n                        toConvert[name] = data[subscribableTopics[0]];\n                    } else {\n                        const dataForAttr = pick(data, subscribableTopics) || {};\n                        toConvert[name] = Object.keys(dataForAttr).reduce((accum, key)=> {\n                            //If this was through a auto-prefixed channel attr return what was bound\n                            const toReplace = new RegExp(`^${channelPrefix}:`);\n                            const k = channelPrefix ? key.replace(toReplace, '') : key;\n                            accum[k] = dataForAttr[key];\n                            return accum;\n                        }, {});\n                    }\n                    $el.removeAttr(errorAttr).trigger(events.convert, toConvert);\n                }, subsOptions);\n\n                accum[name] = Object.assign({}, attr, { subscriptionId: subsid });\n                return accum;\n            }, {});\n\n            this.matchedElements.set(domEl, attrsWithSubscriptions);\n        },\n\n        /**\n         * Bind all provided elements.\n         *\n         * @param  {JQuery<HTMLElement> | HTMLElement[]} [elementsToBind] (Optional) If not provided, binds all matching elements within default root provided at initialization.\n         * @returns {void}\n         */\n        bindAll: function (elementsToBind) {\n            if (!elementsToBind) {\n                elementsToBind = getMatchingElements(this.options.root);\n            } else if (!Array.isArray(elementsToBind)) {\n                elementsToBind = getMatchingElements(elementsToBind);\n            }\n\n            //parse through dom and find everything with matching attributes\n            $.each(elementsToBind, (index, element)=> {\n                this.bindElement(element, this.options.channel);\n            });\n        },\n        /**\n         * Unbind provided elements.\n         *\n         * @param  {JQuery<HTMLElement> | HTMLElement[]} [elementsToUnbind] (Optional) If not provided, unbinds everything.\n         * @returns {void}\n         */\n        unbindAll: function (elementsToUnbind) {\n            const me = this;\n            if (!elementsToUnbind) {\n                elementsToUnbind = [];\n                this.matchedElements.forEach((val, key)=> {\n                    elementsToUnbind.push(key);\n                });\n            } else if (!Array.isArray(elementsToUnbind)) {\n                elementsToUnbind = getMatchingElements(elementsToUnbind);\n            }\n            $.each(elementsToUnbind, function (index, element) {\n                me.unbindElement(element, me.options.channel);\n            });\n        },\n\n        plugins: {},\n\n        /**\n         * Initialize the DOM Manager to work with a particular HTML element and all elements within that root. Data bindings between individual HTML elements and the model variables specified in the attributes will happen via the channel.\n         *\n         * @param {Object} options (Optional) Overrides for the default options.\n         * @param {string} options.root The root HTML element being managed by this instance of the DOM Manager. Defaults to `body`.\n         * @param {Object} options.channel The channel to communicate with. Defaults to the Channel Manager from [Epicenter.js](../../../api_adapters/).\n         * @param {boolean} options.autoBind If `true` (default), any variables added to the DOM after `Flow.initialize()` has been called will be automatically parsed, and subscriptions added to channels. Note, this does not work in IE versions < 11.\n         * @returns {Promise}\n         */\n        initialize: function (options) {\n            const defaults = {\n                /**\n                 * Root of the element for flow.js to manage from.\n                 * @type {string} jQuery selector\n                 */\n                root: 'body',\n                channel: null,\n\n                /**\n                 * Exclude elements matching these selectors from being bound\n                 */\n                exclude: 'pre *',\n\n                /**\n                 * Any elements added to the DOM after `Flow.initialize()` has been called will be automatically bound, and subscriptions added to channels.\n                 * @type {boolean}\n                 */\n                autoBind: true,\n\n                /**\n                 * By default Flow triggers events on 'change', but you may want to trigger on, say, 'keypress' for specific inputs. Set { uiChangeEvents: { [selector]: 'keypress' } } for such cases\n                 */\n                uiChangeEvents: {\n\n                }\n            };\n            $.extend(defaults, options);\n\n            const channel = defaults.channel;\n\n            this.options = defaults;\n\n            const me = this;\n            const $root = $(defaults.root);\n\n            function attachUIListeners($root) {\n                function parseValue(value, converters) {\n                    if (Array.isArray(value)) {\n                        const parsed = value.map(function (val) {\n                            return toImplicitType(val);\n                        });\n                        return converterManager.parse(parsed, converters);\n                    }\n                    return converterManager.parse(toImplicitType(value), converters);\n                }\n\n                $root.off(events.trigger).on(events.trigger, function (evt, params) {\n                    const elMeta = me.matchedElements.get(evt.target);\n                    const { data, source, options, restoreOriginal } = params;\n\n                    if (!elMeta || !data) {\n                        return;\n                    }\n                    const sourceMeta = elMeta[source] || {};\n                    const { channelPrefix, converters } = sourceMeta;\n                    const $el = $(evt.target);\n\n                    const parsed = ([].concat(data)).map(function (action) {\n                        const { name, value } = action;\n                        const parsedValue = parseValue(value, converters);\n                        const actualName = name.split('|')[0].trim(); //FIXME: this shouldn't know about the pipe syntax\n                        const prefixedName = addDefaultPrefix(actualName, source, channelPrefix);\n                        return { name: prefixedName, value: parsedValue };\n                    }, []);\n\n                    if (restoreOriginal) {\n                        //Ideally this should simply be a fetch to the previous version of the variable to use that.\n                        me.unbindElement($el, channel);\n                        me.bindElement($el, channel);\n                        return;\n                    }\n\n                    channel.publish(parsed, options).then((result)=> {\n                        if (!result || !result.length) {\n                            return;\n                        }\n                        const last = result[result.length - 1];\n                        $el.trigger(events.convert, { [source]: last.value });\n                    }, (e)=> {\n                        triggerError($el, e);\n                    });\n                });\n            }\n\n            function attachConversionListner($root) {\n                // data = {proptoupdate: value}\n                $root.off(events.convert).on(events.convert, function (evt, data) {\n                    const $el = $(evt.target);\n\n                    const elMeta = me.matchedElements.get(evt.target);\n                    if (!elMeta) {\n                        return;\n                    }\n\n                    Object.keys(data).forEach((prop)=> {\n                        const val = data[prop];\n                        const { converters, topics } = elMeta[prop];\n                        const convertedValue = converterManager.convert(val, converters);\n\n                        const handler = attrManager.getHandler(prop, $el);\n                        handler.handle(convertedValue, prop, $el, topics);\n                    });\n                });\n            }\n\n            const deferred = $.Deferred();\n            $(function () {\n                me.bindAll();\n\n                attachUIListeners($root);\n                attachConversionListner($root);\n\n                me.plugins.autoBind = autoUpdatePlugin($root.get(0), me, me.options.autoBind);\n\n                deferred.resolve($root);\n                $root.trigger('f.domready');\n            });\n\n            return deferred.promise();\n        }\n    };\n\n    return $.extend(this, publicAPI);\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager.js","import { getConvertersForEl } from './parse-converters';\nimport { getChannelForAttribute, getChannelConfigForElement } from './parse-channel';\nimport { parseTopicsFromAttributeValue } from './parse-topics';\n\nexport { \n    getConvertersForEl,\n    getChannelForAttribute,\n    getChannelConfigForElement,\n    parseTopicsFromAttributeValue,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager-utils/dom-parse-helpers/index.js","/**\n * @param {string} conv \n * @returns {string[]}\n */\nfunction convertersToArray(conv) {\n    if (!conv || !conv.trim()) return [];\n    return conv.split('|').map((v)=> v.trim());\n}\n\n/**\n * @param {JQuery<HTMLElement>} $el\n * @param {string} attribute \n * @returns {string[]}\n */\nfunction getConvertersFromAttr($el, attribute) {\n    const attrVal = $el.attr(`data-f-${attribute}`);\n    const withConv = convertersToArray(attrVal);\n    if (withConv.length > 1) {\n        return withConv.slice(1); //First item will be the topic\n    }\n    return [];\n}\nfunction getFConvertAttrVal($el, suffix) {\n    const baseAttr = 'data-f-convert';\n    const suffixAttr = suffix ? `-${suffix}` : '';\n    const conv = $el.attr(`${baseAttr}${suffixAttr}`); //.data shows value cached by jquery\n    return convertersToArray(conv);\n}\n\n/**\n * @param {JQuery<HTMLElement>} $el  \n * @param {string} attribute \n * @returns {string[]} converters\n */\nexport function getConvertersForEl($el, attribute) {\n    function getAllConverters($el, attribute) {\n        const convertersAsPipes = getConvertersFromAttr($el, attribute);\n        if (convertersAsPipes.length) {\n            return convertersAsPipes;\n        }\n\n        const whiteListedGenericAttributes = ['bind', 'foreach', 'repeat'];\n        const canUseFConvert = whiteListedGenericAttributes.indexOf(attribute) !== -1;\n        if (canUseFConvert) {\n            return getFConvertAttrVal($el, '');\n        }\n        return getFConvertAttrVal($el, attribute);\n    }\n   \n    const converters = getAllConverters($el, attribute);\n    const $parentEl = $el.parents('[data-f-convert]').eq(0);\n    const resolvedConverters = converters.reduce((accum, val)=> {\n        if (val === 'inherit') {\n            const parentConv = getConvertersForEl($parentEl, attribute);\n            accum = accum.concat(parentConv);\n        } else {\n            accum = accum.concat(val);\n        }\n        return accum;\n    }, []);\n\n    if (!resolvedConverters.length && $parentEl.length) {\n        return getConvertersForEl($parentEl, attribute);\n    }\n    return resolvedConverters;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager-utils/dom-parse-helpers/parse-converters.js","/**\n * \n * @param {JQuery<HTMLElement>} $el  \n * @param {string} attr \n * @returns {string|undefined}\n */\nexport function getChannelForAttribute($el, attr) {\n    attr = attr.replace('data-f-', '');\n    let channel = $el.data('f-channel-' + attr);\n    if (channel === undefined) {\n        channel = $el.attr('data-f-channel'); //.data shows value cached by jquery\n    }\n    if (channel === undefined) {\n        const $parentEl = $el.closest('[data-f-channel]');\n        if ($parentEl) {\n            channel = $parentEl.attr('data-f-channel');\n        }\n    }\n    return channel;\n}\n\n/**\n * @param {HTMLElement} el\n * @returns {Object}\n */ \nexport function getChannelConfigForElement(el) {\n    //TODO: Should this look at parents too?\n    const attrs = el.attributes;\n    const config = {};\n    for (let i = 0; i < attrs.length; i++) {\n        const attrib = el.attributes[i];\n        if (attrib.specified && attrib.name.indexOf('data-f-channel-') === 0) {\n            const key = attrib.name.replace('data-f-channel-', '');\n            config[key] = attrib.value;\n        }\n    }\n    return config;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager-utils/dom-parse-helpers/parse-channel.js","/**\n * @param {string} attrVal \n * @returns {NormalizedTopic[]} variables\n */\nexport function parseTopicsFromAttributeValue(attrVal) {\n    const commaRegex = /,(?![^[(]*[\\])])/; //split except on a[b,c] or a(v,c)\n    const topicsPart = attrVal.split('|')[0];\n    if (topicsPart.indexOf('<%') !== -1) { //Assume it's templated for later use\n        return [];\n    } \n    const split = topicsPart.split(commaRegex);\n    if (split.length > 1) {\n        return split.map((v)=> ({ name: v.trim() }));\n    } \n    return [{ name: topicsPart.trim() }];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager-utils/dom-parse-helpers/parse-topics.js","/**\n * \n * @param {NormalizedTopic[]} topics \n * @param {string} prefix \n * @returns {NormalizedTopic[]}\n */\nexport function addPrefixToTopics(topics, prefix) {\n    if (!prefix) {\n        return topics;\n    }\n    const mappedTopics = topics.map((topic)=> {\n        const currentName = topic.name;\n        const hasChannelDefined = currentName.indexOf(':') !== -1;\n        if (!hasChannelDefined) {\n            topic.name = `${prefix}:${currentName}`;\n        }\n        return topic;\n    });\n    return mappedTopics;\n}\n\nconst DEFAULT_OPERATIONS_PREFIX = 'operations:';\nconst DEFAULT_VARIABLES_PREFIX = 'variables:';\n\nexport function addDefaultPrefix(name, source, channelPrefix) {\n    const isUnprefixed = name.indexOf(':') === -1;\n\n    const defaultPrefix = source.indexOf('on-') === 0 ? DEFAULT_OPERATIONS_PREFIX : DEFAULT_VARIABLES_PREFIX;\n    const needsDefaultPrefix = defaultPrefix !== DEFAULT_VARIABLES_PREFIX;\n\n    if (isUnprefixed && needsDefaultPrefix) {\n        name = `${defaultPrefix}${name}`;\n    }\n    const hasDefaultPrefix = name.indexOf(defaultPrefix) === 0;\n    if ((isUnprefixed || hasDefaultPrefix) && channelPrefix) {\n        name = `${channelPrefix}:${name}`;\n    }\n    return name;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/dom-manager-utils/dom-channel-prefix-helpers/index.js","import { isFunction, isString, isRegExp, find, mapValues } from 'lodash';\nimport { splitNameArgs, toImplicitType } from 'utils/parse-utils';\n\nvar normalize = function (alias, converter, acceptList) {\n    var ret = [];\n    //nomalize('flip', fn)\n    if (isFunction(converter)) {\n        ret.push({\n            alias: alias,\n            convert: converter,\n            acceptList: acceptList\n        });\n    } else if ($.isPlainObject(converter) && converter.convert) {\n        converter.alias = alias;\n        converter.acceptList = acceptList;\n        ret.push(converter);\n    } else if ($.isPlainObject(alias)) {\n        //normalize({alias: 'flip', convert: function})\n        if (alias.convert) {\n            ret.push(alias);\n        } else {\n            // normalize({flip: fun})\n            $.each(alias, function (key, val) {\n                ret.push({\n                    alias: key,\n                    convert: val,\n                    acceptList: acceptList\n                });\n            });\n        }\n    }\n    return ret;\n};\n\nvar matchConverter = function (alias, converter) {\n    if (isString(converter.alias)) {\n        return alias === converter.alias;\n    } else if (isFunction(converter.alias)) {\n        return converter.alias(alias);\n    } else if (isRegExp(converter.alias)) {\n        return converter.alias.match(alias);\n    }\n    return false;\n};\n\nvar converterManager = {\n    private: {\n        matchConverter: matchConverter\n    },\n\n    list: [],\n    /**\n     * Add a new attribute converter to this instance of Flow.js.\n     *\n     * **Example**\n     *\n     *      Flow.dom.converters.register('max', function (value) {\n     *          return max(value);\n     *      }, true);\n     *\n     *      Flow.dom.converters.register({\n     *          alias: 'sig',\n     *          parse: $.noop,\n     *          convert: function (value) {\n     *              return value.firstName + ' ' + value.lastName + ', ' + value.jobTitle;\n     *      }, false);\n     *\n     *      <div>\n     *          The largest sales you had was <span data-f-bind=\"salesByYear | max | $#,###\"></span>.\n     *          The current sales manager is <span data-f-bind=\"salesMgr | sig\"></span>.\n     *      </div>\n     *\n     * @param  {string|Function|RegExp} alias Formatter name.\n     * @param  {Function|Object} [converter] If a function, `converter` is called with the value. If an object, should include fields for `alias` (name), `parse` (function), and `convert` (function).\n     * @param {boolean} [acceptList] Determines if the converter is a 'list' converter or not. List converters take in arrays as inputs, others expect single values.\n     * @returns {void}\n     */\n    register: function (alias, converter, acceptList) {\n        var normalized = normalize(alias, converter, acceptList);\n        this.list = normalized.concat(this.list);\n    },\n\n    /**\n     * Replace an already registered converter with a new one of the same name.\n     *\n     * @param {string} alias Formatter name.\n     * @param {Function|Object} converter If a function, `converter` is called with the value. If an object, should include fields for `alias` (name), `parse` (function), and `convert` (function).\n     * @returns {void}\n     */\n    replace: function (alias, converter) {\n        var index;\n        this.list.forEach(function (currentConverter, i) {\n            if (matchConverter(alias, currentConverter)) {\n                index = i;\n                return false;\n            }\n        });\n        this.list.splice(index, 1, normalize(alias, converter)[0]);\n    },\n\n    getConverter: function (alias) {\n        var norm = splitNameArgs(alias);\n        norm.args = norm.args.map(toImplicitType);\n\n        var conv = find(this.list, function (converter) {\n            return matchConverter(norm.name, converter);\n        });\n        if (conv && norm.args) {\n            return $.extend({}, conv, { convert: Function.bind.apply(conv.convert, [null].concat(norm.args)) });\n        }\n        return conv;\n    },\n\n    /**\n     * Pipes the value sequentially through a list of provided converters.\n     *\n     * @param  {*} value Input for the converter to tag.\n     * @param  {string|string[]} list List of converters (maps to converter alias).\n     *\n     * @returns {*} Converted value.\n     */\n    convert: function (value, list) {\n        if (!list || !list.length) {\n            return value;\n        }\n        list = ([].concat(list)).map((v)=> v.trim());\n\n        var currentValue = value;\n        var me = this;\n\n        var convertArray = function (converter, val, converterName) {\n            return val.map(function (v) {\n                return converter.convert(v, converterName);\n            });\n        };\n        var convert = function (converter, value, converterName) {\n            var converted;\n            if (Array.isArray(value) && converter.acceptList !== true) {\n                converted = convertArray(converter, value, converterName);\n            } else {\n                converted = converter.convert(value, converterName);\n            }\n            return converted;\n        };\n        var convertObject = function (converter, value, converterName) {\n            return mapValues(value, function (val) {\n                return convert(converter, val, converterName);\n            });\n        };\n        list.forEach(function (converterName) {\n            var converter = me.getConverter(converterName);\n            if (!converter) {\n                throw new Error('Could not find converter for ' + converterName);\n            }\n            if ($.isPlainObject(currentValue) && converter.acceptList !== true) {\n                currentValue = convertObject(converter, currentValue, converterName);\n            } else {\n                currentValue = convert(converter, currentValue, converterName);\n            }\n        });\n        return currentValue;\n    },\n\n    /**\n     * Counter-part to `convert()`. Translates converted values back to their original form.\n     *\n     * @param  {*} value Value to parse.\n     * @param  {string|string[]} list  List of parsers to run the value through. Outermost is invoked first.\n     * @returns {*} Original value.\n     */\n    parse: function (value, list) {\n        if (!list || !list.length) {\n            return value;\n        }\n        list = [].concat(list).reverse().map((v)=> v.trim());\n\n        var currentValue = value;\n        var me = this;\n        list.forEach(function (converterName) {\n            var converter = me.getConverter(converterName);\n            if (!converter) {\n                throw new Error('parse: Could not find converter ' + converterName);\n            }\n            if (converter.parse) {\n                currentValue = converter.parse(currentValue, converterName);\n            }\n        });\n        return currentValue;\n    }\n};\n\n\n//Bootstrap\nvar defaultconverters = [\n    require('./converters/number-converters'),\n    require('./converters/string-converters'),\n    require('./converters/array-converters'),\n    require('./converters/general-util-converters'),\n    require('./converters/numberformat-converter'),\n    require('./converters/number-compare-converters'),\n    require('./converters/boolean-conditional-converters'),\n    require('./converters/collection-converters')\n];\n\ndefaultconverters.reverse().forEach(function (converter) {\n    if (Array.isArray(converter)) {\n        converter.forEach(function (c) {\n            converterManager.register(c);\n        });\n    } else {\n        converterManager.register(converter);\n    }\n});\n\nexport default converterManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/index.js","module.exports = {\n    /**\n     * Convert source value to an integer. Often used for chaining to another converter.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          Your car has driven\n     *          <span data-f-bind=\"Odometer | i | s0.0\"></span> miles.\n     *      </div>\n     *\n     * @param {string} value Source value.\n     * @returns {number}\n     */\n    i: function (value) {\n        return parseFloat(value);\n    },\n\n    /**\n     * Add value to source number.\n     *\n     * **Example**\n     *      <div>\n     *          Next year is <span data-f-bind=\"Year | plus(1)\"></span>.\n     *      </div>\n     *\n     * @param {string} operand Value to add\n     * @param {string} value Source value\n     * @returns {number}\n     */\n    plus: function (operand, val) {\n        return Number(val) + Number(operand);\n    },\n\n    /**\n     * Subtract value from source number.\n     *\n     * **Example**\n     *      <div>\n     *          Last year was <span data-f-bind=\"Year | minus(1)\"></span>.\n     *      </div>\n     *\n     * @param {string} operand Value to add\n     * @param {string} value Source value\n     * @returns {number}\n     */\n    minus: function (operand, val) {\n        return Number(val) - Number(operand);\n    },\n\n    /**\n     * Multiply value with source number.\n     *\n     * **Example**\n     *      <div>\n     *          Total cost is <span data-f-bind=\"Units | multiplyBy(10)\"></span>.\n     *      </div>\n     *\n     * @param {string} operand Value to add\n     * @param {string} value Source value\n     * @returns {number}\n     */\n    multiplyBy: function (operand, val) {\n        return Number(val) * Number(operand);\n    },\n\n    /**\n     * Divide value by source number.\n     *\n     * **Example**\n     *      <div>\n     *          Unit cost is <span data-f-bind=\"Total Cost | divideBy(10)\"></span>.\n     *      </div>\n     *\n     * @param {string} operand Value to add\n     * @param {string} value Source value\n     * @returns {number}\n     */\n    divideBy: function (operand, val) {\n        return Number(val) / Number(operand);\n    },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/number-converters/index.js","module.exports = {\n\n    /**\n     * Convert the model variable to a string. Often used for chaining to another converter.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          This year you are in charge of sales for\n     *          <span data-f-bind=\"salesMgr.region | s | upperCase\"></span>.\n     *      </div>\n     *\n     * @param {Array} val The model variable.\n     * @returns {string} converted string\n     */\n    s: function (val) {\n        return val + '';\n    },\n\n    /**\n     * Convert the model variable to UPPER CASE.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          This year you are in charge of sales for\n     *          <span data-f-bind=\"salesMgr.region | s | upperCase\"></span>.\n     *      </div>\n     *\n     * @param {Array} val The model variable.\n     * @returns {string} converted string\n     */\n    upperCase: function (val) {\n        return (val + '').toUpperCase();\n    },\n\n    /**\n     * Convert the model variable to lower case.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          Enter your user name:\n     *          <input data-f-bind=\"userName | lowerCase\"></input>.\n     *      </div>\n     *\n     * @param {Array} val The model variable.\n     * @returns {string} converted string\n     */\n    lowerCase: function (val) {\n        return (val + '').toLowerCase();\n    },\n\n    /**\n     * Convert the model variable to Title Case.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          Congratulations on your promotion!\n     *          Your new title is: <span data-f-bind=\"currentRole | titleCase\"></span>.\n     *      </div>\n     *\n     * @param {string} val The model variable.\n     * @returns {string} converted string\n     */\n    titleCase: function (val) {\n        val = val + '';\n        return val.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n        });\n    },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/string-converters/index.js","const _ = require('lodash');\n\nfunction parseLimitArgs(starting, limit, val) {\n    let toRet = {};\n    if (arguments.length === 3) { //eslint-disable-line\n        toRet = {\n            input: limit,\n            limit: starting\n        };\n    } else if (arguments.length === 2) {\n        toRet = {\n            input: starting\n        };\n    } else {\n        console.error('Too many arguments passed to last', arguments);\n        throw new Error('Too many arguments passed to last');\n    }\n\n    toRet.input = [].concat(toRet.input);\n    return toRet;\n}\n\nconst list = {\n    /**\n     * Convert the input into an array. \n     *\n     * @param {any[]} val The array model variable.\n     * @returns {any[]}\n     */\n    list: (val)=> [].concat(val),\n\n    /**\n     * Reverse the array.\n     *\n     * **Example**\n     *\n     *      <p>Show the history of our sales, starting with the last (most recent):</p>\n     *      <ul data-f-foreach=\"Sales | reverse\">\n     *          <li></li>\n     *      </ul>\n     *\n     * @param {any[]} val The array model variable.\n     * @returns {any[]} the reversed array\n     */\n    reverse: (val)=> ([].concat(val)).reverse(),\n\n    /**\n     * Select only the last element of the array.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          In the current year, we have <span data-f-bind=\"Sales | last\"></span> in sales.\n     *      </div>\n     *\n     * @param {number} n number of items to get\n     * @param {any[]} val The array model variable.\n     * @returns {any} last element of array\n     */\n    last: function (n, val) {\n        const parsed = parseLimitArgs.apply(null, arguments);\n        const stripped = parsed.input.slice(-(parsed.limit || 1));\n        if (stripped.length <= 1) {\n            return stripped[0];\n        }\n        return stripped;\n    },\n\n    /**\n     * Select only the first element of the array.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          Our initial investment was <span data-f-bind=\"Capital | first\"></span>.\n     *      </div>\n     *\n     * @param {number} n number of items to get\n     * @param {any[]} val The array model variable.\n     * @returns {any} first element of the array\n     */\n    first: function (n, val) {\n        const parsed = parseLimitArgs.apply(null, arguments);\n        const stripped = parsed.input.slice(0, (parsed.limit || 1));\n        if (stripped.length <= 1) {\n            return stripped[0];\n        }\n        return stripped;\n    },\n\n    /**\n     * Select only the previous (second to last) element of the array.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          Last year we had <span data-f-bind=\"Sales | previous\"></span> in sales.\n     *      </div>\n     *\n     * @param {any[]} val The array model variable.\n     * @returns {any} the previous (second to last) element of the array.\n     */\n    previous: (val)=> {\n        val = [].concat(val);\n        return (val.length <= 1) ? val[0] : val[val.length - 2];\n    },\n\n    /**\n     * Returns length of array\n     *\n     * **Example**\n     * Total Items: <h6 data-f-bind=\"items | size\"></h6>\n     * \n     * @param  {any[]} src array\n     * @returns {number}     length of array\n     */\n    size: (src)=> [].concat(src).length,\n\n    /**\n     * Select every nth item from array\n     *\n     * **Example**\n     * <!-- select every 10th item starting from itself\n     * <ul data-f-foreach=\"Time | pickEvery(10)\"><li></li></ul>\n     * <!-- select every 10th item starting from the fifth\n     * <ul data-f-foreach=\"Time | pickEvery(10, 5)\"><li></li></ul>\n     * \n     * @param  {number} n          nth item to select\n     * @param  {number} [startIndex] index to start from\n     * @param  {any[]} [val]        source array\n     * @returns {any[]}            shortened array\n     */\n    pickEvery: function (n, startIndex, val) {\n        if (arguments.length === 3) { //eslint-disable-line\n            //last item is match string\n            val = startIndex;\n            startIndex = 0;\n        }\n        val = [].concat(val);\n        val = val.slice(startIndex);\n        return val.filter((item, index)=> {\n            return (index % n) === 0;\n        });\n    },\n};\n\nconst mapped = Object.keys(list).map(function (alias) {\n    const fn = list[alias];\n    const newfn = function () {\n        const args = _.toArray(arguments);\n        const indexOfActualValue = args.length - 2; //last item is the matchstring\n        const val = args[indexOfActualValue];\n        if ($.isPlainObject(val)) {\n            return Object.keys(val).reduce((accum, key)=> {\n                const arr = val[key];\n                const newArgs = args.slice();\n                newArgs[indexOfActualValue] = arr;\n                accum[key] = fn.apply(fn, newArgs);\n                return accum;\n            }, {});\n        }\n        return fn.apply(fn, arguments);\n    };\n    return {\n        alias: alias,\n        acceptList: true,\n        convert: newfn,\n    };\n});\nmodule.exports = mapped;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/array-converters/index.js","function parseArgs(toCompare, trueVal, falseVal, valueToCompare, matchString) {\n    const toReturn = { trueVal: true, falseVal: false };\n    switch (arguments.length) {\n        case 5: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: valueToCompare });\n        case 4: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: falseVal }); \n        case 3: //eslint-disable-line\n            return $.extend(toReturn, { input: trueVal, falseVal: trueVal }); \n        default:\n            return toReturn;\n    }\n}\n\nmodule.exports = [\n    {\n        alias: 'is',\n        acceptList: false,\n        convert: function (toCompare) {\n            const args = parseArgs.apply(null, arguments);\n            return args.input === toCompare ? args.trueVal : args.falseVal;\n        }\n    }\n];\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/general-util-converters/index.js","const { isString, isNumber } = require('lodash');\n\nfunction isAllowedLeading(str) { \n    const validPrefixes = ['₹', '$', '£', '¥', '±', '’', '¢', '€'];\n    return validPrefixes.indexOf(str.trim()) !== -1;\n}\n\nmodule.exports = {\n    /**\n     * @param {string} name\n     * @returns {boolean}\n     */\n    alias: function (name) {\n        /**\n         * @param {string} v\n         * @returns {boolean}\n         */\n        function checkValMatch(v) {\n            const validStandalone = ['#', '0', '%'];\n            if (v.length === 1) {\n                return validStandalone.indexOf(v) !== -1;\n            }\n\n            const validFirstChars = ['s', '#', '0', '.'];\n            const validLastChars = ['%', '#', '0'];\n\n            if (isAllowedLeading(v.charAt(0))) {\n                v = v.slice(1);\n            }\n            const isValidFirstChar = validFirstChars.indexOf(v.charAt(0)) !== -1;\n            const isValidLastChar = validLastChars.indexOf(v.charAt(v.length - 1)) !== -1;\n\n            if (v.length === 2) {\n                return isValidFirstChar && isValidLastChar;\n            }\n            \n            const validRemainingChars = ['#', '0', '.', ','];\n            const areRemainingCharactersValid = v.substr(1, v.length - 2).split('').reduce((accum, char)=> {\n                const isMatch = validRemainingChars.indexOf(char) !== -1;\n                if (!isMatch) {\n                    accum = false;\n                }\n                return accum;\n            }, true);\n\n            return isValidFirstChar && isValidLastChar && areRemainingCharactersValid;\n        }\n\n        const parts = name.split(' ');\n        if (parts.length === 3) {\n            return checkValMatch(parts[1]); //prefix and suffix\n        } else if (parts.length === 1) {\n            return checkValMatch(parts[0]); //just the number\n        } else if (parts.length === 2) {\n            return checkValMatch(parts[0]) || checkValMatch(parts[1]); //either prefix or suffix\n        }\n        return false;\n    },\n\n    /**\n     * @param {string} val\n     * @returns {number}\n     */\n    parse: function (val) {\n        val += '';\n        var isNegative = val.charAt(0) === '-';\n\n        val = val.replace(/,/g, '');\n        var floatMatcher = /([-+]?[0-9]*\\.?[0-9]+)(K?M?B?%?)/i;\n        var results = floatMatcher.exec(val);\n        var number;\n        var suffix = '';\n        if (results && results[1]) {\n            number = results[1];\n        }\n        if (results && results[2]) {\n            suffix = results[2].toLowerCase();\n        }\n\n        /*eslint no-magic-numbers: 0 complexity: 0 */\n        switch (suffix) {\n            case '%':\n                number = number / 100;\n                break;\n            case 'k':\n                number = number * 1000;\n                break;\n            case 'm':\n                number = number * 1000000;\n                break;\n            case 'b':\n                number = number * 1000000000;\n                break;\n            default:\n        }\n        number = parseFloat(number);\n        if (isNegative && number > 0) {\n            number = number * -1;\n        }\n        return number;\n    },\n\n    convert: (function (value) {\n        var scales = ['', 'K', 'M', 'B', 'T'];\n        function roundTo(value, digits) {\n            return Math.round(value * Math.pow(10, digits)) / Math.pow(10, digits);\n        }\n\n        function getDigits(value, digits) {\n            value = value === 0 ? 0 : roundTo(value, Math.max(0, digits - Math.ceil(Math.log(value) / Math.LN10)));\n\n            var TXT = '';\n            var numberTXT = value.toString();\n            var decimalSet = false;\n\n            for (var iTXT = 0; iTXT < numberTXT.length; iTXT++) {\n                TXT += numberTXT.charAt(iTXT);\n                if (numberTXT.charAt(iTXT) === '.') {\n                    decimalSet = true;\n                } else {\n                    digits--;\n                }\n\n                if (digits <= 0) {\n                    return TXT;\n                }\n            }\n\n            if (!decimalSet) {\n                TXT += '.';\n            }\n            while (digits > 0) {\n                TXT += '0';\n                digits--;\n            }\n            return TXT;\n        }\n\n        function addDecimals(value, decimals, minDecimals, hasCommas) {\n            hasCommas = !!hasCommas;\n            var numberTXT = value.toString();\n            var hasDecimals = (numberTXT.split('.').length > 1);\n            var iDec = 0;\n\n            if (hasCommas) {\n                for (var iChar = numberTXT.length - 1; iChar > 0; iChar--) {\n                    if (hasDecimals) {\n                        hasDecimals = (numberTXT.charAt(iChar) !== '.');\n                    } else {\n                        iDec = (iDec + 1) % 3;\n                        if (iDec === 0) {\n                            numberTXT = numberTXT.substr(0, iChar) + ',' + numberTXT.substr(iChar);\n                        }\n                    }\n                }\n\n            }\n            if (decimals > 0) {\n                var toADD;\n                if (numberTXT.split('.').length <= 1) {\n                    toADD = minDecimals;\n                    if (toADD > 0) {\n                        numberTXT += '.';\n                    }\n                } else {\n                    toADD = minDecimals - numberTXT.split('.')[1].length;\n                }\n\n                while (toADD > 0) {\n                    numberTXT += '0';\n                    toADD--;\n                }\n            }\n            return numberTXT;\n        }\n\n        function getSuffix(formatTXT) {\n            formatTXT = formatTXT.replace('.', '');\n            var fixesTXT = formatTXT.split(new RegExp('[0|,|#]+', 'g'));\n            return (fixesTXT.length > 1) ? fixesTXT[1].toString() : '';\n        }\n\n        function format (number, formatTXT) { // eslint-disable-line\n            if (Array.isArray(number)) {\n                number = number[number.length - 1];\n            }\n            if (!isString(number) && !isNumber(number)) {\n                return number;\n            }\n\n            if (!formatTXT || formatTXT.toLowerCase() === 'default') {\n                return number.toString();\n            }\n\n            if (isNaN(number)) {\n                return '?';\n            }\n\n            //var formatTXT;\n            const entityCodeMapping = {\n                '&euro;': '€',\n                '&dollar;': '$',\n                '&cent;': '¢',\n                '&pound;': '£',\n                '&yen;': '¥',\n            };\n            Object.keys(entityCodeMapping).forEach((code)=> {\n                formatTXT = formatTXT.replace(code, entityCodeMapping[code]);\n            });\n\n            // Divide +/- Number Format\n            var formats = formatTXT.split(';');\n            if (formats.length > 1) {\n                return format(Math.abs(number), formats[((number >= 0) ? 0 : 1)]);\n            }\n\n            // Save Sign\n            var sign = (number >= 0) ? '' : '-';\n            number = Math.abs(number);\n\n\n            var leftOfDecimal = formatTXT;\n            var d = leftOfDecimal.indexOf('.');\n            if (d > -1) {\n                leftOfDecimal = leftOfDecimal.substring(0, d);\n            }\n\n            var normalized = leftOfDecimal.toLowerCase();\n            var index = normalized.lastIndexOf('s');\n            var isShortFormat = index > -1;\n\n            if (isShortFormat) {\n                var nextChar = leftOfDecimal.charAt(index + 1);\n                if (nextChar === ' ') {\n                    isShortFormat = false;\n                }\n            }\n\n            var leadingText = isShortFormat ? formatTXT.substring(0, index) : '';\n            var rightOfPrefix = isShortFormat ? formatTXT.substr(index + 1) : formatTXT.substr(index);\n\n            //first check to make sure 's' is actually short format and not part of some leading text\n            if (isShortFormat) {\n                var shortFormatTest = /[0-9#*]/;\n                var shortFormatTestResult = rightOfPrefix.match(shortFormatTest);\n                if (!shortFormatTestResult || shortFormatTestResult.length === 0) {\n                    //no short format characters so this must be leading text ie. 'weeks '\n                    isShortFormat = false;\n                    leadingText = '';\n                }\n            }\n\n            //if (formatTXT.charAt(0) == 's')\n            if (isShortFormat) {\n                var valScale = number === 0 ? 0 : Math.floor(Math.log(Math.abs(number)) / (3 * Math.LN10));\n                valScale = ((number / Math.pow(10, 3 * valScale)) < 1000) ? valScale : (valScale + 1);\n                valScale = Math.max(valScale, 0);\n                valScale = Math.min(valScale, 4);\n                number = number / Math.pow(10, 3 * valScale);\n                //if (!isNaN(Number(formatTXT.substr(1) ) ) )\n\n                if (!isNaN(Number(rightOfPrefix)) && rightOfPrefix.indexOf('.') === -1) {\n                    var limitDigits = Number(rightOfPrefix);\n                    if (number < Math.pow(10, limitDigits)) {\n                        if (isAllowedLeading(leadingText)) {\n                            return sign + leadingText + getDigits(number, Number(rightOfPrefix)) + scales[valScale];\n                        } else {\n                            return leadingText + sign + getDigits(number, Number(rightOfPrefix)) + scales[valScale];\n                        }\n                    } else if (isAllowedLeading(leadingText)) {\n                        return sign + leadingText + Math.round(number) + scales[valScale];\n                    } else {\n                        return leadingText + sign + Math.round(number) + scales[valScale];\n                    }\n                } else {\n                    //formatTXT = formatTXT.substr(1);\n                    formatTXT = formatTXT.substr(index + 1);\n                    var SUFFIX = getSuffix(formatTXT);\n                    formatTXT = formatTXT.substr(0, formatTXT.length - SUFFIX.length);\n\n                    var valWithoutLeading = format(((sign === '') ? 1 : -1) * number, formatTXT) + scales[valScale] + SUFFIX;\n                    if (isAllowedLeading(leadingText) && sign !== '') {\n                        valWithoutLeading = valWithoutLeading.substr(sign.length);\n                        return sign + leadingText + valWithoutLeading;\n                    }\n\n                    return leadingText + valWithoutLeading;\n                }\n            }\n\n            var subFormats = formatTXT.split('.');\n            var decimals;\n            var minDecimals;\n            if (subFormats.length > 1) {\n                decimals = subFormats[1].length - subFormats[1].replace(new RegExp('[0|#]+', 'g'), '').length;\n                minDecimals = subFormats[1].length - subFormats[1].replace(new RegExp('0+', 'g'), '').length;\n                formatTXT = subFormats[0] + subFormats[1].replace(new RegExp('[0|#]+', 'g'), '');\n            } else {\n                decimals = 0;\n            }\n\n            var fixesTXT = formatTXT.split(new RegExp('[0|,|#]+', 'g'));\n            var preffix = fixesTXT[0].toString();\n            var suffix = (fixesTXT.length > 1) ? fixesTXT[1].toString() : '';\n\n            number = number * ((formatTXT.split('%').length > 1) ? 100 : 1);\n            //            if (formatTXT.indexOf('%') !== -1) number = number * 100;\n            number = roundTo(number, decimals);\n\n            sign = (number === 0) ? '' : sign;\n\n            var hasCommas = (formatTXT.substr(formatTXT.length - 4 - suffix.length, 1) === ',');\n            var formatted = sign + preffix + addDecimals(number, decimals, minDecimals, hasCommas) + suffix;\n\n            //  console.log(originalNumber, originalFormat, formatted)\n            return formatted;\n        }\n\n        return format;\n    }())\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/numberformat-converter/index.js","function parseArgs(limit, trueVal, falseVal, valueToCompare, matchString) {\n    var toReturn = { trueVal: true, falseVal: false };\n    switch (arguments.length) {\n        case 5: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: valueToCompare });\n        case 4: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: falseVal }); \n        case 3: //eslint-disable-line\n            return $.extend(toReturn, { input: trueVal, falseVal: trueVal }); \n        default:\n            return toReturn;\n    }\n}\nmodule.exports = {\n    /**\n     * Convert the model variable to true, or other values passed to the converter, based on whether the model variable is greater than the limit.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <!-- displays true or the number of widgets -->\n     *          <span data-f-bind=\"widgets | greaterThan(50)\"></span> \n     *\n     *          <!-- displays custom text -->\n     *          <span data-f-bind=\"widgets | greaterThan(50, 'Congratulations!', 'Better luck next year')\"></span>\n     *      </div>\n     *\n     * @param {number} limit The reference value to compare the model variable against.\n     * @param {string} trueVal (Optional) The format (value) to display if the model variable is greater than `limit`. If not included, the display is `true`. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The format (value) to display if the model variable is less than or equal to `limit`. If not included, the display is the value of the model variable. If there are commas in this argument, they must be escaped with `\\`.\n     * @returns {*} If the model variable is greater than `limit`, returns trueVal or `true`. Otherwise returns falseVal if provided, or echoes the input.\n     */\n    greaterThan: function (limit) {\n        var args = parseArgs.apply(null, arguments);\n        return Number(args.input) > Number(limit) ? args.trueVal : args.falseVal;\n    },\n\n    /**\n     * Convert the model variable to true, or other values passed to the converter, based on whether the model variable is greater than or equal to the limit.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <!-- displays true or the number of widgets -->\n     *          <span data-f-bind=\"widgets | greaterThan(50)\"></span> \n     *\n     *          <!-- displays custom text -->\n     *          <span data-f-bind=\"widgets | greaterThan(50, 'Congratulations!', 'Better luck next year')\"></span>\n     *      </div>\n     *\n     * @param {number} limit The reference value to compare the model variable against.\n     * @param {string} trueVal (Optional) The format (value) to display if the model variable is greater than or equal to `limit`. If not included, the display is `true`. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The format (value) to display if the model variable is less than `limit`. If not included, the display is the value of the model variable. If there are commas in this argument, they must be escaped with `\\`.\n     * @returns {*} If the model variable is greater than or equal to `limit`, returns trueVal or `true`. Otherwise returns falseVal if provided, or echoes the input.\n     */    \n    greaterThanEqual: function (limit) {\n        var args = parseArgs.apply(null, arguments);\n        return Number(args.input) >= Number(limit) ? args.trueVal : args.falseVal;\n    },\n\n    /**\n     * Convert the model variable to true, or other values passed to the converter, based on whether the model variable is equal to the limit.\n     *\n     * \n     * **Example**\n     *\n     *      <div>\n     *          <!-- displays true or the number of widgets -->\n     *          <span data-f-bind=\"widgets | equalsNumber(50)\"></span> \n     *\n     *          <!-- display custom text -->\n     *          <span data-f-bind=\"widgets | equalsNumber(50, 'Met the goal exactly!', 'Not an exact match')\"></span>\n     *      </div>\n     *\n     * @param {number} limit The reference value to compare the model variable against.\n     * @param {string} trueVal (Optional) The format (value) to display if the model variable is equal to `limit`. If not included, the display is `true`. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The format (value) to display if the model variable is not equal to `limit`. If not included, the display is the value of the model variable. If there are commas in this argument, they must be escaped with `\\`.\n     * @returns {*} If the model variable equals `limit`, returns trueVal or `true`. Otherwise returns falseVal if provided, or echoes the input.\n     */\n    equalsNumber: function (limit) {\n        var args = parseArgs.apply(null, arguments);\n        return Number(args.input) === Number(limit) ? args.trueVal : args.falseVal;\n    },\n\n    /**\n     * Convert the model variable to true, or other values passed to the converter, based on whether the model variable is less than the limit.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <!-- displays true or the number of widgets -->\n     *          <span data-f-bind=\"widgets | lessThan(50)\"></span> \n     *\n     *          <!-- display custom text -->\n     *          <span data-f-bind=\"widgets | lessThan(50, 'Oops didn't make quite enough!', 'Built a lot of widgets this year!')\"></span>\n     *      </div>\n     *\n     * @param {number} limit The reference value to compare the model variable against.\n     * @param {string} trueVal (Optional) The format (value) to display if the model variable is less than `limit`. If not included, the display is `true`. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The format (value) to display if the model variable is less than `limit`. If not included, the display is the value of the model variable. If there are commas in this argument, they must be escaped with `\\`.\n     * @returns {*} If the model variable is less than `limit`, returns trueVal or `true`. Otherwise returns falseVal if provided, or echoes the input.\n     */ \n    lessThan: function (limit) {\n        var args = parseArgs.apply(null, arguments);\n        return Number(args.input) < Number(limit) ? args.trueVal : args.falseVal;\n    },\n\n    /**\n     * Convert the model variable to true, or other values passed to the converter, based on whether the model variable is less than or equal to the limit.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <!-- displays true or the number of widgets -->\n     *          <span data-f-bind=\"widgets | lessThanEqual(50)\"></span> \n     *\n     *          <!-- display custom text -->\n     *          <span data-f-bind=\"widgets | lessThanEqual(50, 'Oops didn't make quite enough!', 'Built a lot of widgets this year!')\"></span>\n     *      </div>\n     *\n     * @param {number} limit The reference value to compare the model variable against.\n     * @param {string} trueVal (Optional) The format (value) to display if the model variable is less than or equal to `limit`. If not included, the display is `true`. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The format (value) to display if the model variable is less than or equal to `limit`. If not included, the display is the value of the model variable. If there are commas in this argument, they must be escaped with `\\`.\n     * @returns {*} If the model variable is less than or equal to `limit`, returns trueVal or `true`. Otherwise returns falseVal if provided, or echoes the input.\n     */\n    lessThanEqual: function (limit) {\n        var args = parseArgs.apply(null, arguments);\n        return Number(args.input) <= Number(limit) ? args.trueVal : args.falseVal;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/number-compare-converters/index.js","function parseArgs(trueVal, falseVal, input, matchString) {\n    var toReturn = { trueVal: true, falseVal: false };\n    switch (arguments.length) {\n        case 4: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: input });\n        case 3: //eslint-disable-line\n            return $.extend(toReturn, { trueVal: trueVal, falseVal: falseVal, input: falseVal }); \n        default:\n            return toReturn;\n    }\n}\n\nmodule.exports = {\n    /**\n     * Convert 'truthy' values to true and 'falsy' values to false.\n     *\n     * **Example**\n     *\n     *      <!-- displays \"true\" or \"false\" -->\n     *      <!-- in particular, true if sampleVar is truthy (1, true, 'some string', [] etc.), \n     *            false if sampleVar is falsy (0, false, '') -->\n     *      <span data-f-bind=\"sampleVar | toBool\"></span>\n     * \n     * @param {Any} value\n     * @returns {boolean}\n     */\n    toBool: (value)=> !!value,\n\n    /**\n     * Converts values to boolean and negates.\n     *\n     * **Example**\n     *\n     *      <!-- disables input if isGameInProgress is false -->\n     *      <input type=\"text\" data-f-disabled=\"isGameInProgress | not\" />\n     * \n     * @param {Any} value\n     * @returns {boolean}\n     */\n    not: (value)=> !value,\n\n    /**\n     * Convert the input to a new value (for example, some text), based on whether it is true or false.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <span data-f-bind=\"sampleVar | ifTrue('yes! please move forward', 'not ready to proceed')\"></span> \n     *          <span data-f-bind=\"sampleVar | ifTrue('yes! please move forward')\"></span>\n     *      </div>\n     *\n     * @param {string} trueVal The value to display if the input is true. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The value to display if the input is false. If not included, returns the input. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {Any} input (Optional) The input to test. If not included, the output of the previous argument is used.\n     * @returns {Any} If input is true, returns trueVal. If input is false, returns falseVal if provided, or echoes the input.\n     */\n    ifTrue: function () {\n        var args = parseArgs.apply(null, arguments);\n        return args.input ? args.trueVal : args.falseVal;\n    },\n    /**\n     * Convert the input to a new value (for example, some text), based on whether it is false or true.\n     *\n     * **Example**\n     *\n     *      <div>\n     *          <span data-f-bind=\"sampleVar | ifFalse('not ready to proceed', 'actually this is still true')\"></span> \n     *          <span data-f-bind=\"sampleVar | ifFalse('not ready to proceed')\"></span>\n     *      </div>\n     *\n     * @param {string} trueVal The value to display if the input is false. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {string} falseVal (Optional) The value to display if the input is true. If not included, returns the input. If there are commas in this argument, they must be escaped with `\\`.\n     * @param {Any} input (Optional) The input to test. If not included, the output of the previous argument is used.\n     * @returns {Any} If input is false, returns trueVal. If input is true, returns falseVal if provided, or echoes the input.\n     */\n    ifFalse: function () {\n        var args = parseArgs.apply(null, arguments);\n        return !args.input ? args.trueVal : args.falseVal;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/boolean-conditional-converters/index.js","const _ = require('lodash');\n\nconst list = {\n    /**\n     * Returns all values in array matching argument\n     *\n     * ** Example **\n     * <!-- list online users -->\n     * <ul data-f-foreach=\"users | filter(isOnline)\"><li></li></button>\n     * \n     * @param  {string|number|boolean} valueToFilterBy value to reject\n     * @param  {any[]} source The arrayed model variable\n     * @returns {any[]}     filtered lsit\n     */\n    filter: function (valueToFilterBy, source) {\n        source = [].concat(source);\n        if ($.isPlainObject(source[0])) {\n            return _.filter(source, valueToFilterBy);\n        }\n        return source.filter((v)=> v === valueToFilterBy);\n    },\n\n    /**\n     * Returns all values in array excluding match\n     *\n     * ** Example **\n     * <!-- list offline users -->\n     * <ul data-f-foreach=\"users | except(isOnline)\"><li></li></button>\n     * \n     * @param  {string|number|boolean} valueToReject value to reject\n     * @param  {any[]} source The arrayed model variable\n     * @returns {any[]}     filtered lsit\n     */\n    except: function (valueToReject, source) {\n        source = [].concat(source);\n        if ($.isPlainObject(source[0])) {\n            return _.reject(source, valueToReject);\n        }\n        return source.filter((v)=> v !== valueToReject);\n    },\n\n    /**\n     * Checks if array contains *any* item passing the test\n     *\n     * ** Example **\n     * <!-- hides button if any of the users are not online -->\n     * <button data-f-hideif=\"users | any(isOnline) | not\">Get Started</button>\n     * <button data-f-hideif=\"users | any({ isOnline: false })\">Get Started</button>\n     * \n     * @param  {string|Object} value value to check for\n     * @param  {any[]} source The arrayed model variable\n     * @returns {boolean}     True if match found in array\n     */\n    any: function (value, source) {\n        source = [].concat(source);\n        if ($.isPlainObject(source[0])) {\n            return _.some(source, value);\n        }\n        return source.indexOf(value) !== -1;\n    },\n\n    /**\n     * Checks if *every* item in the array passes the test\n     *\n     * ** Example **\n     * <!-- shows button if any of the users are not online -->\n     * <button data-f-showif=\"users | every(isOnline)\">Get Started</button>\n     * \n     * @param  {string|Object} value value to check for\n     * @param  {any[]} source The arrayed model variable\n     * @returns {boolean}     True if match found in array\n     */\n    every: function (value, source) {\n        source = [].concat(source);\n        if ($.isPlainObject(source[0])) {\n            return _.every(source, value);\n        }\n        return source.filter((v)=> v === value).length === source.length;\n    }\n};\nconst converters = Object.keys(list).map((name)=> {\n    return {\n        alias: name,\n        acceptList: true,\n        convert: list[name]\n    };\n});\n\nmodule.exports = converters;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/converter-manager/converters/collection-converters/index.js","import { isString, isFunction } from 'lodash';\n/**\n * @typedef NodeHandler\n * @property {string} selector\n * @property {Function} handle\n */ \n\n \n/**\n * @param {string | undefined} selector\n * @param {Function | NodeHandler } handler\n * @returns {NodeHandler}\n */\nconst normalize = function (selector, handler) {\n    if (!selector) {\n        selector = '*';\n    }\n    if (isFunction(handler)) {\n        handler = {\n            selector: selector,\n            handle: handler\n        };\n    }\n   \n    handler.selector = selector;\n    return handler;\n};\n\n/**\n * @param {string|HTMLElement|JQuery<HTMLElement>} toMatch\n * @param { {selector:string} } node\n * @returns {boolean}\n */ \nconst match = function (toMatch, node) {\n    if (isString(toMatch)) {\n        return toMatch === node.selector;\n    }\n    return $(toMatch).is(node.selector);\n};\n\nconst nodeManager = {\n    list: [],\n\n    /**\n     * Add a new node handler\n     * @param  {string} selector jQuery-compatible selector to use to match nodes\n     * @param  {Function} handler  Handlers are new-able functions. They will be called with $el as context.? TODO: Think this through\n     * @returns {void}\n     */\n    register: function (selector, handler) {\n        this.list.unshift(normalize(selector, handler));\n    },\n\n    /**\n     * @param {string|HTMLElement|JQuery<HTMLElement>} selector\n     * @returns NodeHandler\n     */ \n    getHandler: function (selector) {\n        return this.list.find(function (node) {\n            return match(selector, node);\n        });\n    },\n\n    replace: function (selector, handler) {\n        let index;\n        this.list.forEach(function (currentHandler, i) {\n            if (selector === currentHandler.selector) {\n                index = i;\n                return false;\n            }\n        });\n        this.list.splice(index, 1, normalize(selector, handler));\n    }\n};\n\n//bootstraps\nconst defaultHandlers = [\n    require('./input-checkbox-node').default,\n    require('./default-input-node').default,\n    require('./default-node')\n];\ndefaultHandlers.reverse().forEach(function (handler) {\n    nodeManager.register(handler.selector, handler);\n});\n\nexport default nodeManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/node-manager/index.js","import BaseView from './default-input-node';\nimport config from 'config';\n\nconst offAttr = config.attrs.checkboxOffValue;\n\nexport default BaseView.extend({\n    propertyHandlers: [\n\n    ],\n\n    getUIValue: function () {\n        const $el = this.$el;\n        const offAttrVal = $el.attr(offAttr);\n        const offVal = (offAttrVal && typeof offAttrVal !== 'undefined') ? offAttrVal : false;\n\n        const onAttrVal = $el.attr('value');\n        //attr = initial value, prop = current value\n        const onVal = (onAttrVal && typeof onAttrVal !== 'undefined') ? $el.prop('value') : true;\n\n        const val = ($el.is(':checked')) ? onVal : offVal;\n        return val;\n    },\n    initialize: function () {\n        BaseView.prototype.initialize.apply(this, arguments);\n    }\n}, { selector: ':checkbox,:radio' });\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/node-manager/input-checkbox-node.js","const { extend, has } = require('lodash');\n\nvar extendView = function (protoProps, staticProps) {\n    var me = this;\n    var child;\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (protoProps && has(protoProps, 'constructor')) {\n        child = protoProps.constructor;\n    } else {\n        child = function () { return me.apply(this, arguments); };\n    }\n\n    // Add static properties to the constructor function, if supplied.\n    extend(child, me, staticProps);\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () { this.constructor = child; };\n    Surrogate.prototype = me.prototype;\n    child.prototype = new Surrogate();\n\n    // Add prototype properties (instance properties) to the subclass,\n    // if supplied.\n    if (protoProps) {\n        extend(child.prototype, protoProps);\n    }\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = me.prototype; //eslint-disable-line no-underscore-dangle\n\n    return child;\n};\n\nvar View = function (options) {\n    this.$el = (options.$el) || $(options.el);\n    this.el = options.el;\n    this.initialize.apply(this, arguments);\n\n};\nextend(View.prototype, {\n    initialize: function () {},\n});\n\nView.extend = extendView;\n\nmodule.exports = View;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/base-view.js","import { isString, isFunction, isRegExp, each } from 'lodash';\n\nconst defaultHandlers = [\n    require('./attributes/no-op-attr').default,\n    require('./attributes/events/default-event-attr').default,\n    require('./attributes/loop-attrs/foreach-attr').default,\n    require('./attributes/loop-attrs/repeat-attr').default,\n    require('./attributes/class-attr').default,\n    require('./attributes/boolean-attr').default,\n    require('./attributes/toggles/show-if-attr').default,\n    require('./attributes/toggles/hide-if-attr').default,\n    require('./attributes/binds/checkbox-radio-bind-attr').default,\n    require('./attributes/binds/input-bind-attr').default,\n    require('./attributes/binds/default-bind-attr').default,\n    require('./attributes/default-attr').default\n];\n\nconst handlersList = [];\n\nconst normalize = function (attributeMatcher, nodeMatcher, handler) {\n    if (!nodeMatcher) {\n        nodeMatcher = '*';\n    }\n    if (isFunction(handler)) {\n        handler = {\n            handle: handler\n        };\n    }\n    return $.extend(handler, { test: attributeMatcher, target: nodeMatcher });\n};\n\ndefaultHandlers.forEach(function (handler) {\n    handlersList.push(normalize(handler.test, handler.target, handler));\n});\n\n\nconst matchAttr = function (matchExpr, attr, $el) {\n    let attrMatch;\n\n    if (isString(matchExpr)) {\n        attrMatch = (matchExpr === '*' || (matchExpr.toLowerCase() === attr.toLowerCase()));\n    } else if (isFunction(matchExpr)) {\n        //TODO: remove element selectors from attributes\n        attrMatch = matchExpr(attr, $el);\n    } else if (isRegExp(matchExpr)) {\n        attrMatch = attr.match(matchExpr);\n    }\n    return attrMatch;\n};\n\nconst matchNode = function (target, nodeFilter) {\n    return (isString(nodeFilter)) ? (nodeFilter === target) : nodeFilter.is(target);\n};\n\nconst attributeManager = {\n    list: handlersList,\n    /**\n     * Add a new attribute handler.\n     *\n     * @param  {string|Function|RegExp} attributeMatcher Description of which attributes to match.\n     * @param  {string|JQuery<HTMLElement>} nodeMatcher Which nodes to add attributes to. Use [jquery Selector syntax](https://api.jquery.com/category/selectors/).\n     * @param  {Function|Object} handler If `handler` is a function, the function is called with `$element` as context, and attribute value + name. If `handler` is an object, it should include two functions, and have the form: `{ init: fn,  handle: fn }`. The `init` function is called when the page loads; use this to define event handlers. The `handle` function is called with `$element` as context, and attribute value + name.\n     * @returns {void}\n     */\n    register: function (attributeMatcher, nodeMatcher, handler) {\n        handlersList.unshift(normalize.apply(null, arguments));\n    },\n\n    /**\n     * Find an attribute matcher matching some criteria.\n     *\n     * @param  {string} attrFilter Attribute to match.\n     * @param  {string|JQuery<HTMLElement>} nodeFilter Node to match.\n     *\n     * @returns {AttributeHandler[]} An array of matching attribute handlers, or null if no matches found.\n     */\n    filter: function (attrFilter, nodeFilter) {\n        let filtered = handlersList.filter(function (handler) {\n            return matchAttr(handler.test, attrFilter);\n        });\n        if (nodeFilter) {\n            filtered = filtered.filter(function (handler) {\n                return matchNode(handler.target, nodeFilter);\n            });\n        }\n        return filtered;\n    },\n\n    /**\n     * Replace an existing attribute handler.\n     *\n     * @param  {string} attrFilter Attribute to match.\n     * @param  {string|JQuery<HTMLElement>} nodeFilter Node to match.\n     * @param  {Function|Object} handler The updated attribute handler. If `handler` is a function, the function is called with `$element` as context, and attribute value + name. If `handler` is an object, it should include two functions, and have the form: `{ init: fn,  handle: fn }`. The `init` function is called when the page loads; use this to define event handlers. The `handle` function is called with `$element` as context, and attribute value + name.\n     * @returns {void}\n     */\n    replace: function (attrFilter, nodeFilter, handler) {\n        let index;\n        each(handlersList, function (currentHandler, i) {\n            if (matchAttr(currentHandler.test, attrFilter) && matchNode(currentHandler.target, nodeFilter)) {\n                index = i;\n                return false;\n            }\n        });\n        handlersList.splice(index, 1, normalize(attrFilter, nodeFilter, handler));\n    },\n\n    /**\n     *  Retrieve the appropriate handler for a particular attribute. There may be multiple matching handlers, but the first (most exact) match is always used.\n     *\n     * @param {string} attr The attribute.\n     * @param {string|JQuery<HTMLElement>} $el The DOM element.\n     *\n     * @returns {AttributeHandler|undefined} The attribute handler, if a matching one is found\n     */\n    getHandler: function (attr, $el) {\n        const filtered = this.filter(attr, $el);\n        //There could be multiple matches, but the top first has the most priority\n        return filtered[0];\n    }\n};\n\nexport default attributeManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/index.js","/**\n * @type AttributeHandler \n */\nconst noopAttr = {\n\n    target: '*',\n\n    test: /^(?:model|convert|channel|on-init)/i,\n\n    handle: ()=> {},\n    parse: ()=> []\n};\n\nexport default noopAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/no-op-attr/index.js","import { events } from 'config';\nimport { toPublishableFormat } from 'utils/parse-utils';\n\nfunction eventNameFromAttr(attr) {\n    const eventName = attr.replace('on-', '');\n    const nameSpacedEvent = `${eventName}.f-event`;\n    return nameSpacedEvent;\n}\n/**\n * @type AttributeHandler \n */\nconst defaultEventAttr = {\n\n    target: '*',\n\n    test: function (attr) {\n        return (attr.indexOf('on-') === 0);\n    },\n\n    unbind: function (attr, $el) {\n        const eventName = eventNameFromAttr(attr);\n        $el.off(eventName);\n    },\n\n    parse: ()=> ([]), //There's nothing to subscribe to on an event\n    handle: ()=> {},\n\n    init: function (attr, topics, $el) {\n        const matching = topics[0] && topics[0].name; //multiple topics aren't really relevant here\n        const eventName = eventNameFromAttr(attr);\n        $el.off(eventName).on(eventName, function (evt) {\n            evt.preventDefault();\n            var listOfOperations = toPublishableFormat(matching);\n            $el.trigger(events.trigger, { data: listOfOperations, source: attr });\n        });\n    }\n};\n\nexport default defaultEventAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/events/default-event-attr/index.js","import { toImplicitType } from 'utils/parse-utils';\nimport { animation } from 'config';\n\nimport { aliasesFromTopics, parseTopics } from '../loop-attr-utils';\nimport { addChangeClassesToList } from 'utils/animation';\nimport { each, template } from 'lodash';\n\nimport { getKnownDataForEl, updateKnownDataForEl, removeKnownData, findMissingReferences, stubMissingReferences, addBackMissingReferences, getOriginalContents, clearOriginalContents } from 'dom/attribute-manager/attr-template-utils';\n\nconst elAnimatedMap = new WeakMap(); //TODO: Can probably get rid of this if we make subscribe a promise and distinguish between initial value\n\n/**\n * @type AttributeHandler\n */\nconst foreachAttr = {\n\n    test: 'foreach',\n\n    target: '*',\n\n    unbind: function (attr, $el) {\n        const el = $el.get(0);\n        elAnimatedMap.delete(el);\n        \n        const template = getOriginalContents($el);\n        const current = $el.html();\n        if (template && current !== template) {\n            $el.html(template);\n        }\n        clearOriginalContents($el);\n        removeKnownData($el);\n    },\n\n    parse: function (topics) {\n        return parseTopics(topics);\n    },\n\n    handle: function (value, prop, $el, topics) {\n        value = ($.isPlainObject(value) ? value : [].concat(value));\n\n        const { keyAlias, valueAlias } = aliasesFromTopics(topics, value);\n\n        const originalHTML = getOriginalContents($el, ($el)=> $el.html());\n        const knownData = getKnownDataForEl($el);\n        const missingReferences = findMissingReferences(originalHTML, [keyAlias, valueAlias].concat(Object.keys(knownData)));\n        const stubbedTemplate = stubMissingReferences(originalHTML, missingReferences);\n\n        const templateFn = template(stubbedTemplate);\n        const $dummyEl = $('<div></div>');\n        each(value, function (dataval, datakey) {\n            if (dataval === undefined || dataval === null) {\n                dataval = dataval + ''; //convert undefineds to strings\n            }\n            const templateData = $.extend(true, {}, knownData, {\n                [keyAlias]: datakey,\n                [valueAlias]: dataval\n            });\n\n            let nodes;\n            let isTemplated;\n            try {\n                const templated = templateFn(templateData);\n                const templatedWithReferences = addBackMissingReferences(templated, missingReferences);\n                isTemplated = templatedWithReferences !== stubbedTemplate;\n                nodes = $(templatedWithReferences);\n            } catch (e) { //you don't have all the references you need;\n                nodes = $(stubbedTemplate);\n                isTemplated = true;\n                updateKnownDataForEl($(nodes), templateData);\n            }\n\n            nodes.each(function (i, newNode) {\n                const $newNode = $(newNode);\n                each($newNode.data(), function (val, key) {\n                    $newNode.data(key, toImplicitType(val));\n                });\n                if (!isTemplated && !$newNode.html().trim()) {\n                    $newNode.html(dataval);\n                }\n            });\n            $dummyEl.append(nodes);\n        });\n        \n        const el = $el.get(0);\n        const isInitialAnim = !elAnimatedMap.get(el);\n        const $withAnimAttrs = addChangeClassesToList($el.children(), $dummyEl.children(), isInitialAnim, animation);\n        $el.empty().append($withAnimAttrs);\n\n        elAnimatedMap.set(el, true);\n    }\n};\n\nexport default foreachAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/loop-attrs/foreach-attr/index.js","import { template, each, isEmpty } from 'lodash';\nimport { toImplicitType } from 'utils/parse-utils';\nimport { random } from 'utils/general';\nimport { attrs, animation } from 'config';\n\nconst templateIdAttr = attrs.repeat.templateId;\n\nimport { addChangeClassesToList } from 'utils/animation';\n\nconst elAnimatedMap = new WeakMap(); //TODO: Can probably get rid of this if we make subscribe a promise and distinguish between initial value\n\nimport { getKnownDataForEl, updateKnownDataForEl, removeKnownData, findMissingReferences, stubMissingReferences, addBackMissingReferences, getOriginalContents, clearOriginalContents } from 'dom/attribute-manager/attr-template-utils';\n\nimport { aliasesFromTopics, parseTopics } from '../loop-attr-utils';\n\n/**\n * @type AttributeHandler \n */\nconst loopAttrHandler = {\n    test: 'repeat',\n\n    target: '*',\n\n    unbind: function (attr, $el) {\n        var id = $el.data(templateIdAttr);\n        if (id) {\n            $el.nextUntil(':not([data-' + id + '])').remove();\n            // $el.removeAttr('data-' + templateIdAttr); //FIXME: Something about calling rebind multiple times in IB makes this happen without the removal\n        }\n\n        const el = $el.get(0);\n        elAnimatedMap.delete(el);\n\n        const originalHTML = getOriginalContents($el);\n        const current = $el.get(0).outerHTML;\n        if (originalHTML && current !== originalHTML) {\n            $el.replaceWith(originalHTML);\n        }\n        clearOriginalContents($el);\n        removeKnownData($el);\n    },\n\n    parse: function (topics) {\n        return parseTopics(topics);\n    },\n\n    init: function (attr, value, $el) {\n        \n    },\n\n    handle: function (value, prop, $el, topics) {\n        value = ($.isPlainObject(value) ? value : [].concat(value));\n        let id = $el.data(templateIdAttr);\n        \n        $el.removeAttr('hidden');\n        const originalHTML = getOriginalContents($el, ($el)=> $el.get(0).outerHTML);\n\n        const $dummyOldDiv = $('<div></div>');\n        if (id) {\n            const $removed = $el.nextUntil(':not([data-' + id + '])').remove();\n            $dummyOldDiv.append($removed);\n        } else {\n            id = random('repeat-');\n            $el.attr('data-' + templateIdAttr, id);\n        }\n\n        const { keyAlias, valueAlias } = aliasesFromTopics(topics, value);\n\n        const knownData = getKnownDataForEl($el);\n        const missingReferences = findMissingReferences(originalHTML, [keyAlias, valueAlias].concat(Object.keys(knownData)));\n        const stubbedTemplate = stubMissingReferences(originalHTML, missingReferences);\n\n        if (isEmpty(value)) {\n            $el.attr('hidden', true); //There's always going to be 1 el otherwise\n            return;\n        }\n\n        const templateFn = template(stubbedTemplate);\n        let last;\n        each(value, function (dataval, datakey) {\n            if (dataval === undefined || dataval === null) {\n                dataval = dataval + ''; //convert undefineds to strings\n            }\n            const templateData = $.extend(true, {}, knownData, {\n                [keyAlias]: datakey,\n                [valueAlias]: dataval\n            });\n\n            let nodes;\n            let isTemplated;\n            try {\n                const templated = templateFn(templateData);\n                const templatedWithReferences = addBackMissingReferences(templated, missingReferences);\n                isTemplated = templatedWithReferences !== stubbedTemplate;\n                nodes = $(templatedWithReferences);\n            } catch (e) { //you don't have all the references you need;\n                nodes = $(stubbedTemplate);\n                isTemplated = true;\n                updateKnownDataForEl($(nodes), templateData);\n            }\n\n            var hasData = (dataval !== null && dataval !== undefined);\n            nodes.each(function (i, newNode) {\n                const $newNode = $(newNode);\n                $newNode.removeAttr('data-f-repeat').removeAttr('data-' + templateIdAttr);\n                each($newNode.data(), function (val, key) {\n                    if (!last) {\n                        $el.data(key, toImplicitType(val));\n                    } else {\n                        $newNode.data(key, toImplicitType(val));\n                    }\n                });\n                $newNode.attr('data-' + id, true);\n                if (!isTemplated && !$newNode.children().length && hasData) {\n                    $newNode.html(dataval + '');\n                }\n            });\n            if (!last) {\n                last = $el.html(nodes.html());\n            } else {\n                last = nodes.insertAfter(last);\n            }\n        });\n\n        const $newEls = $el.nextUntil(`:not('[data-${id}]')`);\n\n        const el = $el.get(0);\n        const isInitialAnim = !elAnimatedMap.get(el);\n        addChangeClassesToList($dummyOldDiv.children(), $newEls, isInitialAnim, animation);\n\n        elAnimatedMap.set(el, true);\n    }\n};\n\nexport default loopAttrHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/loop-attrs/repeat-attr/index.js","import { promisify } from './promise-utils';\n\nfunction executeAndResolve(fn, args, $def) {\n    const promisifiedFn = promisify(fn);\n    return promisifiedFn.apply(fn, args).then((result)=> {\n        $def.resolve(result);\n    }, (e)=> {\n        $def.reject(e);\n    });\n}\n\n/**\n * Returns debounced version of original (optionally promise returning) function\n * \n * @param {function(*):Promise} fn function to debounce\n * @param {number} debounceInterval \n * @param {Function[]} [argumentsReducers] pass in 1 reducer for each option your function takes\n * @returns {Function} debounced function\n */\nexport default function debounceAndMerge(fn, debounceInterval, argumentsReducers) {\n    if (!argumentsReducers) {\n        var arrayReducer = function (accum, newVal) {\n            return (accum || []).concat(newVal);\n        };\n        argumentsReducers = [arrayReducer];\n    }\n\n    const queue = [];\n    let timer = null;\n\n    function mergeArgs(oldArgs, newArgs) {\n        const merged = newArgs.map(function (newArg, index) {\n            var reducer = argumentsReducers[index];\n            if (reducer) {\n                return reducer(oldArgs[index], newArg);\n            }\n            return newArg;\n        });\n        return merged;\n    }\n\n    /**\n     * @returns {Promise}\n     */\n    return function debouncedFunction() {\n        const newArgs = Array.prototype.slice.call(arguments);\n        if (timer) {\n            clearTimeout(timer);\n            const mergedArgs = mergeArgs(queue[0].args, newArgs);\n            queue[0].args = mergedArgs;\n        } else {\n            const args = mergeArgs([], newArgs);\n            queue.push({\n                $def: $.Deferred(),\n                args: args\n            });\n        }\n\n        timer = setTimeout(()=> {\n            timer = null;\n            const item = queue.pop();\n            executeAndResolve(fn, item.args, item.$def);\n        }, debounceInterval);\n\n        return queue[0].$def.promise();\n    };\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/general/debounce-and-merge.js","import { isNumber } from 'lodash';\n\nconst elClassesMap = new WeakMap();\nfunction deleteAddedClasses($el) {\n    const el = $el.get(0);\n    const addedClasses = elClassesMap.get(el);\n    if (addedClasses) {\n        $el.removeClass(addedClasses);\n    }\n}\n/**\n * @type AttributeHandler\n */\nconst classAttr = {\n    test: 'class',\n\n    target: '*',\n\n\n    unbind: function (attr, $el) {\n        const el = $el.get(0);\n        deleteAddedClasses($el);\n        elClassesMap.delete(el);\n    },\n\n    handle: function (value, prop, $el) {\n        if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n\n        const el = $el.get(0);\n        deleteAddedClasses($el);\n\n        if (isNumber(value)) {\n            value = 'value-' + value;\n        }\n        setTimeout(()=> {\n            $el.addClass(value); //If the classes have an animation set, removing with a timeout will trigger it\n        }, 0);\n        elClassesMap.set(el, value);\n    }\n};\n\nexport default classAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/class-attr/index.js","/**\n * @type AttributeHandler \n */\nconst booleanAttrHandler = {\n    target: '*',\n\n    test: /^(?:checked|selected|async|autofocus|autoplay|controls|defer|ismap|loop|multiple|open|required|scoped|disabled|hidden|readonly)$/i,\n\n    handle: function (value, prop, $el) {\n        if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        const val = ($el.attr('value')) ? (value == $el.prop('value')) : !!value; //eslint-disable-line eqeqeq\n        $el.prop(prop, val);\n    }\n};\n\nexport default booleanAttrHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/boolean-attr/index.js","/**\n  * @type AttributeHandler\n  */\nconst showifHandler = {\n    test: 'showif',\n\n    target: '*',\n\n    init: function (attr, value, $el) {\n        $el.hide(); //hide by default; if not this shows text until data is fetched\n    },\n\n    handle: function (value, prop, $el) {\n        if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        return (value && `${value}`.trim()) ? $el.show() : $el.hide();\n    }\n};\n\nexport default showifHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/toggles/show-if-attr/index.js","/**\n  * @type AttributeHandler\n  */\nconst hideifHandler = {\n    test: 'hideif',\n\n    target: '*',\n\n    init: function (attr, value, $el) {\n        $el.hide(); //hide by default; if not this shows text until data is fetched\n    },\n    handle: function (value, prop, $el) {\n        if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        if (value && `${value}`.trim()) {\n            $el.hide();\n        } else {\n            $el.show();\n        }\n    }\n};\n\nexport default hideifHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/toggles/hide-if-attr/index.js","/**\n  * @type {AttributeHandler}\n  */\nconst checkboxAttrHandler = {\n\n    target: ':checkbox,:radio',\n\n    test: 'bind',\n\n    handle: function (value, prop, $el) {\n        if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        const settableValue = $el.attr('value'); //initial value\n        const isChecked = (typeof settableValue !== 'undefined') ? (settableValue == value) : !!value; //eslint-disable-line eqeqeq\n        $el.prop('checked', isChecked);\n    }\n};\n\nexport default checkboxAttrHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/binds/checkbox-radio-bind-attr/index.js","/**\n * @type AttributeHandler \n */\nconst inputBindAttr = {\n    target: 'input, select, textarea',\n\n    test: 'bind',\n\n    handle: function (value, prop, $el) {\n        if ($el.is(':focus')) {\n            return; //If an user is actively typing in a value, don't overwrite it\n        }\n        if (value === undefined) {\n            value = '';\n        } else if (Array.isArray(value)) {\n            value = value[value.length - 1];\n        }\n        $el.val(value + '');\n    }\n};\n\nexport default inputBindAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/binds/input-bind-attr/index.js","import { template } from 'lodash';\nimport { addContentAndAnimate } from 'utils/animation';\nimport { animation } from 'config';\n\nimport { extractVariableName, extractAlias, translateDataToTemplatable, translateDataToInsertable } from '../bind-utils';\n\nimport { getKnownDataForEl, updateKnownDataForEl, removeKnownData, findMissingReferences, stubMissingReferences, addBackMissingReferences, isTemplated, getOriginalContents, clearOriginalContents } from 'dom/attribute-manager/attr-template-utils';\n\nconst elAnimatedMap = new WeakMap(); //TODO: Can probably get rid of this if we make subscribe a promise and distinguish between initial value\n\nfunction toAliasMap(topics) {\n    return (topics || []).reduce((accum, topic)=> {\n        accum[topic.name] = topic.alias;   \n        return accum;\n    }, {});\n}\n\nfunction getNewContent(currentContents, value, $el, topics) {\n    if (!isTemplated(currentContents)) {\n        return translateDataToInsertable(value);\n    }\n\n    const templateData = translateDataToTemplatable(value, toAliasMap(topics));\n    const knownData = getKnownDataForEl($el);\n    $.extend(templateData, knownData);\n\n    const missingReferences = findMissingReferences(currentContents, Object.keys(templateData));\n    const stubbedTemplate = stubMissingReferences(currentContents, missingReferences);\n\n    const templateFn = template(stubbedTemplate);\n    try {\n        const templatedHTML = templateFn(templateData);\n        const templatedWithReferences = addBackMissingReferences(templatedHTML, missingReferences);\n        return templatedWithReferences;\n    } catch (e) { //you don't have all the references you need;\n        updateKnownDataForEl($el, templateData);\n        return currentContents;\n    }\n}\n\n/**\n * @type AttributeHandler \n */\nconst bindAttrHandler = {\n\n    target: '*',\n\n    test: 'bind',\n\n    parse: function (topics) {\n        return topics.map((topic)=> {\n            const attrVal = topic.name;\n            return {\n                name: extractVariableName(attrVal),\n                alias: extractAlias(attrVal),\n            };\n        });\n    },\n\n    //FIXME: Can't do this because if you have a bind within a foreach, foreach overwrites the old el with a new el, and at that points contents are lost\n    // But if i don't do this the <%= %> is going to show up\n    // init: function (attr, value, $el) {\n    //     const contents = getOriginalContents($el, ($el)=> $el.html());\n    //     if (isTemplated(contents)) {\n    //         $el.empty();\n    //     }\n    // },\n\n    unbind: function (attr, $el) {\n        const el = $el.get(0);\n        elAnimatedMap.delete(el);\n\n        const bindTemplate = getOriginalContents($el);\n        const current = $el.html();\n        if (bindTemplate && current !== bindTemplate) {\n            $el.html(bindTemplate);\n        }\n        clearOriginalContents($el);\n        removeKnownData($el);\n    },\n\n    handle: function (value, prop, $el, topics) {\n        const el = $el.get(0);\n        const originalContents = getOriginalContents($el, ($el)=> $el.html());\n        const contents = getNewContent(originalContents, value, $el, topics);\n\n        addContentAndAnimate($el, contents, !elAnimatedMap.has(el), animation);\n        elAnimatedMap.set(el, true);\n    }\n};\n\nexport default bindAttrHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/binds/default-bind-attr/index.js","export function translateDataToInsertable(value) {\n    if (Array.isArray(value)) {\n        value = value[value.length - 1];\n    }\n    value = ($.isPlainObject(value)) ? JSON.stringify(value) : value + '';\n    return value;\n}\n\n/**\n * @param {any} value\n * @param {Object} aliasMap\n * @returns {{value: any}}\n */\nexport function translateDataToTemplatable(value, aliasMap) {\n    const templateData = { value: value };\n    if ($.isPlainObject(value)) {\n        Object.keys(value).forEach((originalName)=> {\n            const alias = aliasMap[originalName] || originalName;\n            templateData[alias] = value[originalName];\n        });\n    } else {\n        Object.keys(aliasMap).forEach((originalName)=> {\n            const alias = aliasMap[originalName] || originalName;\n            templateData[alias] = value;\n        });\n    }\n    \n    return templateData;\n}\n\nconst AS_REGEX = /(.*) (?:as)\\s+\\((.*)\\)/;\n\n/**\n * @param {string} attrVal \n * @returns {string}\n */\nexport function extractVariableName(attrVal) {\n    const asMatch = attrVal.trim().match(AS_REGEX);\n    const varName = asMatch && asMatch[1] ? asMatch[1] : attrVal;\n    return varName.trim();\n}\n\n/**\n * @param {string} attrVal \n * @returns {string}\n */\nexport function extractAlias(attrVal) {\n    const asMatch = attrVal.trim().match(AS_REGEX);\n    const alias = asMatch && asMatch[2] ? asMatch[2] : attrVal;\n    return alias.trim();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/binds/bind-utils/index.js","/**\n * @type AttributeHandler \n */\nconst defaultAttr = {\n    test: '*',\n\n    target: '*',\n\n    handle: function (value, prop, $el) {\n        //FIXME: The _right_ way to do this would be to set attr, not prop. \n        //However Polymer 1.0 doesn't link attrs with stringified JSON, and that's really the primary use-case for this, so, ignoring\n        //However Polymer is fine with 'data-X' attrs having stringified JSON. Eventually we should make this attr and fix polymer\n        //but can't do that for backwards comptability reason. See commit bbc4a49039fb73faf1ef591a07b371d7d667cf57\n        $el.prop(prop, value);\n    }\n};\n\nexport default defaultAttr;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/attribute-manager/attributes/default-attr/index.js","/**\n * Hooks up dom elements to mutation observer\n * @param  {HTMLElement} target     root to start observing from\n * @param  {Object} domManager \n * @param  {boolean} isEnabled Determines if it's enabled by default\n * @returns {Object}\n */\nexport default function (target, domManager, isEnabled) {\n    if (typeof MutationObserver === 'undefined') {\n        return;\n    }\n    // Create an observer instance\n    var observer = new MutationObserver(function (mutations) {\n        mutations.forEach(function (mutation) {\n            var added = $(mutation.addedNodes).find(':f');\n            added = added.add($(mutation.addedNodes).filter(':f'));\n            var removed = $(mutation.removedNodes).find(':f');\n            removed = removed.add($(mutation.removedNodes).filter(':f'));\n            if (added && added.length) {\n                domManager.bindAll(added);\n            }\n            if (removed && removed.length) {\n                domManager.unbindAll(removed);\n            }\n            if (mutation.attributeName === 'data-f-channel') {\n                domManager.unbindAll(mutation.target);\n                domManager.bindAll(mutation.target);\n            }\n        });\n    });\n    var mutconfig = {\n        attributes: true,\n        attributeFilter: ['data-f-channel'],\n        childList: true,\n        subtree: true,\n        characterData: false\n    };\n    var publicApi = {\n        enable: function () {\n            observer.observe(target, mutconfig);\n        },\n        disable: function () {\n            observer.disconnect();\n        }\n    };\n    if (isEnabled) {\n        publicApi.enable();\n    }\n    return publicApi;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom/plugins/auto-update-bindings.js","import DefaultChannelManager from './channel-manager';\n\nimport router from 'channels/channel-router';\nimport { JSONRouteHandler, EpicenterRouteHandler, DomRouteHandler } from './route-handlers';\nimport { interpolatable, routable } from './channel-manager-enhancements';\n\n//Moving connecting glue here so channel-manager can be tested in isolation\nconst InterpolatableRoutableChannelManager = interpolatable(routable(DefaultChannelManager, router));\nexport default function ChannelManager(opts) {\n    const defaultRouteHandlers = [JSONRouteHandler, DomRouteHandler, EpicenterRouteHandler];\n    const routes = opts && opts.routes ? opts.routes : [];\n    const cm = new InterpolatableRoutableChannelManager($.extend(true, {}, {\n        routes: [].concat(routes, defaultRouteHandlers)\n    }, opts));\n    return cm;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/configured-channel-manager.js","import $ from 'jquery';\nimport { normalizeParamOptions, publishableToObject } from './channel-utils';\nimport { uniqueId, isFunction, intersection, uniq } from 'lodash';\n/**\n * \n * @param {Array<string>|string} topics \n * @param {Function} callback \n * @param {Object} options\n * @returns {Subscription}\n */\nfunction makeSubs(topics, callback, options) {\n    const id = uniqueId('subs-');\n    const defaults = {\n        /**\n         * Determines if the callback function is called per item or per subscription.\n         *\n         * If `false`, the callback function is called once for each item to which you are subscribing. If `true`, the callback function is called only once, no matter how many items you have subscribed to. Defaults to `false`.\n         * @type {Boolean}\n         */\n        batch: false,\n\n\n        /**\n         * Determines if the last published data should be cached for future notifications. For example:\n         *\n         *      channel.subscribe(['price', 'cost'], callback1, { batch: true, cache: false });\n         *      channel.subscribe(['price', 'cost'], callback2, { batch: true, cache: true });\n         *\n         *      channel.publish({ 'price': 1 });\n         *      channel.publish({ 'cost': 1 });\n         *\n         * Here, `callback2` is called once, and `callback1` is not called: The channel caches the first publish value and notifies after all dependent topics have data.\n         *\n         * If the `publish()` call was instead:\n         *\n         *      channel.publish({ price: 1, cost: 1 })\n         *\n         * Then both `callback1` and `callback2` are called.\n         *\n         * Setting `cache: true` is useful if you know if your topics will be published individually, but you still want to handle them together. As a concrete example, consider a slider with a chart: the input values, determined by the slider, should not cause the chart to redraw immediately. The chart could wait until all sliders have been updated a checkbox is checked, for example.\n         * Setting `cache: false` is useful if you know if your topics will *always* be published together and they'll be called at the same time.\n         *\n         * Note this has no discernible effect if `batch` is `false`. Additionally, this has no discernible effect if `variables` are \"noisy\" (`silent: true`).\n         * @type {Boolean}\n         */\n        cache: true,\n    };\n    const opts = $.extend({}, defaults, options);\n    if (!callback || !isFunction(callback)) {\n        throw new Error('subscribe callback should be a function');\n    }\n    return $.extend(true, {\n        id: id,\n        topics: [].concat(topics),\n        callback: callback,\n    }, opts);\n}\n\nlet cacheBySubsId = {};\nlet sentDataBySubsId = {};\n\nfunction copy(data) {\n    if (Array.isArray(data)) {\n        return data.map((d)=> copy(d));\n    } else if ($.isPlainObject(data)) {\n        return Object.keys(data).reduce((accum, key)=> {\n            accum[key] = copy(data[key]);\n            return accum;\n        }, {});\n    }\n    return data;\n}\n/**\n* @param {Subscription} subscription \n* @param {*} data\n*/\nfunction callbackSubscriber(subscription, data) {\n    const id = subscription.id;\n    subscription.callback(data, { id: id, previousData: sentDataBySubsId[id] });\n    sentDataBySubsId[id] = copy(data);\n}\n\n/**\n* @param {Publishable[]} topics\n* @param {Subscription} subscription \n*/\nfunction checkAndNotifyBatch(topics, subscription) {\n    const publishData = publishableToObject(topics);\n    const matchingTopics = intersection(Object.keys(publishData), subscription.topics);\n    if (!matchingTopics.length) {\n        return;\n    }\n\n    const relevantDataFromPublish = matchingTopics.reduce((accum, topic)=> {\n        accum[topic] = publishData[topic];\n        return accum;\n    }, {});\n    const cachedDataForSubs = cacheBySubsId[subscription.id] || {};\n    const knownDataForSubs = $.extend({}, cachedDataForSubs, relevantDataFromPublish);//jQ Deep clone here will also concat arrays.\n\n    if (subscription.cache) {\n        cacheBySubsId[subscription.id] = knownDataForSubs;\n    }\n    const hasDataForAllTopics = intersection(Object.keys(knownDataForSubs), subscription.topics).length === subscription.topics.length;\n    if (hasDataForAllTopics) {\n        callbackSubscriber(subscription, knownDataForSubs);\n    }\n}\n\n\n/**\n * @param {Publishable[]} topics\n * @param {Subscription} subscription \n */\nfunction checkAndNotify(topics, subscription) {\n    topics.forEach(function (topic) {\n        const needsThisTopic = subscription.topics.indexOf(topic.name) !== -1;\n        const isWildCard = subscription.topics.indexOf('*') !== -1;\n        if (needsThisTopic || isWildCard) {\n            callbackSubscriber(subscription, { [topic.name]: topic.value });\n        }\n    });\n}\n\n/**\n* @param {Subscription[]} subcriptionList\n* @returns {Array<string>}\n*/\nfunction getTopicsFromSubsList(subcriptionList) {\n    return subcriptionList.reduce(function (accum, subs) {\n        accum = accum.concat(subs.topics);\n        return accum;\n    }, []);\n}\n\n/**\n * @class ChannelManager\n */\nclass ChannelManager {\n    constructor(options) {\n        this.subscriptions = [];\n    }\n\n    /**\n     * Perform the action (for example, update the variables or call the operation), and alert subscribers.\n     *\n     * **Examples**\n     *\n     *      Flow.channel.publish('operations:myOperation', myOperParam);\n     *      Flow.channel.publish({ name: 'operations:operName', value: [operParam1, operParam2] });\n     *\n     *      Flow.channel.publish('variables:myVariable', newValue);\n     *      Flow.channel.publish({ myVar1: newVal1, myVar2: newVal2 });\n     *\n     * @param {string|Publishable} topic\n     * @param {any} [value] item to publish\n     * @param {PublishOptions} [options]\n     * @returns {Promise}\n     */\n    publish(topic, value, options) {\n        const normalized = normalizeParamOptions(topic, value, options);\n        let prom = $.Deferred().resolve(normalized.params).promise();\n        prom = prom.then((publishResponses)=> {\n            this.notify(publishResponses, options);\n            return publishResponses;\n        });\n        return prom;\n    }\n\n    /**\n     * Alert each subscriber about the operation and its parameters. This can be used to provide an update without a round trip to the server. However, it is rarely used: you almost always want to `subscribe()` instead so that the model is actually changed (has a variable update or an operation called).\n     *\n     * **Example**\n     *\n     *      Flow.channel.notify('variables:myVariable', newValue);\n     *      Flow.channel.notify('operations:myOperation', myOperParam);\n     *\n     * @param {string|Publishable} topic\n     * @param {any} [value] item to publish\n     * @param {PublishOptions} [options]\n     * @returns {void}\n     */\n    notify(topic, value, options) {\n        const normalized = normalizeParamOptions(topic, value, options);\n        // console.log('notify', normalized.params);\n        this.subscriptions.forEach(function (subs) {\n            const fn = subs.batch ? checkAndNotifyBatch : checkAndNotify;\n            fn(normalized.params, subs);\n        });\n    }\n\n    /**\n     * Subscribe to changes on a channel: Ask for notification when variables are updated, or when operations are called.\n     *\n     * **Examples**\n     *       Flow.channel.subscribe('variables:myVariable',\n     *          function() { console.log('updated!'); } );\n     *\n     *       Flow.channel.subscribe('operations:myOperation',\n     *          function() { console.log('called!'); } );\n     *\n     * @param {Array<string>|string} topics\n     * @param {Function} cb\n     * @param {Object} [options]\n     * @returns {string}\n     */\n    subscribe(topics, cb, options) {\n        const subs = makeSubs(topics, cb, options);\n        delete cacheBySubsId[subs.id]; //Just in case subsid is being reused\n        delete sentDataBySubsId[subs.id];\n        this.subscriptions = this.subscriptions.concat(subs);\n        return subs.id;\n    }\n        \n\n    /**\n     * Stop receiving notification when a variable is updated or an operation is called.\n     *\n     * @param {string} token The identifying token for this subscription. (Created and returned by the `subscribe()` call.)\n     */\n    unsubscribe(token) {\n        const olderLength = this.subscriptions.length;\n        const remaining = this.subscriptions.filter(function (subs) {\n            return subs.id !== token;\n        });\n        if (remaining.length === olderLength) {\n            throw new Error('No subscription found for token ' + token);\n        }\n        delete cacheBySubsId[token];\n        delete sentDataBySubsId[token];\n        this.subscriptions = remaining;\n    }\n\n    /**\n     * Stop receiving notifications for all operations. No parameters.\n     *\n     * @returns {void} No return value.\n     */ \n    unsubscribeAll() {\n        cacheBySubsId = {};\n        sentDataBySubsId = {};\n        this.subscriptions = [];\n    }\n\n    /**\n     * View all topics currently subscribed to for this channel.\n     * @returns {Array<string>} List of topics. \n     */\n    getSubscribedTopics() {\n        const list = uniq(getTopicsFromSubsList(this.subscriptions));\n        return list;\n    }\n\n    /**\n     *  View everything currently subscribed to this topic.\n     * \n     * @param {string} [topic] topic to filter by\n     * @returns {Subscription[]}\n     */\n    getSubscribers(topic) {\n        if (!topic) {\n            return this.subscriptions;\n        }\n        return this.subscriptions.filter(function (subs) {\n            return subs.topics.indexOf(topic) !== -1;\n        });\n    }\n}\n\nexport default ChannelManager;\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager.js","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 54\n// module chunks = 0","import _ from 'lodash';\n\n/**\n * @param {string} topic\n * @param {Handler[]} handlers\n * @param {any} [matchOptions] options to pass on to matcher\n * @returns {Handler | undefined}\n */\nexport function findBestHandler(topic, handlers, matchOptions) {\n    for (var i = 0; i < handlers.length; i++) {\n        var thishandler = handlers[i];\n        var match = thishandler.match(topic, matchOptions);\n        if (match !== false) {\n            return $.extend(true, {}, thishandler, { matched: match });\n        }\n    }\n    return undefined;\n}\n\n/**\n * [groupByHandlers description]\n * @param  {Array<string>} topics   List of topics to match. Format can be anything your handler.match function handles\n * @param  {Handler[]} handlers Handlers of type [{ match: func }]\n * @returns {HandlerWithTopics[]} The handler array with each item now having an additional 'data' attr added to it with the matching topics\n */\nexport function groupByHandlers(topics, handlers) {\n    handlers = handlers.map(function (h, index) {\n        h.key = index;\n        return h;\n    });\n    var topicMapping = ([].concat(topics)).reduce(function (accum, topic) {\n        var bestHandler = findBestHandler(topic, handlers);\n        if (bestHandler) {\n            //if handler matches different strings treat both as different handlers\n            var key = bestHandler.key + bestHandler.matched;\n            if (!accum[key]) {\n                bestHandler.data = [];\n                accum[key] = bestHandler;\n            }\n            accum[key].data.push(topic);\n        }\n        return accum;\n    }, {});\n    return _.values(topicMapping);\n}\n\n/**\n * Takes a `publish` dataset and groups it by handler maintaining the data sequence\n * @param  {Publishable[]} data     Of the form [{ name: 'X', }]\n * @param  {Handler[]} handlers Handlers of type [{ match: func }]\n * @returns {HandlerWithData[]} The handler array with each item now having an additional 'data' attr added to it with the publishable data\n */\nexport function groupSequentiallyByHandlers(data, handlers) {\n    handlers = handlers.map(function (h, index) {\n        h.key = index;\n        return h;\n    });\n    var grouped = data.reduce(function (accum, dataPt) {\n        var lastHandler = accum[accum.length - 1];\n        var bestHandler = findBestHandler(dataPt.name, handlers, true);\n        if (bestHandler) {\n            if (lastHandler && bestHandler.key === lastHandler.key) {\n                lastHandler.data.push(dataPt);\n            } else {\n                accum.push($.extend({}, bestHandler, { data: [dataPt] }));\n            }\n        } else {\n            accum.push({ data: [dataPt], matched: false });\n        }\n        return accum;\n    }, []);\n    return grouped;\n}\n\n\n/**\n * @param {any} response \n * @param {string[]} topics \n * @returns {Publishable[]}\n */\nexport function normalizeSubscribeResponse(response, topics) {\n    // @ts-ignore\n    if (response === undefined) {\n        return [];\n    }\n    const isAlreadyInPublishableFormat = Array.isArray(response) && (!response.length || response[0].name !== undefined);\n    if (isAlreadyInPublishableFormat) {\n        return response; \n    }\n    if (typeof response === 'object' && !Array.isArray(response)) {\n        return topics.reduce((accum, t)=> {\n            accum.push({ name: t, value: response[t] });\n            return accum; \n        }, []);\n    }\n    if (topics.length === 1) { //it's not in a publishable format, so someone just returned a string or something\n        const name = topics[0];\n        return [{ name: name, value: response }];\n    }\n    throw new Error('unrecognized subscribe response format');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-router/utils/handler-utils.js","/**\n * @param {Publishable[]} published \n * @param {boolean|Array<string>|{except: Array<string>}} [silentOptions]\n * @returns {Publishable[]} filtered list\n */\nexport default function silencable(published, silentOptions) {\n    if (silentOptions === true || !published) {\n        return [];\n    } else if (Array.isArray(silentOptions)) {\n        return published.filter((data)=> {\n            const found = silentOptions.indexOf(data.name) !== -1;\n            return !found;\n        });\n    } else if (silentOptions && silentOptions.except) {\n        return published.filter((data)=> {\n            const found = (silentOptions.except || []).indexOf(data.name) !== -1;\n            return found;\n        });\n    }\n    return published;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-router/utils/silencable.js","import { isFunction } from 'lodash';\n\n/**\n * \n * @param {Publishable[]} publishable \n * @param {boolean|string[]|Function} readOnlyOptions \n * @returns {Publishable[]} filtered list\n */\nexport default function excludeReadOnly(publishable, readOnlyOptions) {\n    if (isFunction(readOnlyOptions)) {\n        readOnlyOptions = readOnlyOptions();\n    }\n    if (readOnlyOptions === true) {\n        console.error('Tried to publish to a readonly channel', publishable);\n        return [];\n    }  \n    if (Array.isArray(readOnlyOptions)) {\n        const split = publishable.reduce((accum, data)=> {\n            const isReadonly = readOnlyOptions.indexOf(data.name) !== -1;\n            if (isReadonly) {\n                accum.readOnly.push(data);\n            } else {\n                accum.remaining.push(data);\n            }\n            return accum;\n        }, { readOnly: [], remaining: [] });\n        \n        if (split.readOnly.length) {\n            console.warn('Ignoring readonly publishes', split.readOnly);\n        }\n        return split.remaining;\n    }\n    return publishable;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-router/utils/exclude-read-only.js","export { default as JSONRouteHandler } from './json-route-handler';\nexport { default as EpicenterRouteHandler } from './epicenter-route-handlers';\nexport { default as DomRouteHandler } from './dom-route-handler';\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/index.js","import { toImplicitType } from 'utils/parse-utils';\n\nexport function match(topic) {\n    var parsed = toImplicitType(topic);\n    return typeof parsed !== 'string' ? '' : false;\n}\n\nexport default {\n    match: match,\n    name: 'JSON Route',\n    subscribeHandler: function (topics) {\n        const parsed = topics.map((t)=> {\n            return {\n                name: t,\n                value: toImplicitType(t)\n            };\n        });\n        return parsed;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/json-route-handler/index.js","import DefaultRunRouteHandler from './default-run-route-handler';\nimport ScenarioRouteHandler from './scenario-route-handler';\nimport RunidRouteHandler from './runid-route-handler';\nimport WorldRouteHandler from './world-route-handler';\n\nimport MultiRunRouteHandler from './multi-run-route-handler';\n\n\nimport { withPrefix } from 'channels/channel-router/utils';\nimport { matchPrefix, matchDefaultPrefix, matchRegex } from 'channels/route-handlers/route-matchers';\n\nimport router from 'channels/channel-router';\n\nfunction getOptions(opts, key) {\n    var serviceOptions = $.extend(true, {}, opts.defaults, opts[key]);\n    var channelOptions = $.extend(true, {}, serviceOptions.channelOptions);\n    delete serviceOptions.channelOptions;\n\n    return { serviceOptions: serviceOptions, channelOptions: channelOptions };\n}\n\nvar SCENARIO_PREFIX = 'sm:';\nvar RUN_PREFIX = 'rm:';\nconst WORLD_PREFIX = 'world:';\n\nvar sampleRunidLength = '000001593dd81950d4ee4f3df14841769a0b'.length;\nvar runidRegex = '(?:.{' + sampleRunidLength + '})';\n\n/* eslint-disable complexity */\nexport default function EpicenterRouteHandler(config, notifier, channelManagerContext) {\n    var opts = $.extend(true, {}, config);\n\n    var runidHandlerOpts = getOptions(opts, 'runid');\n    var runidHandler = new RunidRouteHandler(runidHandlerOpts, notifier);\n    var multiRunHandler = new MultiRunRouteHandler(runidHandlerOpts, withPrefix(notifier, 'runs'), channelManagerContext);\n    // var userChannel = new UserRouter(getOptions(opts, 'runManager').run, withPrefix(notifier, 'user:'), channelManagerContext);\n    \n    /** @type {Handler[]} **/\n    var handlers = [\n        $.extend({}, runidHandler, { \n            name: 'customRun',\n            match: matchRegex(runidRegex),\n            options: runidHandlerOpts.channelOptions,\n        }), \n        $.extend({}, multiRunHandler, {\n            name: 'archiveRuns',\n            match: matchPrefix('runs:'),\n            options: runidHandlerOpts.channelOptions,\n        }),  \n        // $.extend({}, userChannel, {\n        //     name: 'User Channel',\n        //     match: matchPrefix('user:'),\n        // })\n    ];\n    var exposable = {};\n\n    var runManagerOpts = getOptions(opts, 'runManager');\n    if (opts.runManager || (!opts.scenarioManager && runManagerOpts.serviceOptions.run)) {\n        var rm;\n        const hasEnoughInfo = runManagerOpts.serviceOptions.run && runManagerOpts.serviceOptions.run.model;\n        const isMultiplayer = runManagerOpts.serviceOptions.strategy === 'multiplayer' || runManagerOpts.serviceOptions.isMultiplayer;\n        \n        if (!hasEnoughInfo) {\n            console.warn('No model specified, not initializing run manager channel', opts);\n            rm = { expose: {} };\n        } else if (opts.scenarioManager) {\n            rm = new DefaultRunRouteHandler(runManagerOpts, withPrefix(notifier, RUN_PREFIX));\n            handlers.push($.extend({}, rm, { \n                name: 'run',\n                match: matchPrefix(RUN_PREFIX), //if both scenario manager and run manager are being used, require a prefix\n                options: runManagerOpts.channelOptions,\n            }));\n        } else if (isMultiplayer) {\n            //Ignore case where both scenario manager and multiplayer are being used\n            rm = new WorldRouteHandler(runManagerOpts, withPrefix(notifier, [WORLD_PREFIX, '']));\n            handlers.push($.extend({}, rm, { \n                name: 'World run',\n                match: matchDefaultPrefix(WORLD_PREFIX),\n                isDefault: true,\n                options: runManagerOpts.channelOptions,\n            }));\n        } else {\n            rm = new DefaultRunRouteHandler(runManagerOpts, withPrefix(notifier, [RUN_PREFIX, '']));\n            handlers.push($.extend({}, rm, { \n                name: 'run',\n                match: matchDefaultPrefix(RUN_PREFIX),\n                isDefault: true,\n                options: runManagerOpts.channelOptions,\n            }));\n        }\n\n        $.extend(exposable, rm.expose);\n    }\n\n    if (opts.scenarioManager) {\n        var scenarioManagerOpts = getOptions(opts, 'scenarioManager');\n        var sm = new ScenarioRouteHandler(scenarioManagerOpts, withPrefix(notifier, [SCENARIO_PREFIX, '']));\n        handlers.push($.extend({}, sm, { \n            name: 'scenario',\n            match: matchDefaultPrefix(SCENARIO_PREFIX),\n            options: scenarioManagerOpts.channelOptions,\n            isDefault: true,\n        }));\n\n        $.extend(exposable, sm.expose);\n    }\n\n    var epicenterRouter = router(handlers, notifier);\n    epicenterRouter.expose = exposable;\n    \n    return epicenterRouter;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/index.js","import RunRouteHandler from '../run-route-handler';\n\nimport { withPrefix } from 'channels/channel-router/utils';\nimport router from 'channels/channel-router';\nimport { matchDefaultPrefix } from 'channels/route-handlers/route-matchers';\n\nconst { F } = window;\n\nconst RUN_PREFIX = 'current:';\n\nexport default function RunManagerRouteHandler(config, notifier) {\n    const defaults = {\n        serviceOptions: {},\n        channelOptions: {}\n    };\n    const opts = $.extend(true, {}, defaults, config);\n\n    const rmOptions = opts.serviceOptions;\n    const rm = new F.manager.RunManager(rmOptions);\n\n    const $creationPromise = rm.getRun().then((run)=> {\n        return rm.run;\n    });\n    const currentChannelOpts = $.extend(true, \n        { serviceOptions: $creationPromise, channelOptions: opts.channelOptions }, opts.defaults, opts.current);\n    const currentRunChannel = new RunRouteHandler(currentChannelOpts, withPrefix(notifier, [RUN_PREFIX, '']));\n\n    const runRouteHandler = $.extend(currentRunChannel, { \n        match: matchDefaultPrefix(RUN_PREFIX), //TODO: Just remove prefix?\n        name: 'Current Run',\n        isDefault: true,\n        options: currentChannelOpts.channelOptions,\n    });\n    const handlers = [\n        runRouteHandler\n    ];\n\n    const runMangerRouter = router(handlers);\n    runMangerRouter.expose = { runManager: rm };\n\n    return runMangerRouter;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/default-run-route-handler/index.js","import { objectToPublishable, publishableToObject } from 'channels/channel-utils';\nimport { intersection } from 'lodash';\n\nexport default function RunMetaRouteHandler($runServicePromise, notifier) {\n\n    function mergeAndSend(runMeta, requestedTopics) {\n        var toSend = ([].concat(requestedTopics)).reduce(function (accum, meta) {\n            accum.push({ name: meta, value: runMeta[meta] });\n            return accum;\n        }, []);\n        return toSend;\n        // return notifier(toSend);\n    }\n    return {\n        subscribeHandler: function (topics, options) {\n            topics = [].concat(topics);\n            \n            return $runServicePromise.then(function (runService) {\n                var cachedValues = intersection(Object.keys(runService.runMeta || {}), topics);\n                if (options.autoFetch === false) {\n                    return $.Deferred().resolve({}).promise();\n                } else if (cachedValues.length === topics.length) {\n                    //FIXME: Add 'updated time' to meta, and fetch if that's < debounce interval -- use the custom debounce fn with the custom merge (debounce save as well?)\n                    //Make run service factory return patched run-service?\n                    return $.Deferred().resolve(mergeAndSend(runService.runMeta, topics)).promise();\n                } if (!runService.loadPromise) {\n                    runService.loadPromise = runService.load().then(function (data) {\n                        runService.runMeta = data;\n                        return data;\n                    });\n                } \n                return runService.loadPromise.then(function (data) {\n                    return mergeAndSend(data, topics);\n                });\n            });\n        },\n        publishHandler: function (topics, options) {\n            return $runServicePromise.then(function (runService) {\n                var toSave = publishableToObject(topics);\n                return runService.save(toSave).then(function (res) {\n                    runService.runMeta = $.extend({}, true, runService.runMeta, res);\n                    return objectToPublishable(res);\n                });\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-meta-route-handler/index.js","import { debounceAndMerge } from 'utils/general';\nimport { objectToPublishable, publishableToObject } from 'channels/channel-utils';\nimport { uniqueId, uniq, difference } from 'lodash';\nimport { retriableFetch } from './retriable-variable-fetch';\n// import { optimizedFetch } from './optimized-variables-fetch';\n\nfunction mergeVariables(accum, newval) {\n    if (!accum) {\n        accum = [];\n    }\n    const merged = uniq(accum.concat(newval)).filter((v)=> !!(v && v.trim()));\n    // console.log(merged, 'merged');\n    return merged;\n}\n\nexport default function RunVariablesRouteHandler($runServicePromise, notifier) {\n    const id = uniqueId('variable-route-handler');\n\n    function debouncedVariableQuery(runService, debounceInterval) {\n        if (!runService.debouncedFetchers) {\n            runService.debouncedFetchers = {};\n        }\n        if (!runService.debouncedFetchers[id]) {\n            runService.debouncedFetchers[id] = debounceAndMerge(function (variables) {\n                return retriableFetch(runService, variables);\n            }, debounceInterval, [mergeVariables]);\n        }\n        return runService.debouncedFetchers[id];\n    }\n\n    let knownTopics = [];\n    return { \n        /**\n         * @param {{exclude:? boolean}} options \n         * @returns {Promise}\n         */\n        fetch: function (options) {\n            const opts = $.extend({ exclude: [] }, options);\n            return $runServicePromise.then(function (runService) {\n                const variablesToFetch = difference([].concat(knownTopics), opts.exclude);\n                if (!variablesToFetch.length) {\n                    return [];\n                }\n                return retriableFetch(runService, [].concat(variablesToFetch)).then(objectToPublishable).then(notifier);\n            });\n        },\n\n        unsubscribeHandler: function (unsubscribedTopics, remainingTopics) {\n            knownTopics = knownTopics.filter((t)=> {\n                const isUnsubscribed = unsubscribedTopics.indexOf(t) !== -1;\n                const isRemaining = remainingTopics.indexOf(t) !== -1;\n                return !isUnsubscribed || isRemaining;\n            });\n        },\n        subscribeHandler: function (topics, options) {\n            // console.log('subscribe', JSON.stringify(topics));\n            const isAutoFetchEnabled = options.autoFetch;\n            const debounceInterval = options.debounce;\n\n            return $runServicePromise.then(function (runService) {\n                knownTopics = uniq(knownTopics.concat(topics));\n                if (!knownTopics.length) {\n                    return $.Deferred().resolve([]).promise();\n                } else if (!isAutoFetchEnabled) {\n                    return $.Deferred().resolve(topics).promise();\n                }\n                return debouncedVariableQuery(runService, debounceInterval)(topics).then((response)=> {\n                    const missingVariables = difference(topics, Object.keys(response));\n                    if (missingVariables.length) {\n                        return $.Deferred().reject({\n                            context: missingVariables,\n                            message: `Missing variables: ${missingVariables.join(',')}`\n                        }).promise();\n                    }\n                    return response;\n                });\n            });\n        },\n        /**\n         * \n         * @param {Publishable[]} variableData\n         */\n        notify: function (variableData) {\n            return $runServicePromise.then(function (runService) {\n                const variables = variableData.map((v)=> v.name);\n                //Need to fetch again because for Vensim, i'm notified about the Current value, while i need the value over time\n                return retriableFetch(runService, variables).then(objectToPublishable).then(notifier);\n            });\n        },\n        publishHandler: function (topics, options) {\n            return $runServicePromise.then(function (runService) {\n                const toSave = publishableToObject(topics);\n                return runService.variables().save(toSave).then(function (response) {\n                    const variables = Object.keys(toSave); \n                    //Get the latest from the server because what you think you saved may not be what was saved\n                    //bool -> 1, scalar to array for time-based models etc\n                    return retriableFetch(runService, variables).then(objectToPublishable);\n                });\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-variables-route-handler/index.js","//Opaquely handle missing variables\nexport function retriableFetch(runService, variables) {\n    if (!variables || !variables.length) {\n        return $.Deferred().resolve({}).promise();\n    }\n    return runService.variables().query(variables).catch((e)=> {\n        const response = e.responseJSON;\n        const info = response.information;\n        if (info.code !== 'VARIABLE_NOT_FOUND') {\n            throw e;\n        }\n        const goodVariables = variables.filter((vName)=> {\n            const baseName = vName.split('[')[0];\n            const isBad = info.context.names.indexOf(baseName) !== -1;\n            return !isBad;\n        });\n        return retriableFetch(runService, goodVariables);\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-variables-route-handler/retriable-variable-fetch.js","export default function RunOperationsRouteHandler($runServicePromise, notifier) {\n    return {\n        /**\n         * \n         * @param {Publishable[]} operationsResponse \n         */\n        notify: function (operationsResponse) {\n            return notifier([].concat(operationsResponse));\n        },\n\n        subscribeHandler: function () {\n            return []; //Cannot subscribe to operations\n        },\n        publishHandler: function (topics, options) {\n            return $runServicePromise.then(function (runService) {\n                const toSave = topics.map(function (topic) {\n                    return { name: topic.name, params: topic.value };\n                });\n                return runService.serial(toSave).then(function (result) {\n                    const toReturn = result.map(function (response, index) {\n                        return { name: topics[index].name, value: response.result };\n                    });\n                    return toReturn;\n                });\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-route-handler/run-operations-route-handler/index.js","import RunRouteHandler from '../run-route-handler';\nimport { withPrefix } from 'channels/channel-router/utils';\nimport router from 'channels/channel-router';\nimport { matchPrefix, matchDefaultPrefix, } from 'channels/route-handlers/route-matchers';\n\n\nexport default function ScenarioManagerRouteHandler(config, notifier) {\n    var defaults = {\n        serviceOptions: {},\n        channelOptions: {},\n    };\n    var opts = $.extend(true, {}, defaults, config);\n\n    var sm = new window.F.manager.ScenarioManager(opts.serviceOptions);\n\n    var baselinePromise = sm.baseline.getRun().then(()=> sm.baseline.run);\n    var baselineOptions = $.extend(true, {\n        serviceOptions: baselinePromise,\n        channelOptions: {\n            meta: {\n                readOnly: true\n            },\n            variables: {\n                readOnly: true\n            }\n        }\n    }, opts.defaults, opts.baseline);\n    var currentRunPromise = sm.current.getRun().then(()=> sm.current.run);\n\n    var runOptions = $.extend(true, {\n        serviceOptions: currentRunPromise,\n    }, opts.defaults, opts.current);\n\n    var baselineHandler = new RunRouteHandler(baselineOptions, withPrefix(notifier, 'baseline:'));\n    var currentRunHandler = new RunRouteHandler(runOptions, withPrefix(notifier, ['current:', '']));\n    var handlers = [\n        $.extend(baselineHandler, {\n            name: 'baseline',\n            match: matchPrefix('baseline:'),\n            options: baselineOptions.channelOptions,\n        }),\n        $.extend(currentRunHandler, { \n            isDefault: true, \n            name: 'current',\n            match: matchDefaultPrefix('current:'),\n            options: runOptions.channelOptions,\n        }),\n\n    ];\n    \n    var scenarioManagerRouter = router(handlers, notifier);\n    scenarioManagerRouter.expose = { scenarioManager: sm };\n    return scenarioManagerRouter;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/scenario-route-handler/index.js","import runChannelFactory from '../run-router-factory';\nimport { withPrefix, stripSuffixDelimiter } from 'channels/channel-router/utils';\n\nexport default function RunidRouteHandler(options, notifier) {\n    if (!options) options = {};\n\n    var opts = {};\n    opts.serviceOptions = options.serviceOptions && options.serviceOptions.run ? options.serviceOptions.run : {};\n    opts.channelOptions = options.channelOptions;\n\n    return {\n        subscribeHandler: function (topics, options, prefix) {\n            var runid = stripSuffixDelimiter(prefix);\n            //FIXME: Should i merge options here?\n            var channel = runChannelFactory(runid, opts, withPrefix(notifier, prefix));\n            return channel.subscribeHandler(topics, options, prefix);\n        },\n        publishHandler: function (topics, options, prefix) {\n            var runid = stripSuffixDelimiter(prefix);\n            var channel = runChannelFactory(runid, opts, withPrefix(notifier, prefix));\n            return channel.publishHandler(topics);\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/runid-route-handler/index.js","import RunRouteHandler from './run-route-handler';\nvar knownRunIDServiceChannels = {};\n\nexport default function (runid, options, notifier) {\n    var runChannel = knownRunIDServiceChannels[runid];\n    if (!runChannel) {\n        var runOptions = $.extend(true, {}, options, { serviceOptions: { id: runid } });\n        runChannel = new RunRouteHandler(runOptions, notifier);\n        knownRunIDServiceChannels[runid] = runChannel;\n    }\n    return runChannel;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/run-router-factory.js","import WorldUsersRouteHandler from './world-users-route-handler';\nimport WorldCurrentUserRouteHandler from './world-current-user-route-handler';\nimport ConsensusRouteHandler from './consensus-route-handler';\n\nimport { withPrefix } from 'channels/channel-router/utils';\nimport { matchPrefix, matchDefaultPrefix } from 'channels/route-handlers/route-matchers';\n\nimport RunRouteHandler from '../run-route-handler';\nimport router from 'channels/channel-router';\n\nconst { F } = window;\n\nconst RUN_PREFIX = 'run:';\nconst MULTI_USER_PREFIX = 'users:';\nconst USER_PREFIX = 'user:';\nconst CONSENSUS_PREFIX = 'consensus:';\n\n//TODO: Add custom worldid channel as well\nexport default function WorldRoutesHandler(config, notifier) {\n    const defaults = {\n        serviceOptions: {},\n        channelOptions: {}\n    };\n    const opts = $.extend(true, {}, defaults, config);\n\n    const rmOptions = opts.serviceOptions;\n    const rm = new F.manager.RunManager(rmOptions);\n    \n    let runPromise = null;\n    function getRun() {\n        if (!runPromise) {\n            runPromise = rm.getRun().then((run)=> {\n                if (!run.world) {\n                    console.error('No world found in run. Make sure you\\'re using EpicenterJS version > 2.7');\n                    throw new Error('Could not find world');\n                }\n                return run;\n            }, (err)=> {\n                console.error('Run manager get run error', err);\n                throw err;\n            });\n        }\n        return runPromise;\n    }\n    const $runPromise = getRun().then((run)=> {\n        const alreadyStubbedRunChannel = rm.run.channel; //FIXME: Explicitly pass instead of stubbing on a channel\n        if (alreadyStubbedRunChannel) {\n            return rm.run;\n        }\n        const channelManager = new F.manager.ChannelManager();\n        const worldChannel = channelManager.getWorldChannel(run.world);\n\n        worldChannel.subscribe(worldChannel.TOPICS.RUN_RESET, (run)=> {\n            rm.run.updateConfig({ filter: run.id });//Run handler is also listening on the run and will take care of notifying\n        }, this, { includeMine: false });\n        rm.run.channel = worldChannel;\n        return rm.run;\n    });\n\n    const currentRunHandlerOpts = $.extend(true, { serviceOptions: $runPromise, channelOptions: opts.channelOptions }, opts.defaults, opts.current);\n    const currentRunHandler = new RunRouteHandler(currentRunHandlerOpts, withPrefix(notifier, [RUN_PREFIX, '']));\n\n    const handlers = [];\n\n    const runRouteHandler = $.extend(currentRunHandler, { \n        match: matchDefaultPrefix(RUN_PREFIX),\n        name: 'World Run',\n        isDefault: true,\n        options: currentRunHandlerOpts.channelOptions,\n    });\n    handlers.unshift(runRouteHandler);\n\n    let $worldProm = null;\n    function getWorld() {\n        if (!$worldProm) {\n            $worldProm = getRun().then((run)=> {\n                return run.world;\n            });\n        }\n        return $worldProm;\n    }\n\n    const worldChannelMap = {};\n    const channelManager = new F.manager.ChannelManager();\n    function getChannelForWorld(worldid) {\n        if (!worldChannelMap[worldid]) {\n            worldChannelMap[worldid] = channelManager.getWorldChannel(worldid);\n        }\n        return worldChannelMap[worldid];\n    }\n\n    const am = new F.manager.AuthManager();\n    const handlerOptions = {\n        serviceOptions: {\n            getRun: getRun,\n            getWorld: getWorld,\n            getSession: ()=> am.getCurrentUserSessionInfo(),\n            getChannel: getChannelForWorld,\n        },\n        channelOptions: opts.channelOptions\n    };\n    \n    const usersRouteHandler = new WorldUsersRouteHandler(handlerOptions, withPrefix(notifier, MULTI_USER_PREFIX));\n    const usersHandler = $.extend(usersRouteHandler, { \n        match: matchPrefix(MULTI_USER_PREFIX),\n        name: 'world users',\n    });\n    handlers.unshift(usersHandler);\n    \n    const currentUserRouteHandler = new WorldCurrentUserRouteHandler(handlerOptions, withPrefix(notifier, USER_PREFIX));\n    const currentUserHandler = $.extend(currentUserRouteHandler, {\n        match: matchPrefix(USER_PREFIX),\n        name: 'world current user',\n    });\n    handlers.unshift(currentUserHandler);\n\n    const ConsensusManager = window.F.manager.ConsensusManager;\n    if (ConsensusManager) { //epijs < 2.80 did not have this\n        const consensusRouteHandler = new ConsensusRouteHandler(handlerOptions, withPrefix(notifier, CONSENSUS_PREFIX));\n        const consensusHandler = $.extend(consensusRouteHandler, {\n            match: matchPrefix(CONSENSUS_PREFIX),\n            name: 'consensus',\n        });\n        handlers.unshift(consensusHandler);\n    }\n\n    const worldRouteHandler = router(handlers);\n    worldRouteHandler.expose = { runManager: rm };\n\n    return worldRouteHandler;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/index.js","const F = window.F;\n\nexport default function WorldUsersRouteHandler(config, notifier) {\n    const options = $.extend(true, {\n        serviceOptions: {},\n        channelOptions: {},\n    }, config);\n\n    const { getWorld, getSession, getChannel } = options.serviceOptions;\n\n    const store = {\n        users: [],\n        mark: (userid, isOnline)=> {\n            store.users = store.users.map((u)=> {\n                if (u.userId === userid) {\n                    u.isOnline = isOnline;\n                }\n                return u;\n            });\n            return store.users;\n        }\n    };\n    \n    const parsedUsersPromise = getWorld().then((world)=> {\n        const session = getSession();\n        const parsed = world.users.map((u)=> {\n            u.name = u.lastName;\n            u.isMe = u.userId === session.userId;\n            u.isOnline = u.isMe; //Assume i'm the only online one by default\n            return u;\n        });\n        store.users = parsed;\n        return parsed;\n    });\n    \n    let presenceSubsId;\n    return { \n        unsubscribeHandler: function (knownTopics, remainingTopics) {\n            if (remainingTopics.length || !presenceSubsId) {\n                return;\n            }\n            getWorld().then((world)=> {\n                const worldChannel = getChannel(world.id);\n                worldChannel.unsubscribe(presenceSubsId);\n                presenceSubsId = null;\n            });\n\n        },\n        subscribeHandler: function (userids) {\n            if (!presenceSubsId) {\n                //TODO: Also listen to roles channel to update users\n                getWorld().then((world)=> {\n                    const worldChannel = getChannel(world.id);\n                    presenceSubsId = worldChannel.subscribe(worldChannel.TOPICS.PRESENCE, (user, meta)=> {\n                        const userid = user.id;\n                        store.mark(userid, user.isOnline);\n                        return notifier([{ name: '', value: store.users }]);\n                    }, { includeMine: false });\n                });\n            }\n            return parsedUsersPromise.then((users)=> {\n                return [{ name: '', value: users }];\n            });\n        },\n        publishHandler: function (topics, options) {\n            const ps = new F.service.Presence();\n            topics.forEach((topic)=> {\n                const split = topic.name.split(':');\n                if (split[1]) {\n                    if (split[1] === 'markOnline') {\n                        ps.markOnline(split[0]);\n                    } else if (split[1] === 'markOffline') {\n                        ps.markOffline(split[0]);\n                    }\n                }\n            });\n            return topics;\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/world-users-route-handler/index.js","export default function WorldCurrentUserRouteHandler(config, notifier) {\n    const options = $.extend(true, {\n        serviceOptions: {},\n        channelOptions: {},\n    }, config);\n\n    const { getWorld, getSession, getChannel } = options.serviceOptions;\n\n    \n    let subsid;\n\n    const store = $.extend(true, {\n        isMe: true,\n        isOnline: true,\n    }, getSession());\n\n    return { \n        unsubscribeHandler: function (unsubscribedTopics, remainingTopics) {\n            const stillNeedRoles = remainingTopics.indexOf('role') !== -1;\n            if (!stillNeedRoles && subsid) {\n                getWorld().then((world)=> {\n                    const worldChannel = getChannel(world.id);\n                    worldChannel.unsubscribe(subsid);\n                });\n                subsid = null;\n            }\n        },\n        subscribeHandler: function (userFields) {\n            return getWorld().then((world)=> {\n                const session = getSession();\n                const myUser = world.users.find((user)=> {\n                    return user.userId === session.userId;\n                });\n                $.extend(store, myUser);\n                \n                const toNotify = userFields.reduce((accum, field)=> {\n                    if (field === '') { //the entire user object\n                        accum.push({ name: field, value: store });\n                    } else if (store[field] !== undefined) {\n                        accum.push({ name: field, value: store[field] });\n                    }\n                    return accum;\n                }, []);\n                \n                const isSubscribingToRole = userFields.indexOf('role') !== -1;\n                if (isSubscribingToRole && !subsid) {\n                    const worldChannel = getChannel(world.id);\n                    subsid = worldChannel.subscribe(worldChannel.TOPICS.ROLES, (users, meta)=> {\n                        const myUser = users.find((u)=> {\n                            return u.userId === session.userId;\n                        });\n                        if (myUser && myUser.role !== store.role) {\n                            store.role = myUser.role;\n                            notifier([{ name: 'role', value: myUser.role }]);\n                        }\n                    });\n                }\n                return toNotify;\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/world-current-user-route-handler/index.js","import OperationsHandler from './consensus-operations-handler';\nimport StatusHandler from './consensus-status-handler';\nimport router from 'channels/channel-router';\nimport { matchPrefix } from 'channels/route-handlers/route-matchers';\nimport { withPrefix } from 'channels/channel-router/utils';\n\nconst ConsensusManager = window.F.manager.ConsensusManager;\n\nconst OPERATIONS_PREFIX = 'operations:';\n\nexport default function ConsensusRouteHandler(config, notifier) {\n    const options = $.extend(true, {\n        serviceOptions: {},\n        channelOptions: {},\n    }, config);\n\n    const { getWorld, getRun, getSession, getChannel } = options.serviceOptions;\n\n    const cm = new ConsensusManager();\n\n    let consensusProm = null;\n    function getConsensus(force) {\n        if (!consensusProm || force) {\n            consensusProm = getRun().then(()=> {\n                return cm.getCurrent(); //TODO: GetRun deletes the barrier if it overlaps with this call, so synchronize them\n            });\n        }\n        return consensusProm;\n    }\n\n    const handlerOptions = {\n        serviceOptions: {\n            getConsensus: getConsensus,\n            getSession: getSession\n        },\n        channelOptions: {}\n    };\n\n    const opnHandler = OperationsHandler(handlerOptions, withPrefix(notifier, OPERATIONS_PREFIX));\n    const statusHandler = StatusHandler(handlerOptions, notifier);\n\n    const handlers = [\n        $.extend({}, opnHandler, { \n            name: 'consensus operations',\n            match: matchPrefix(OPERATIONS_PREFIX),\n            options: handlerOptions.channelOptions.operations,\n        }),\n        $.extend({}, statusHandler, { \n            name: 'consensus status',\n            match: matchPrefix(''),\n            isDefault: true,\n            options: handlerOptions.channelOptions.status,\n        }),\n    ];\n\n    getWorld().then((world)=> {\n        const channel = getChannel(world.id);\n        channel.subscribe(channel.TOPICS.RUN_RESET, ()=> {\n            getConsensus(true).then((consensus)=> {\n                statusHandler.notify(consensus);\n            });\n        });\n        // FIXME: Filter by stage here\n        channel.subscribe(channel.TOPICS.CONSENSUS_UPDATE, (consensus)=> {\n            const isComplete = consensus.closed;\n            if (isComplete) {\n                getConsensus(true).then((consensus)=> {\n                    statusHandler.notify(consensus);\n                });\n            } else {\n                statusHandler.notify(consensus);\n            }\n        });\n    });\n\n    var consensusRouteHandler = router(handlers, notifier);\n    consensusRouteHandler.expose = { consensusManager: cm };\n    \n    return consensusRouteHandler;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/index.js","import { makeConsensusService } from './consensus-utils';\n\nexport default function ConsensusOperationsHandler(config, notifier) {\n    const options = $.extend(true, {\n        serviceOptions: {},\n        channelOptions: {},\n    }, config);\n\n    const { getConsensus } = options.serviceOptions;\n\n    return {\n        subscribeHandler: function () {\n            return [];\n        },\n        publishHandler: function (topics, options) {\n            return getConsensus().then((consensus)=> {\n                const actions = topics.map(function (topic) {\n                    return { name: topic.name, arguments: topic.value };\n                });\n                const cs = makeConsensusService(consensus);\n                return cs.submitActions(actions).then(()=> {\n                    return topics;\n                });\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-operations-handler.js","import { makeConsensusService } from './consensus-utils';\nimport { objectToPublishable } from 'channels/channel-utils';\nimport { pick } from 'lodash';\n\nexport default function ConsensusStatusHandler(config, notifier) {\n    const options = $.extend(true, {\n        serviceOptions: {},\n        channelOptions: {},\n    }, config);\n\n    const { getConsensus, getSession } = options.serviceOptions;\n\n    function normalizePlayers(rolePlayerMap) {\n        const session = getSession();\n        const normalized = Object.keys(rolePlayerMap).reduce((accum, role)=> {\n            const playersForRole = rolePlayerMap[role];\n            const playersWithRole = playersForRole.map((p)=> {\n                const player = p.user || p; //submitted puts user under an extra object because of course\n                return Object.assign({}, player, {\n                    role: role,\n                    userName: player.userName.split('/')[0], //API adds user/project because of course\n                    name: player.lastName,\n                    isMe: player.userName === session.userName, // so you can do :submitted:users | reject('isMe')\n                });\n            });\n            accum = accum.concat(playersWithRole);\n            return accum;\n        }, []);\n        return normalized;\n    }\n    function normalizeConsensus(consensus) {\n        const session = getSession();\n        const submitted = normalizePlayers(consensus.submitted);\n        const amWaiting = submitted.find((u)=> u.userName === session.userName);\n        const normalized = $.extend(true, {}, consensus, {\n            amWaiting: !!amWaiting,\n            submitted: submitted,\n            pending: normalizePlayers(consensus.pending),\n        });\n        return normalized;\n    }\n\n    return {\n        notify: function (consensus) {\n            const normalizedConsensus = normalizeConsensus(consensus);\n            notifier(objectToPublishable(normalizedConsensus));\n        },\n        subscribeHandler: function (topics) {\n            return getConsensus().then((consensus)=> {\n                const normalized = normalizeConsensus(consensus);\n                const dataForTopics = pick(normalized, topics);\n                return objectToPublishable(dataForTopics);\n            });\n        },\n        publishHandler: function (topics) {\n            return getConsensus().then((consensus)=> {\n                if (topics.length > 1 || topics[0].name !== 'close') {\n                    throw new TypeError('Can only publish `close` on consensus:status');\n                }\n                const cs = makeConsensusService(consensus);\n                return cs.forceClose().then(()=> topics);\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/world-route-handler/consensus-route-handler/consensus-status-handler.js","import { debounceAndMerge } from 'utils/general';\nvar { F } = window;\n\nexport default function MultiRunRouteHandler(options, notifier, channelManagerContext) {\n    var runService = new F.service.Run(options.serviceOptions.run);\n\n    var topicParamMap = {};\n\n    function extractFiltersFromTopic(topicString) {\n        var filters = topicString.replace('(', '').replace(')', '');\n        var filterParam = filters.split(';').reduce((accum, filter)=> {\n            var [key, val] = filter.split('=');\n            if (val) {\n                val = true;\n            }\n            accum[key] = val;\n            return accum;\n        }, {});\n        return filterParam;\n    }\n\n    function fetch(topic, variables) {\n        var filters = extractFiltersFromTopic(topic);\n        return runService.query(filters, { include: variables }).then((runs)=> {\n            notifier([{ name: topic, value: runs }]);\n\n            // if (topicParamMap[topic]) {\n            //     Object.keys(topicParamMap[topic]).forEach((runid)=> {\n            //         channelManagerContext.unsubscribe(topicParamMap[topic][runid]);\n            //     });\n            // }\n\n            return runs;\n        });\n    }\n\n    return {\n        fetch: fetch,\n\n        unsubscribeHandler: function (unsubscribedTopics, remainingTopics) {\n            // knownTopics = remainingTopics;\n        },\n        subscribeHandler: function (topics, options) {\n            var topic = ([].concat(topics))[0];\n\n            var filters = extractFiltersFromTopic(topic);\n            var variables = options && options.include;\n\n            var debounceInterval = 300;\n            var debouncedFetch = debounceAndMerge(fetch, debounceInterval, [(accum, newval)=> newval]);\n            return fetch(topic, variables).then(function (runs) {\n                var subsMap = {};\n                //TODO: Provide this meta information to runs-factory so it doesn't trigger a fetch to get meta for each run\n                runs.forEach((run)=> {\n                    var subscriptions = Object.keys(filters).map((filter)=> run.id + ':meta:' + filter);\n                    var subsid = channelManagerContext.subscribe(subscriptions, function () {\n                        debouncedFetch(topic, variables);\n                    }, { batch: false, autoFetch: false, cache: false });\n                    subsMap[run.id] = subsid;\n                });\n\n                topicParamMap[topic] = subsMap;\n                return runs;\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/epicenter-route-handlers/multi-run-route-handler/index.js","import { toImplicitType } from 'utils/parse-utils';\nimport _ from 'lodash';\n\nexport function match(topic) {\n    return (topic.indexOf('#') === 0) ? '' : false;\n} \n\n\nexport default function DOMRouteHandler(options, notifier) {\n    \n    const knownEls = new WeakMap();\n    const domOptions = $.extend(true, {\n        uiChangeEvents: {\n\n        },\n        debounceInterval: 200\n    }, options.defaults, options.dom);\n\n    function changeHandler($el, id, evt) {\n        const val = toImplicitType($el.val());\n        notifier([{ name: id, value: val }]);\n    }\n    const debouncedChangeHandler = _.debounce(changeHandler, domOptions.debounceInterval);\n    return {\n        match: match,\n        name: 'DOM Route',\n        subscribeHandler: function (topics) {\n            const parsed = topics.map((elID)=> {\n                const $el = $(elID);\n                if (!knownEls.has($el)) {\n                    knownEls.set($el, true);\n                    const overrides = domOptions.uiChangeEvents || {};\n                    const matchingEventOverride = Object.keys(overrides).find((selector)=> {\n                        return $el.is(selector);\n                    });\n                    const changeEvent = matchingEventOverride ? overrides[matchingEventOverride] : 'change';\n                    const handler = changeEvent.indexOf('key') !== -1 ? debouncedChangeHandler : changeHandler;\n                    $el.on(`${changeEvent}.dom-handler`, handler.bind(this, $el, elID));\n                }\n\n                const val = toImplicitType($el.val());\n                return {\n                    name: elID,\n                    value: val\n                };\n            });\n            return parsed;\n        },\n        unsubscribeHandler: function (unsubscribedTopics, remainingTopics) {\n            const toKill = unsubscribedTopics.filter((t)=> {\n                const isRemaining = remainingTopics.indexOf(t) !== -1;\n                return !isRemaining;\n            });\n            toKill.forEach((elID)=> {\n                const $el = $(elID);\n\n                $el.off('change.dom-handler');\n                knownEls.delete($el);\n            });\n        },\n        /**\n         * \n         * @param {Publishable[]} publishable \n         */\n        publishHandler: function (publishable) {\n            publishable.forEach((p)=> {\n                $(p.name).val(p.value);\n            });\n            return publishable;\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/route-handlers/dom-route-handler/index.js","export { default as interpolatable } from './interpolatable';\nexport { default as routable } from './routable';\n// export { default as withMiddleware } from './with-middleware';\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/index.js","import subscribeInterpolator from './subscribe-interpolator';\nimport publishInterpolator from './publish-interpolator';\n\n/**\n * Decorates passed channel manager with interpolation functionality\n * @param  {ChannelManager} ChannelManager\n * @returns {ChannelManager}                wrapped channel manager\n */\nexport default function interpolatable(ChannelManager) {\n    var subsidMap = {};\n\n    /**\n     * @implements {ChannelManager}\n     */\n    return class InterpolatedChannelManager extends ChannelManager {\n        constructor(options) {\n            super(options);\n            //FIXME: Add on-error (from routable) here?\n            this.subscribe = subscribeInterpolator(this.subscribe.bind(this), (dependencySubsId, newDependentId)=> {\n                var existing = subsidMap[dependencySubsId];\n                if (existing) {\n                    this.unsubscribe(existing);\n                }\n                subsidMap[dependencySubsId] = newDependentId;\n            });\n\n            this.publish = publishInterpolator(this.publish.bind(this), (variables, cb)=> {\n                super.subscribe(variables, (response, meta)=> {\n                    this.unsubscribe(meta.id);\n                    cb(response);\n                }, { autoFetch: true, batch: true, onError: (e)=> {\n                    throw e;\n                } });\n            });\n        }\n        unsubscribe(token) {\n            var existing = subsidMap[token];\n            if (existing) {\n                super.unsubscribe(existing);\n            }\n            super.unsubscribe(token);\n            delete subsidMap[token];\n        }\n        unsubscribeAll() {\n            subsidMap = {};\n            super.unsubscribeAll();\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/interpolatable/index.js","import { extractDependencies, interpolateWithValues } from './interpolatable-utils';\nimport { uniq, isEqual } from 'lodash';\n\n/**\n * @param {string[]} topics\n * @returns {string[]} interpolated\n */\nexport function getDependencies(topics) {\n    var deps = topics.reduce((accum, topic)=> {\n        var inner = extractDependencies(topic);\n        accum = accum.concat(inner);\n        return accum;\n    }, []);\n    return uniq(deps);\n}\n\n/**\n * @param {string[]} topics\n * @param {Object} data\n * @returns {string[]}\n */\nexport function interpolateWithDependencies(topics, data) {\n    return topics.map((topic)=> {\n        return interpolateWithValues(topic, data);\n    });\n}\n\n/**\n * @param  {string[]} originalTopics     \n * @param  {string[]} interpolatedTopics \n * @param  {Object} data               \n * @returns {Object}                    Interpolated\n */\nexport function mergeInterpolatedTopicsWithData(originalTopics, interpolatedTopics, data) {\n    return interpolatedTopics.reduce((accum, interpolatedTopic, index)=> {\n        var original = originalTopics[index];\n        var val = data[interpolatedTopic];\n        if (val !== undefined) {\n            accum[original] = data[interpolatedTopic];\n        }\n        return accum;\n    }, {});\n}\n\n/**\n * Takes a subscribe function and resolves any interpolated inputs\n * @param  {Function} subscribeFn        function to wrap\n * @param  {Function} onDependencyChange callback function when any dependencies change\n * @returns {Function}                    wrapped function\n */\nexport default function subscribeInterpolator(subscribeFn, onDependencyChange) {\n    return function interpolatedSubscribe(topics, cb, options) {\n        topics = [].concat(topics);\n        var dependencies = getDependencies(topics);\n        if (!dependencies.length) {\n            return subscribeFn(topics, cb, options);\n        }\n        var innerSubsId = subscribeFn(dependencies, function handleDependencyValueChange(data, dependenciesMeta) {\n            const isSameData = isEqual(data, dependenciesMeta.previousData);\n            if (isSameData) return;\n\n            var interpolatedTopics = interpolateWithDependencies(topics, data);\n            var outerSubsId = subscribeFn(interpolatedTopics, function handleInterpolatedValueChange(actualData, actualMeta) {\n                var toSendback = mergeInterpolatedTopicsWithData(topics, interpolatedTopics, actualData);\n\n                cb(toSendback, actualMeta);\n            }, options);\n\n            (onDependencyChange || $.noop)(dependenciesMeta.id, outerSubsId);\n            return outerSubsId;\n        }, $.extend(options, { autoFetch: true, batch: true }));\n\n        return innerSubsId;\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/interpolatable/subscribe-interpolator.js","import { extractDependencies, interpolateWithValues } from './interpolatable-utils';\nimport { normalizeParamOptions } from 'channels/channel-utils';\n\nimport { uniq } from 'lodash';\n\n/**\n * @param {Publishable[]} publishInputs\n * @returns {string[]} dependencies for inputs\n */\nexport function getDependencies(publishInputs) {\n    var deps = publishInputs.reduce((accum, input)=> {\n        var inner = extractDependencies(input.name);\n        accum = accum.concat(inner);\n        return accum;\n    }, []);\n    return uniq(deps);\n}\n\n/**\n * @param {Publishable[]} publishInputs\n * @param {{string: any}} valuesToInterpolate\n * @returns {Publishable[]} inputs with resolved dependencies\n */\nexport function interpolateWithDependencies(publishInputs, valuesToInterpolate) {\n    return publishInputs.map((ip)=> {\n        return {\n            name: interpolateWithValues(ip.name, valuesToInterpolate),\n            value: ip.value,\n        };\n    });\n}\n\n/**\n * Publish function to wrap\n * @param  {Function} publishFunction\n * @param  {function(string[], function({string: any}):void):void} fetchFn         function to get interpolated values from\n * @returns {Function}                 wrapped function\n */\nexport default function publishInterpolator(publishFunction, fetchFn) {\n    return function interpolatedPublishfunction(topic, value, options) {\n        var normalizedPublishInputs = normalizeParamOptions(topic, value, options);\n        var dependencies = getDependencies(normalizedPublishInputs.params);\n        if (!dependencies.length) {\n            return publishFunction(topic, value, options);\n        }\n        \n        var prom = $.Deferred();\n        fetchFn(dependencies, function handleDependencyChange(resolvedDependencies) {\n            var interpolated = interpolateWithDependencies(normalizedPublishInputs.params, resolvedDependencies);\n            var newPublishProm = publishFunction(interpolated, normalizedPublishInputs.options);\n            newPublishProm.then(prom.resolve, prom.reject);\n        });\n        return prom.promise();\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/interpolatable/publish-interpolator.js","import { normalizeParamOptions } from '../../channel-utils';\nimport { omit, difference, uniq } from 'lodash';\n\nfunction getTopicsFromSubsList(subcriptionList) {\n    const allTopics = subcriptionList.reduce(function (accum, subs) {\n        accum = accum.concat(subs.topics);\n        return accum;\n    }, []);\n    return uniq(allTopics);\n}\n\n/**\n * Decorates passed channel manager with middleware functionality\n * @param  {ChannelManager} BaseChannelManager\n * @param  {Object} router\n * @returns {ChannelManager} wrapped channel manager\n */\nexport default function withRouter(BaseChannelManager, router) {\n    /**\n     * @augments ChannelManager\n     */\n    return class ChannelWithRouter extends BaseChannelManager {\n        constructor(options) {\n            super(options);\n            const defaults = {\n                routes: []\n            };\n            const opts = $.extend(true, {}, defaults, options);\n            const optsToPassOn = omit(opts, Object.keys(defaults));\n\n            const rt = router(opts.routes, optsToPassOn, this.notify.bind(this));\n            Object.assign(this, rt.expose || {});\n            this.router = rt;\n        }\n\n        /**\n         * Allow intercepting and excluding topics from by subsequent middlewares\n         * @param  {string | string[]}   topics\n         * @param  {Function} cb\n         * @param  {Object}   options\n         * @returns {string}           subscription id\n         */\n        subscribe(topics, cb, options) {\n            const subsid = super.subscribe(topics, cb, options);\n            this.router.subscribeHandler([].concat(topics), options).then((topicsWithData)=> {\n                if (topicsWithData && topicsWithData.length) {\n                    this.notify([].concat(topicsWithData));\n                }\n            }, (err)=> {\n                this.unsubscribe(subsid);\n                if (options && options.onError) {\n                    options.onError(err);\n                }\n            });\n            return subsid;\n        }\n\n        /**\n         * Allow intercepting and handling/suppressing data to publish calls.\n         * @param {string | Publishable } topic\n         * @param {any} [value] item to publish\n         * @param {Object} [options]\n         * @returns {Promise}\n         */\n        publish(topic, value, options) {\n            const publishData = normalizeParamOptions(topic, value, options);\n            return this.router.publishHandler(publishData.params, publishData.options).then((published)=> {\n                return super.publish(published, publishData.options);\n            });\n        }\n        \n\n        /**\n         * Calls unsubscribe middleware *after* unsubscription with a list of recently unsubscribed topics\n         * @param  {string} token\n         * @returns {void}\n         */\n        unsubscribe(token) {\n            const originalTopics = getTopicsFromSubsList(this.subscriptions);\n            super.unsubscribe(token);\n            const remainingTopics = getTopicsFromSubsList(this.subscriptions);\n            const unsubscribedTopics = difference(originalTopics, remainingTopics);\n\n            this.router.unsubscribeHandler(unsubscribedTopics, remainingTopics);\n        }\n\n        /**\n         * Calls unsubscribe middleware after unsubscribeAll on the channel\n         * @returns {void}\n         */\n        unsubscribeAll() {\n            const originalTopics = getTopicsFromSubsList(this.subscriptions);\n            super.unsubscribeAll();\n\n            return this.router.unsubscribeHandler(originalTopics, []);\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/channels/channel-manager-enhancements/routable/index.js"],"sourceRoot":""}